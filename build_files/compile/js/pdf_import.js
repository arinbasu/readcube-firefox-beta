webpackJsonp([5],{11:function(t,e){t.exports={100:"Continue",101:"Switching Protocols",200:"OK",201:"Created",202:"Accepted",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",300:"Multiple Choices",301:"Moved Permanently",302:"Found",303:"See Other",304:"Not Modified",305:"Use Proxy",307:"Temporary Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Time-out",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Request Entity Too Large",414:"Request-URI Too Large",415:"Unsupported Media Type",416:"Requested Range not Satisfiable",417:"Expectation Failed",422:"Unprocessable Entity",423:"Locked",424:"Failed Dependency",429:"Too Many Requests",451:"Unavailable For Legal Reasons",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Time-out",505:"HTTP Version not Supported",507:"Insufficient Storage",CONTINUE:100,SWITCHING_PROTOCOLS:101,OK:200,CREATED:201,ACCEPTED:202,NON_AUTHORITATIVE_INFORMATION:203,NO_CONTENT:204,RESET_CONTENT:205,PARTIAL_CONTENT:206,MULTIPLE_CHOICES:300,MOVED_PERMANENTLY:301,FOUND:302,SEE_OTHER:303,NOT_MODIFIED:304,USE_PROXY:305,TEMPORARY_REDIRECT:307,BAD_REQUEST:400,UNAUTHORIZED:401,PAYMENT_REQUIRED:402,FORBIDDEN:403,NOT_FOUND:404,METHOD_NOT_ALLOWED:405,NOT_ACCEPTABLE:406,PROXY_AUTHENTICATION_REQUIRED:407,REQUEST_TIMEOUT:408,CONFLICT:409,GONE:410,LENGTH_REQUIRED:411,PRECONDITION_FAILED:412,REQUEST_ENTITY_TOO_LARGE:413,REQUEST_URI_TOO_LONG:414,UNSUPPORTED_MEDIA_TYPE:415,REQUESTED_RANGE_NOT_SATISFIABLE:416,EXPECTATION_FAILED:417,UNPROCESSABLE_ENTITY:422,LOCKED:423,FAILED_DEPENDENCY:424,TOO_MANY_REQUESTS:429,UNAVAILABLE_FOR_LEGAL_REASONS:451,INTERNAL_SERVER_ERROR:500,NOT_IMPLEMENTED:501,BAD_GATEWAY:502,SERVICE_UNAVAILABLE:503,GATEWAY_TIMEOUT:504,HTTP_VERSION_NOT_SUPPORTED:505,INSUFFICIENT_STORAGE:507}},13:function(t,e,n){var i=n(1),r=n(9),o=n(0),a={getPdfFilenameFromUrl:function(t){return"string"!=typeof t||0===t.length?"":i.chain(r.parse(t)).get("pathname","").thru(function(t){return t.split("/")}).last().thru(function(t){var e=decodeURIComponent(t).toLowerCase();return i.endsWith(e,".pdf")?e:""}).value()},isReadcubeUrl:function(t){return-1!==t.indexOf(o.DOMAIN_READCUBE)},isUrlAbsolute:function(t){return t.indexOf("://")>0||0===t.indexOf("//")},isProtocol:function(t,e){return"string"==typeof t&&0!=t.length&&i.chain(r.parse(t)).get("protocol","").thru(function(t){return-1!==e.indexOf(t)}).value()},getHostnameFromUrl:function(t){return"string"!=typeof t||0===t.length?"":r.parse(t).hostname},getUrlWithoutQuery:function(t){return"string"!=typeof t||0===t.length?"":r.format(i.extend(r.parse(t),{hash:null,query:null,search:null}))},publisherWebsiteRegExps:i.reduce(o,function(t,e,n){return n.indexOf("URL_REGEXP_PUBLISHER")>-1?t.concat(e):t},[]),isPublisherWebsite:function(t){if("string"!=typeof t||0===t.length)return!1;var e=a.getUrlWithoutQuery(t);return a.publisherWebsiteRegExps.some(function(t){return"string"==typeof t?-1!==t.indexOf(e):t.test(e)})},isRsc:function(t){if("string"!=typeof t||0===t.length)return!1;var e=a.getUrlWithoutQuery(t);return o.URL_REGEXP_PUBLISHER_RSC.test(e)},isGoogleScholar:function(t){if("string"!=typeof t||0===t.length)return!1;var e=a.getUrlWithoutQuery(t);return o.URL_REGEXP_SOURCE_GOOGLE_SCHOLAR.test(e)},isPubmed:function(t){if("string"!=typeof t||0===t.length)return!1;var e=a.getUrlWithoutQuery(t);return o.URL_REGEXP_SOURCE_PUBMED.test(e)},isReadcubeWebLibrary:function(t){if("string"!=typeof t||0===t.length)return!1;var e=a.getUrlWithoutQuery(t);return o.URL_REGEXP_WEB_LIBRARY_URL.test(e)}};t.exports=a},14:function(t,e){function n(){throw new Error("setTimeout has not been defined")}function i(){throw new Error("clearTimeout has not been defined")}function r(t){if(l===setTimeout)return setTimeout(t,0);if((l===n||!l)&&setTimeout)return l=setTimeout,setTimeout(t,0);try{return l(t,0)}catch(e){try{return l.call(null,t,0)}catch(e){return l.call(this,t,0)}}}function o(t){if(f===clearTimeout)return clearTimeout(t);if((f===i||!f)&&clearTimeout)return f=clearTimeout,clearTimeout(t);try{return f(t)}catch(e){try{return f.call(null,t)}catch(e){return f.call(this,t)}}}function a(){v&&p&&(v=!1,p.length?h=p.concat(h):g=-1,h.length&&s())}function s(){if(!v){var t=r(a);v=!0;for(var e=h.length;e;){for(p=h,h=[];++g<e;)p&&p[g].run();g=-1,e=h.length}p=null,v=!1,o(t)}}function u(t,e){this.fun=t,this.array=e}function c(){}var l,f,d=t.exports={};!function(){try{l="function"==typeof setTimeout?setTimeout:n}catch(t){l=n}try{f="function"==typeof clearTimeout?clearTimeout:i}catch(t){f=i}}();var p,h=[],v=!1,g=-1;d.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];h.push(new u(t,e)),1!==h.length||v||r(s)},u.prototype.run=function(){this.fun.apply(null,this.array)},d.title="browser",d.browser=!0,d.env={},d.argv=[],d.version="",d.versions={},d.on=c,d.addListener=c,d.once=c,d.off=c,d.removeListener=c,d.removeAllListeners=c,d.emit=c,d.prependListener=c,d.prependOnceListener=c,d.listeners=function(t){return[]},d.binding=function(t){throw new Error("process.binding is not supported")},d.cwd=function(){return"/"},d.chdir=function(t){throw new Error("process.chdir is not supported")},d.umask=function(){return 0}},15:function(t,e,n){var i=n(3),r=n(1),o=n(0);n(9);t.exports=i({__constructor:function(t){this.id=null,this.pmid=null,this.doi=null,this.gsid=null,this.inLibraryStatus=o.STATUS_NOT_FOUND,this.isReadyForShowing=!1,this.metadata={},this.pdfUrl=null,this.usingPdfUrl=null,this.url=null,this.pdfHash=null,this.hasPdf=!1,this.note="",this.progressPercent=0,this.progressType=o.PROGRESS_DOWNLOAD,r.isObject(t)&&this.extend(t)},extend:function(t){return r.extend(this,t),this},getIdentifiers:function(){return r.pick(this,["doi","pmid","gsid"])},setInLibraryStatus:function(t,e){return t==o.STATUS_IN_LIBRARY?e?this.hasPdf?this.inLibraryStatus=o.STATUS_IN_LIBRARY_WITH_PDF:this.inLibraryStatus=o.STATUS_IN_LIBRARY_WITHOUT_PDF:this.inLibraryStatus=this.hasPdf?o.STATUS_IN_LIBRARY_WITH_PDF:o.STATUS_IN_LIBRARY:this.inLibraryStatus=o.STATUS_NOT_FOUND,this},isProcessingStatus:function(){return this.inLibraryStatus==o.STATUS_METADATA_ADDING||this.inLibraryStatus==o.STATUS_PDF_DOWNLOADING},finishProcessingStatus:function(t){this.hasPdf?this.inLibraryStatus=o.STATUS_IN_LIBRARY_WITH_PDF:this.inLibraryStatus==o.STATUS_METADATA_ADDING?this.inLibraryStatus=o.STATUS_NOT_FOUND:this.inLibraryStatus==o.STATUS_PDF_DOWNLOADING&&(this.inLibraryStatus=t?o.STATUS_IN_LIBRARY_WITHOUT_PDF_WARNING_PROXY:o.STATUS_IN_LIBRARY_WITHOUT_PDF_WARNING)},isInLibrary:function(){var t=!1;switch(this.inLibraryStatus){case o.STATUS_IN_LIBRARY:case o.STATUS_IN_LIBRARY_WITH_PDF:case o.STATUS_IN_LIBRARY_WITHOUT_PDF:case o.STATUS_IN_LIBRARY_WITHOUT_PDF_WARNING:case o.STATUS_IN_LIBRARY_WITHOUT_PDF_WARNING_PROXY:t=!0}return t},isPdfDownloadFailed:function(){var t=!1;switch(this.inLibraryStatus){case o.STATUS_IN_LIBRARY_WITHOUT_PDF_WARNING:case o.STATUS_IN_LIBRARY_WITHOUT_PDF_WARNING_PROXY:t=!0}return t},toJsonForAPI:function(t){var e={ext_ids:this.getIdentifiers(),note:null,return_item:!0};return e.ext_ids.gsid&&e.ext_ids.gsid.indexOf("null")>-1&&(e.ext_ids.gsid=null),r.get(t,"includeMetadata",!1)&&(e.article=this.metadata),r.get(t,"includeNote",!1)&&(e.note=this.note,e.user_data={notes:this.note}),e},toJson:function(){var t={};for(var e in this)"function"!=typeof this[e]&&(t[e]=this[e]);return t},getPdfUrl:function(){return this.pdfUrl?this.pdfUrl:null}})},168:function(t,e,n){var i=n(2);n(188),i.module("App",[]),n(38),n(40),n(43),n(42),n(24),n(37),n(71),n(23),n(36),n(44),n(22),n(39),n(35),n(33),n(34),n(32),n(21),function(t){t.keys().forEach(t)}(n(235)),t.exports=i.module("App")},188:function(t,e){},19:function(t,e,n){(function(t,e){!function(t,n){"use strict";function i(t){"function"!=typeof t&&(t=new Function(""+t));for(var e=new Array(arguments.length-1),n=0;n<e.length;n++)e[n]=arguments[n+1];var i={callback:t,args:e};return c[u]=i,s(u),u++}function r(t){delete c[t]}function o(t){var e=t.callback,i=t.args;switch(i.length){case 0:e();break;case 1:e(i[0]);break;case 2:e(i[0],i[1]);break;case 3:e(i[0],i[1],i[2]);break;default:e.apply(n,i)}}function a(t){if(l)setTimeout(a,0,t);else{var e=c[t];if(e){l=!0;try{o(e)}finally{r(t),l=!1}}}}if(!t.setImmediate){var s,u=1,c={},l=!1,f=t.document,d=Object.getPrototypeOf&&Object.getPrototypeOf(t);d=d&&d.setTimeout?d:t,"[object process]"==={}.toString.call(t.process)?function(){s=function(t){e.nextTick(function(){a(t)})}}():function(){if(t.postMessage&&!t.importScripts){var e=!0,n=t.onmessage;return t.onmessage=function(){e=!1},t.postMessage("","*"),t.onmessage=n,e}}()?function(){var e="setImmediate$"+Math.random()+"$",n=function(n){n.source===t&&"string"==typeof n.data&&0===n.data.indexOf(e)&&a(+n.data.slice(e.length))};t.addEventListener?t.addEventListener("message",n,!1):t.attachEvent("onmessage",n),s=function(n){t.postMessage(e+n,"*")}}():t.MessageChannel?function(){var t=new MessageChannel;t.port1.onmessage=function(t){a(t.data)},s=function(e){t.port2.postMessage(e)}}():f&&"onreadystatechange"in f.createElement("script")?function(){var t=f.documentElement;s=function(e){var n=f.createElement("script");n.onreadystatechange=function(){a(e),n.onreadystatechange=null,t.removeChild(n),n=null},t.appendChild(n)}}():function(){s=function(t){setTimeout(a,0,t)}}(),d.setImmediate=i,d.clearImmediate=r}}("undefined"==typeof self?void 0===t?this:t:self)}).call(e,n(16),n(14))},197:function(t,e){t.exports='<div class="readcube-tooltip-title">\n  Your <a href="{{ getAccountLink() }}" target="_blank">ReadCube Pro</a> has expired - re-subscribe to import PDFs.\n</div>\n<div>\n  <button ng-click="onOpenAccountClick()" class="readcube-blue-button">\n    Go Pro\n  </button>\n  <button ng-click="viewVisibility.visible = false" class="readcube-blue-button readcube-blue-button-disabled">\n    Later\n  </button>\n</div>'},198:function(t,e){t.exports='<div class="readcube-tooltip-title">\n  Your ReadCube Pro has expired - <a href="{{ getAccountLink() }}" target="_blank">re-subscribe</a>\n  or get another 30 day free trial to automatically find and import PDFs\n</div>\n<div>\n  <button ng-click="onOpenAccountClick()" class="readcube-blue-button readcube-small-button">\n    Go Pro\n  </button>\n  <button ng-click="onGetTrialClick()" class="readcube-blue-button readcube-small-button">\n    Get Trial\n  </button>\n  <button ng-click="viewVisibility.visible = false" class="readcube-blue-button readcube-blue-button-disabled readcube-small-button">\n    Later\n  </button>\n</div>'},199:function(t,e){t.exports='<div class="readcube-tooltip-title">\n  Try <a href="{{ getAccountLink() }}" target="_blank">ReadCube Pro</a> to import PDFs. Start your risk-free 30 day trial?\n</div>\n<div>\n  <button ng-click="onOpenAccountClick()" class="readcube-blue-button">\n    Start trial\n  </button>\n  <button ng-click="viewVisibility.visible = false" class="readcube-blue-button readcube-blue-button-disabled">\n    Later\n  </button>\n</div>'},20:function(t,e,n){function i(t,e){this._id=t,this._clearFn=e}var r=Function.prototype.apply;e.setTimeout=function(){return new i(r.call(setTimeout,window,arguments),clearTimeout)},e.setInterval=function(){return new i(r.call(setInterval,window,arguments),clearInterval)},e.clearTimeout=e.clearInterval=function(t){t&&t.close()},i.prototype.unref=i.prototype.ref=function(){},i.prototype.close=function(){this._clearFn.call(window,this._id)},e.enroll=function(t,e){clearTimeout(t._idleTimeoutId),t._idleTimeout=e},e.unenroll=function(t){clearTimeout(t._idleTimeoutId),t._idleTimeout=-1},e._unrefActive=e.active=function(t){clearTimeout(t._idleTimeoutId);var e=t._idleTimeout;e>=0&&(t._idleTimeoutId=setTimeout(function(){t._onTimeout&&t._onTimeout()},e))},n(19),e.setImmediate=setImmediate,e.clearImmediate=clearImmediate},21:function(t,e,n){var i=n(2),r=n(0);i.module("App").run(["Mixpanel",function(t){var e=chrome.runtime.getManifest().version;t.setProperty(r.MIXPANEL_PROPERTY_BROWSER_EXTENSION_VERSION,e);var n={};n[r.MIXPANEL_SUPER_PROPERTY_CLIENT]="Browser Ext",n[r.MIXPANEL_SUPER_PROPERTY_BROWSER_EXTENSION_VERSION]=e,t.setSuperProperty(n),t.union(r.MIXPANEL_PROPERTY_CLIENTS_USED,"browser_ext")}])},22:function(t,e,n){function i(t,e){var n=!1;o.init(a.MIXPANEL_TOKEN,{api_host:a.MIXPANEL_API_URL});var i={get:function(){return n?t.resolve(o):(n=!0,e.evaluateLoggedInUserDetail().then(function(e){return e.id?(o.identify(e.id),o):t.reject("Unable to get user id")}).catch(function(e){return console.error(e),t.reject(e)}))},getObjectFromParams:function(t,e){var n={};return"string"==typeof t?n[t]=e:n=t,n},setProperty:function(t,e){return i.get().then(function(n){return n.people.set(i.getObjectFromParams(t,e)),!0})},setSuperProperty:function(t,e){return i.get().then(function(n){return n.register(i.getObjectFromParams(t,e)),!0})},incrementProperty:function(t,e){return i.get().then(function(n){return n.people.increment(i.getObjectFromParams(t,e)),!0})},trackEvent:function(t,e){return i.get().then(function(n){return n.track(t,e),!0})},union:function(t,e){return i.get().then(function(n){return n.people.union(t,e),!0})}};return i}i.$inject=["$q","User"];var r=n(2),o=n(47),a=n(0);r.module("App").factory("Mixpanel",i)},23:function(t,e,n){function i(t){return{sendToBackground:function(e,n){var i=t.defer();return chrome.runtime.sendMessage({method:e,data:n},function(t){i.resolve(t)}),i.promise},listenForMessages:function(t){function e(e,n,i){return t(e,i),!0}chrome.runtime.onMessage.addListener(e),window.onbeforeunload=function(){chrome.runtime.onMessage.hasListener(e)&&chrome.runtime.onMessage.removeListener(e)}},sendToActiveTab:function(e){var n=t.defer();return chrome.tabs.query({active:!0,currentWindow:!0},function(t){if(0==t.length)return void n.reject("No active tabs were found");chrome.tabs.sendMessage(t[0].id,e,n.resolve)}),n.promise}}}i.$inject=["$q"],n(2).module("App").factory("Message",i)},235:function(t,e,n){function i(t){return n(r(t))}function r(t){var e=o[t];if(!(e+1))throw new Error("Cannot find module '"+t+"'.");return e}var o={"./app.js":168,"./config/cache.js":236,"./config/tether_tooltip.js":237,"./controllers/import.js":238,"./services/imported_articles_storage.js":239};i.keys=function(){return Object.keys(o)},i.resolve=r,t.exports=i,i.id=235},236:function(t,e,n){n(2).module("App").run(["$templateCache",function(t){t.put("tooltip/index",n(29)),t.put("tooltip/pdf_view_no_subscription",n(199)),t.put("tooltip/pdf_view_expired_subscription",n(197)),t.put("tooltip/pdf_view_expired_trial",n(198))}])},237:function(t,e,n){n(2).module("App").config(["tetherTooltipConfigProvider",function(t){t.setOptions({parentSelector:".readcube-pdf-view"})}])},238:function(t,e,n){function i(t,e,n,i,r,l,f){function d(){if(f.isOffline())return void(v.offlineTooltipVisibility.visible=!0);v.offlineTooltipVisibility.visible=!1,l.setProperty(s.MIXPANEL_PROPERTY_BROWSER_EXTENSION_LAST_SEEN,(new Date).toISOString());var e=null,n=0;if(!v.row.id){var i=c.get(g,"query.pdfUrl",null);if(i){var o=u.parse(i,!0);v.row.id=c.get(o,"query.readcubeId",null),e=c.get(o,"query.tabId",null),n=c.get(o,"query.articleIndex",0)}}return new t(v.row).upload().then(function(t){l.incrementProperty(s.MIXPANEL_PROPERTY_BROWSER_EXTENSION_PDF,1),l.trackEvent(s.MIXPANEL_EVENT_PDF_DOWNLOADED);var i=v.row;if(!e||!t)return!0;var r={tabId:c.parseInt(e),payload:{message:s.MESSAGE_UPDATE_ARTICLE,data:{index:n,updateDetails:{id:i.id,inLibraryStatus:s.STATUS_IN_LIBRARY_WITH_PDF}}}};return a.sendToBackground("tabs.UpdateArticleInTab",r).then(function(){return!0}).catch(function(t){return console.error(t),!0})}).catch(function(t){return l.trackEvent(s.MIXPANEL_EVENT_PDF_DOWNLOAD_FAILED),v.tooltipVisibility.show=!0,r.reject(t)})}function p(){e.openItemInLibrary(v.row.id),l.trackEvent(s.MIXPANEL_EVENT_INJECTED_BUTTON_IN_LIBRARY_CLICKED)}function h(){d()}var v=this,g=u.parse(n.location.href,!0),m=c.get(g,"query.readcubeId",null);v.row=new o({id:m}),v.tooltipVisibility={visible:!0},v.offlineTooltipVisibility={visible:!1},v.row.pdfUrl=c.get(g,"query.pdfUrl"),v.row.id&&i.isImported(v.row.id).then(function(t){return t?(v.row.inLibraryStatus=s.STATUS_IN_LIBRARY_WITH_PDF,!0):v.onDownloadPdfClick().then(function(){return i.add(v.row.id)})}),v.onDownloadPdfClick=d,v.onInLibraryClick=p,v.onRetryClick=h,v.onOpenLibraryClick=e.openLibrary}i.$inject=["RawUpload","BrowserTab","$window","ImportedArticlesStorage","$q","Mixpanel","OnlineStatus"];var r=n(2),o=n(15),a=n(45),s=n(0),u=n(9),c=n(1);r.module("App").controller("Import",i)},239:function(t,e,n){function i(t){return{add:function(e){return t.get(o.STORAGE_KEY_IMPORTED_ARTICLES,[]).then(function(n){return n.push(e),n.length>50&&(n=_.drop(n,1)),t.set(o.STORAGE_KEY_IMPORTED_ARTICLES,n)})},isImported:function(e){return t.get(o.STORAGE_KEY_IMPORTED_ARTICLES,[]).then(function(t){return-1!==t.indexOf(e)})}}}i.$inject=["Storage"];var r=n(2),o=n(0);r.module("App").factory("ImportedArticlesStorage",i)},24:function(t,e,n){function i(t,e,n){var i={INITIAL:0,PROCESSING:1,DONE:2},r=i.INITIAL,c=[],l={getLoggedInUserDetails:function(){return e.get(o.STORAGE_KEY_LOGGED_IN_USER_DETAILS,null).then(function(t){return a.get(t,"id")?t:n.reject("User data not available in the storage")})},evaluateLoggedInUserDetail:function(){var t=this,e=n.defer();if(r===i.INITIAL)r=i.PROCESSING,c.push(e),t.queryUserDetails().then(function(t){l.setLoggedInUserDetails(t),r=i.DONE,c.forEach(function(e){e.resolve(t)})}).catch(function(e){t.clearLoggedInUserDetails(),r=i.INITIAL,c.forEach(function(t){t.reject(e)})}).finally(function(){c=[]});else{if(r!==i.PROCESSING)return l.getLoggedInUserDetails();c.push(e)}return e.promise},clearProcessingStatus:function(){r=i.INITIAL},getInstitutionProxy:function(){return this.evaluateLoggedInUserDetail().then(function(t){switch(a.get(t,"proxy_url_selection",null)){case o.VALUE_PROXY_URL_SELECTION_NONE:case o.VALUE_PROXY_URL_SELECTION_NULL:return n.reject('Proxy url selection is "none" or "null"');case o.VALUE_PROXY_URL_SELECTION_MANUAL:var e=a.get(t,"proxy_url",null);return e||n.reject("Proxy url is not available");case o.VALUE_PROXY_URL_SELECTION_INSTITUTION:var i=a.get(t,"institution_proxy_url",null);return i||n.reject("Institution proxy url is not available");default:return n.reject("Unknown proxy selection option")}})},getSfxUrlByDoiAndPmid:function(t,e){return this.evaluateLoggedInUserDetail().then(function(i){var r=a.get(i,"sfx_url",null);if(!r)return n.reject("Sfx url is not available");var o=u.parse(r,!0);return t&&(o.query.__DOI__="doi:"+t),e&&(o.query.__PMID__="pmid:"+e),u.format(o).replace("__DOI__","id").replace("__PMID__","id")})},getSubscriptionStatus:function(){return this.querySubscriptionStatus().then(function(t){return"free"===t.account?"expired"===t.status?"trial"===t.previous_type?o.SUBSCRIPTION_TRIAL_EXPIRED:o.SUBSCRIPTION_PRO_EXPIRED:o.SUBSCRIPTION_FREE:o.SUBSCRIPTION_PRO}).catch(function(){return o.SUBSCRIPTION_FREE})},setLoggedInUserDetails:function(t){e.set(o.STORAGE_KEY_LOGGED_IN_USER_DETAILS,t)},clearLoggedInUserDetails:function(){e.set(o.STORAGE_KEY_LOGGED_IN_USER_DETAILS,null),e.set(o.STORAGE_KEY_DISPLAYED_GO_PRO_TOOLTIP,!1)},queryUserDetails:function(){return s.get(o.URL_USER_DETAILS).then(function(t){var e=a.get(t,"data",null);return e?{email:e.email,name:e.full_name,id:e.id,institution:e.institution,institution_proxy_url:e.institution_proxy_url,proxy_url:e.proxy_url,proxy_url_selection:e.proxy_url_selection,sfx_url:e.sfx_url}:n.reject("Unable to get user details")})},querySubscriptionStatus:function(){return s.get(o.URL_SUBSCRIPTION_STATUS).then(function(t){var e=a.get(t,"data",null);return e||n.reject("Unable to load subscription details")})},logout:function(){return s.get(o.URL_LOGOUT,!0)}};return l}i.$inject=["$http","Storage","$q"];var r=n(2),o=n(0),a=n(1),s=n(7),u=n(9);r.module("App").factory("User",i)},240:function(t,e,n){n(168)},25:function(t,e){function n(t){for(var e=atob(t.split(",")[1]),n=new ArrayBuffer(e.length),i=new Uint8Array(n),r=0;r<e.length;r++)i[r]=e.charCodeAt(r);return n}e.toArrayBuffer=n,e.toBlob=function(t){return new Blob([n(t)])}},29:function(t,e){t.exports='<div class="tether-content">\n  <div class="readcube-tooltip {{ viewClass }}">\n    <div class="readcube-tooltip-icons">\n      <span ng-if="viewRetry == \'yes\'" title="Retry" class="readcube-icon-close"\n            ng-click="onRetryClick($event)">&#8634;</span>\n      <span ng-if="viewClose == \'yes\'" title="Close tooltip" class="readcube-icon-close"\n            ng-click="onCloseTooltipClick($event)">Ã—</span>\n    </div>\n\n    <div ng-include="viewUrl" ng-if="viewUrl" ng-controller="PdfWarning"></div>\n    <div class="readcube-tooltip-title" ng-if="viewText">{{ viewText }}</div>\n  </div>\n</div>'},31:function(t,e,n){var i,r;/*! tether 1.4.0 */
!function(o,a){i=a,void 0!==(r="function"==typeof i?i.call(e,n,e,t):i)&&(t.exports=r)}(0,function(t,e,n){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t){var e=t.getBoundingClientRect(),n={};for(var i in e)n[i]=e[i];if(t.ownerDocument!==document){var o=t.ownerDocument.defaultView.frameElement;if(o){var a=r(o);n.top+=a.top,n.bottom+=a.top,n.left+=a.left,n.right+=a.left}}return n}function o(t){var e=getComputedStyle(t)||{},n=e.position,i=[];if("fixed"===n)return[t];for(var r=t;(r=r.parentNode)&&r&&1===r.nodeType;){var o=void 0;try{o=getComputedStyle(r)}catch(t){}if(void 0===o||null===o)return i.push(r),i;var a=o,s=a.overflow,u=a.overflowX;/(auto|scroll)/.test(s+a.overflowY+u)&&("absolute"!==n||["relative","absolute","fixed"].indexOf(o.position)>=0)&&i.push(r)}return i.push(t.ownerDocument.body),t.ownerDocument!==document&&i.push(t.ownerDocument.defaultView),i}function a(){S&&document.body.removeChild(S),S=null}function s(t){var e=void 0;t===document?(e=document,t=document.documentElement):e=t.ownerDocument;var n=e.documentElement,i=r(t),o=w();return i.top-=o.top,i.left-=o.left,void 0===i.width&&(i.width=document.body.scrollWidth-i.left-i.right),void 0===i.height&&(i.height=document.body.scrollHeight-i.top-i.bottom),i.top=i.top-n.clientTop,i.left=i.left-n.clientLeft,i.right=e.body.clientWidth-i.width-i.left,i.bottom=e.body.clientHeight-i.height-i.top,i}function u(t){return t.offsetParent||document.documentElement}function c(){if(L)return L;var t=document.createElement("div");t.style.width="100%",t.style.height="200px";var e=document.createElement("div");l(e.style,{position:"absolute",top:0,left:0,pointerEvents:"none",visibility:"hidden",width:"200px",height:"150px",overflow:"hidden"}),e.appendChild(t),document.body.appendChild(e);var n=t.offsetWidth;e.style.overflow="scroll";var i=t.offsetWidth;n===i&&(i=e.clientWidth),document.body.removeChild(e);var r=n-i;return L={width:r,height:r}}function l(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],e=[];return Array.prototype.push.apply(e,arguments),e.slice(1).forEach(function(e){if(e)for(var n in e)({}).hasOwnProperty.call(e,n)&&(t[n]=e[n])}),t}function f(t,e){if(void 0!==t.classList)e.split(" ").forEach(function(e){e.trim()&&t.classList.remove(e)});else{var n=new RegExp("(^| )"+e.split(" ").join("|")+"( |$)","gi"),i=h(t).replace(n," ");v(t,i)}}function d(t,e){if(void 0!==t.classList)e.split(" ").forEach(function(e){e.trim()&&t.classList.add(e)});else{f(t,e);var n=h(t)+" "+e;v(t,n)}}function p(t,e){if(void 0!==t.classList)return t.classList.contains(e);var n=h(t);return new RegExp("(^| )"+e+"( |$)","gi").test(n)}function h(t){return t.className instanceof t.ownerDocument.defaultView.SVGAnimatedString?t.className.baseVal:t.className}function v(t,e){t.setAttribute("class",e)}function g(t,e,n){n.forEach(function(n){-1===e.indexOf(n)&&p(t,n)&&f(t,n)}),e.forEach(function(e){p(t,e)||d(t,e)})}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function m(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function y(t,e){var n=arguments.length<=2||void 0===arguments[2]?1:arguments[2];return t+n>=e&&e>=t-n}function b(){return"undefined"!=typeof performance&&void 0!==performance.now?performance.now():+new Date}function _(){for(var t={top:0,left:0},e=arguments.length,n=Array(e),i=0;i<e;i++)n[i]=arguments[i];return n.forEach(function(e){var n=e.top,i=e.left;"string"==typeof n&&(n=parseFloat(n,10)),"string"==typeof i&&(i=parseFloat(i,10)),t.top+=n,t.left+=i}),t}function T(t,e){return"string"==typeof t.left&&-1!==t.left.indexOf("%")&&(t.left=parseFloat(t.left,10)/100*e.width),"string"==typeof t.top&&-1!==t.top.indexOf("%")&&(t.top=parseFloat(t.top,10)/100*e.height),t}function E(t,e){return"scrollParent"===e?e=t.scrollParents[0]:"window"===e&&(e=[pageXOffset,pageYOffset,innerWidth+pageXOffset,innerHeight+pageYOffset]),e===document&&(e=e.documentElement),void 0!==e.nodeType&&function(){var t=e,n=s(e),i=n,r=getComputedStyle(e);if(e=[i.left,i.top,n.width+i.left,n.height+i.top],t.ownerDocument!==document){var o=t.ownerDocument.defaultView;e[0]+=o.pageXOffset,e[1]+=o.pageYOffset,e[2]+=o.pageXOffset,e[3]+=o.pageYOffset}z.forEach(function(t,n){t=t[0].toUpperCase()+t.substr(1),"Top"===t||"Left"===t?e[n]+=parseFloat(r["border"+t+"Width"]):e[n]-=parseFloat(r["border"+t+"Width"])})}(),e}var I=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),R=void 0;void 0===R&&(R={modules:[]});var S=null,A=function(){var t=0;return function(){return++t}}(),O={},w=function(){var t=S;t&&document.body.contains(t)||(t=document.createElement("div"),t.setAttribute("data-tether-id",A()),l(t.style,{top:0,left:0,position:"absolute"}),document.body.appendChild(t),S=t);var e=t.getAttribute("data-tether-id");return void 0===O[e]&&(O[e]=r(t),P(function(){delete O[e]})),O[e]},L=null,U=[],P=function(t){U.push(t)},N=function(){for(var t=void 0;t=U.pop();)t()},C=function(){function t(){i(this,t)}return I(t,[{key:"on",value:function(t,e,n){var i=!(arguments.length<=3||void 0===arguments[3])&&arguments[3];void 0===this.bindings&&(this.bindings={}),void 0===this.bindings[t]&&(this.bindings[t]=[]),this.bindings[t].push({handler:e,ctx:n,once:i})}},{key:"once",value:function(t,e,n){this.on(t,e,n,!0)}},{key:"off",value:function(t,e){if(void 0!==this.bindings&&void 0!==this.bindings[t])if(void 0===e)delete this.bindings[t];else for(var n=0;n<this.bindings[t].length;)this.bindings[t][n].handler===e?this.bindings[t].splice(n,1):++n}},{key:"trigger",value:function(t){if(void 0!==this.bindings&&this.bindings[t]){for(var e=0,n=arguments.length,i=Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];for(;e<this.bindings[t].length;){var o=this.bindings[t][e],a=o.handler,s=o.ctx,u=o.once,c=s;void 0===c&&(c=this),a.apply(c,i),u?this.bindings[t].splice(e,1):++e}}}}]),t}();R.Utils={getActualBoundingClientRect:r,getScrollParents:o,getBounds:s,getOffsetParent:u,extend:l,addClass:d,removeClass:f,hasClass:p,updateClasses:g,defer:P,flush:N,uniqueId:A,Evented:C,getScrollBarSize:c,removeUtilElements:a};var D=function(){function t(t,e){var n=[],i=!0,r=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(i=(a=s.next()).done)&&(n.push(a.value),!e||n.length!==e);i=!0);}catch(t){r=!0,o=t}finally{try{!i&&s.return&&s.return()}finally{if(r)throw o}}return n}return function(e,n){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),I=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),x=function(t,e,n){for(var i=!0;i;){var r=t,o=e,a=n;i=!1,null===r&&(r=Function.prototype);var s=Object.getOwnPropertyDescriptor(r,o);if(void 0!==s){if("value"in s)return s.value;var u=s.get;if(void 0===u)return;return u.call(a)}var c=Object.getPrototypeOf(r);if(null===c)return;t=c,e=o,n=a,i=!0,s=c=void 0}};if(void 0===R)throw new Error("You must include the utils.js file before tether.js");var k=R.Utils,o=k.getScrollParents,s=k.getBounds,u=k.getOffsetParent,l=k.extend,d=k.addClass,f=k.removeClass,g=k.updateClasses,P=k.defer,N=k.flush,c=k.getScrollBarSize,a=k.removeUtilElements,j=function(){if("undefined"==typeof document)return"";for(var t=document.createElement("div"),e=["transform","WebkitTransform","OTransform","MozTransform","msTransform"],n=0;n<e.length;++n){var i=e[n];if(void 0!==t.style[i])return i}}(),M=[],F=function(){M.forEach(function(t){t.position(!1)}),N()};!function(){var t=null,e=null,n=null,i=function i(){if(void 0!==e&&e>16)return e=Math.min(e-16,250),void(n=setTimeout(i,250));void 0!==t&&b()-t<10||(null!=n&&(clearTimeout(n),n=null),t=b(),F(),e=b()-t)};"undefined"!=typeof window&&void 0!==window.addEventListener&&["resize","scroll","touchmove"].forEach(function(t){window.addEventListener(t,i)})}();var B={center:"center",left:"right",right:"left"},W={middle:"middle",top:"bottom",bottom:"top"},Y={top:0,left:0,middle:"50%",center:"50%",bottom:"100%",right:"100%"},H=function(t,e){var n=t.left,i=t.top;return"auto"===n&&(n=B[e.left]),"auto"===i&&(i=W[e.top]),{left:n,top:i}},G=function(t){var e=t.left,n=t.top;return void 0!==Y[t.left]&&(e=Y[t.left]),void 0!==Y[t.top]&&(n=Y[t.top]),{left:e,top:n}},X=function(t){var e=t.split(" "),n=D(e,2);return{top:n[0],left:n[1]}},V=X,$=function(t){function e(t){var n=this;i(this,e),x(Object.getPrototypeOf(e.prototype),"constructor",this).call(this),this.position=this.position.bind(this),M.push(this),this.history=[],this.setOptions(t,!1),R.modules.forEach(function(t){void 0!==t.initialize&&t.initialize.call(n)}),this.position()}return m(e,t),I(e,[{key:"getClass",value:function(){var t=arguments.length<=0||void 0===arguments[0]?"":arguments[0],e=this.options.classes;return void 0!==e&&e[t]?this.options.classes[t]:this.options.classPrefix?this.options.classPrefix+"-"+t:t}},{key:"setOptions",value:function(t){var e=this,n=arguments.length<=1||void 0===arguments[1]||arguments[1],i={offset:"0 0",targetOffset:"0 0",targetAttachment:"auto auto",classPrefix:"tether"};this.options=l(i,t);var r=this.options,a=r.element,s=r.target,u=r.targetModifier;if(this.element=a,this.target=s,this.targetModifier=u,"viewport"===this.target?(this.target=document.body,this.targetModifier="visible"):"scroll-handle"===this.target&&(this.target=document.body,this.targetModifier="scroll-handle"),["element","target"].forEach(function(t){if(void 0===e[t])throw new Error("Tether Error: Both element and target must be defined");void 0!==e[t].jquery?e[t]=e[t][0]:"string"==typeof e[t]&&(e[t]=document.querySelector(e[t]))}),d(this.element,this.getClass("element")),!1!==this.options.addTargetClasses&&d(this.target,this.getClass("target")),!this.options.attachment)throw new Error("Tether Error: You must provide an attachment");this.targetAttachment=V(this.options.targetAttachment),this.attachment=V(this.options.attachment),this.offset=X(this.options.offset),this.targetOffset=X(this.options.targetOffset),void 0!==this.scrollParents&&this.disable(),"scroll-handle"===this.targetModifier?this.scrollParents=[this.target]:this.scrollParents=o(this.target),!1!==this.options.enabled&&this.enable(n)}},{key:"getTargetBounds",value:function(){if(void 0===this.targetModifier)return s(this.target);if("visible"===this.targetModifier){if(this.target===document.body)return{top:pageYOffset,left:pageXOffset,height:innerHeight,width:innerWidth};var t=s(this.target),e={height:t.height,width:t.width,top:t.top,left:t.left};return e.height=Math.min(e.height,t.height-(pageYOffset-t.top)),e.height=Math.min(e.height,t.height-(t.top+t.height-(pageYOffset+innerHeight))),e.height=Math.min(innerHeight,e.height),e.height-=2,e.width=Math.min(e.width,t.width-(pageXOffset-t.left)),e.width=Math.min(e.width,t.width-(t.left+t.width-(pageXOffset+innerWidth))),e.width=Math.min(innerWidth,e.width),e.width-=2,e.top<pageYOffset&&(e.top=pageYOffset),e.left<pageXOffset&&(e.left=pageXOffset),e}if("scroll-handle"===this.targetModifier){var t=void 0,n=this.target;n===document.body?(n=document.documentElement,t={left:pageXOffset,top:pageYOffset,height:innerHeight,width:innerWidth}):t=s(n);var i=getComputedStyle(n),r=n.scrollWidth>n.clientWidth||[i.overflow,i.overflowX].indexOf("scroll")>=0||this.target!==document.body,o=0;r&&(o=15);var a=t.height-parseFloat(i.borderTopWidth)-parseFloat(i.borderBottomWidth)-o,e={width:15,height:.975*a*(a/n.scrollHeight),left:t.left+t.width-parseFloat(i.borderLeftWidth)-15},u=0;a<408&&this.target===document.body&&(u=-11e-5*Math.pow(a,2)-.00727*a+22.58),this.target!==document.body&&(e.height=Math.max(e.height,24));var c=this.target.scrollTop/(n.scrollHeight-a);return e.top=c*(a-e.height-u)+t.top+parseFloat(i.borderTopWidth),this.target===document.body&&(e.height=Math.max(e.height,24)),e}}},{key:"clearCache",value:function(){this._cache={}}},{key:"cache",value:function(t,e){return void 0===this._cache&&(this._cache={}),void 0===this._cache[t]&&(this._cache[t]=e.call(this)),this._cache[t]}},{key:"enable",value:function(){var t=this,e=arguments.length<=0||void 0===arguments[0]||arguments[0];!1!==this.options.addTargetClasses&&d(this.target,this.getClass("enabled")),d(this.element,this.getClass("enabled")),this.enabled=!0,this.scrollParents.forEach(function(e){e!==t.target.ownerDocument&&e.addEventListener("scroll",t.position)}),e&&this.position()}},{key:"disable",value:function(){var t=this;f(this.target,this.getClass("enabled")),f(this.element,this.getClass("enabled")),this.enabled=!1,void 0!==this.scrollParents&&this.scrollParents.forEach(function(e){e.removeEventListener("scroll",t.position)})}},{key:"destroy",value:function(){var t=this;this.disable(),M.forEach(function(e,n){e===t&&M.splice(n,1)}),0===M.length&&a()}},{key:"updateAttachClasses",value:function(t,e){var n=this;t=t||this.attachment,e=e||this.targetAttachment;var i=["left","top","bottom","right","middle","center"];void 0!==this._addAttachClasses&&this._addAttachClasses.length&&this._addAttachClasses.splice(0,this._addAttachClasses.length),void 0===this._addAttachClasses&&(this._addAttachClasses=[]);var r=this._addAttachClasses;t.top&&r.push(this.getClass("element-attached")+"-"+t.top),t.left&&r.push(this.getClass("element-attached")+"-"+t.left),e.top&&r.push(this.getClass("target-attached")+"-"+e.top),e.left&&r.push(this.getClass("target-attached")+"-"+e.left);var o=[];i.forEach(function(t){o.push(n.getClass("element-attached")+"-"+t),o.push(n.getClass("target-attached")+"-"+t)}),P(function(){void 0!==n._addAttachClasses&&(g(n.element,n._addAttachClasses,o),!1!==n.options.addTargetClasses&&g(n.target,n._addAttachClasses,o),delete n._addAttachClasses)})}},{key:"position",value:function(){var t=this,e=arguments.length<=0||void 0===arguments[0]||arguments[0];if(this.enabled){this.clearCache();var n=H(this.targetAttachment,this.attachment);this.updateAttachClasses(this.attachment,n);var i=this.cache("element-bounds",function(){return s(t.element)}),r=i.width,o=i.height;if(0===r&&0===o&&void 0!==this.lastSize){var a=this.lastSize;r=a.width,o=a.height}else this.lastSize={width:r,height:o};var l=this.cache("target-bounds",function(){return t.getTargetBounds()}),f=l,d=T(G(this.attachment),{width:r,height:o}),p=T(G(n),f),h=T(this.offset,{width:r,height:o}),v=T(this.targetOffset,f);d=_(d,h),p=_(p,v);for(var g=l.left+p.left-d.left,m=l.top+p.top-d.top,y=0;y<R.modules.length;++y){var b=R.modules[y],E=b.position.call(this,{left:g,top:m,targetAttachment:n,targetPos:l,elementPos:i,offset:d,targetOffset:p,manualOffset:h,manualTargetOffset:v,scrollbarSize:O,attachment:this.attachment});if(!1===E)return!1;void 0!==E&&"object"==typeof E&&(m=E.top,g=E.left)}var I={page:{top:m,left:g},viewport:{top:m-pageYOffset,bottom:pageYOffset-m-o+innerHeight,left:g-pageXOffset,right:pageXOffset-g-r+innerWidth}},S=this.target.ownerDocument,A=S.defaultView,O=void 0;return A.innerHeight>S.documentElement.clientHeight&&(O=this.cache("scrollbar-size",c),I.viewport.bottom-=O.height),A.innerWidth>S.documentElement.clientWidth&&(O=this.cache("scrollbar-size",c),I.viewport.right-=O.width),-1!==["","static"].indexOf(S.body.style.position)&&-1!==["","static"].indexOf(S.body.parentElement.style.position)||(I.page.bottom=S.body.scrollHeight-m-o,I.page.right=S.body.scrollWidth-g-r),void 0!==this.options.optimizations&&!1!==this.options.optimizations.moveElement&&void 0===this.targetModifier&&function(){var e=t.cache("target-offsetparent",function(){return u(t.target)}),n=t.cache("target-offsetparent-bounds",function(){return s(e)}),i=getComputedStyle(e),r=n,o={};if(["Top","Left","Bottom","Right"].forEach(function(t){o[t.toLowerCase()]=parseFloat(i["border"+t+"Width"])}),n.right=S.body.scrollWidth-n.left-r.width+o.right,n.bottom=S.body.scrollHeight-n.top-r.height+o.bottom,I.page.top>=n.top+o.top&&I.page.bottom>=n.bottom&&I.page.left>=n.left+o.left&&I.page.right>=n.right){var a=e.scrollTop,c=e.scrollLeft;I.offset={top:I.page.top-n.top+a-o.top,left:I.page.left-n.left+c-o.left}}}(),this.move(I),this.history.unshift(I),this.history.length>3&&this.history.pop(),e&&N(),!0}}},{key:"move",value:function(t){var e=this;if(void 0!==this.element.parentNode){var n={};for(var i in t){n[i]={};for(var r in t[i]){for(var o=!1,a=0;a<this.history.length;++a){var s=this.history[a];if(void 0!==s[i]&&!y(s[i][r],t[i][r])){o=!0;break}}o||(n[i][r]=!0)}}var c={top:"",left:"",right:"",bottom:""},f=function(t,n){if(!1!==(void 0!==e.options.optimizations?e.options.optimizations.gpu:null)){var i=void 0,r=void 0;t.top?(c.top=0,i=n.top):(c.bottom=0,i=-n.bottom),t.left?(c.left=0,r=n.left):(c.right=0,r=-n.right),window.matchMedia&&(window.matchMedia("only screen and (min-resolution: 1.3dppx)").matches||window.matchMedia("only screen and (-webkit-min-device-pixel-ratio: 1.3)").matches||(r=Math.round(r),i=Math.round(i))),c[j]="translateX("+r+"px) translateY("+i+"px)","msTransform"!==j&&(c[j]+=" translateZ(0)")}else t.top?c.top=n.top+"px":c.bottom=n.bottom+"px",t.left?c.left=n.left+"px":c.right=n.right+"px"},d=!1;if((n.page.top||n.page.bottom)&&(n.page.left||n.page.right)?(c.position="absolute",f(n.page,t.page)):(n.viewport.top||n.viewport.bottom)&&(n.viewport.left||n.viewport.right)?(c.position="fixed",f(n.viewport,t.viewport)):void 0!==n.offset&&n.offset.top&&n.offset.left?function(){c.position="absolute";var i=e.cache("target-offsetparent",function(){return u(e.target)});u(e.element)!==i&&P(function(){e.element.parentNode.removeChild(e.element),i.appendChild(e.element)}),f(n.offset,t.offset),d=!0}():(c.position="absolute",f({top:!0,left:!0},t.page)),!d)if(this.options.bodyElement)this.options.bodyElement.appendChild(this.element);else{for(var p=!0,h=this.element.parentNode;h&&1===h.nodeType&&"BODY"!==h.tagName;){if("static"!==getComputedStyle(h).position){p=!1;break}h=h.parentNode}p||(this.element.parentNode.removeChild(this.element),this.element.ownerDocument.body.appendChild(this.element))}var v={},g=!1;for(var r in c){var m=c[r];this.element.style[r]!==m&&(g=!0,v[r]=m)}g&&P(function(){l(e.element.style,v),e.trigger("repositioned")})}}}]),e}(C);$.modules=[],R.position=F;var q=l($,R),D=function(){function t(t,e){var n=[],i=!0,r=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(i=(a=s.next()).done)&&(n.push(a.value),!e||n.length!==e);i=!0);}catch(t){r=!0,o=t}finally{try{!i&&s.return&&s.return()}finally{if(r)throw o}}return n}return function(e,n){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),k=R.Utils,s=k.getBounds,l=k.extend,g=k.updateClasses,P=k.defer,z=["left","top","right","bottom"];R.modules.push({position:function(t){var e=this,n=t.top,i=t.left,r=t.targetAttachment;if(!this.options.constraints)return!0;var o=this.cache("element-bounds",function(){return s(e.element)}),a=o.height,u=o.width;if(0===u&&0===a&&void 0!==this.lastSize){var c=this.lastSize;u=c.width,a=c.height}var f=this.cache("target-bounds",function(){return e.getTargetBounds()}),d=f.height,p=f.width,h=[this.getClass("pinned"),this.getClass("out-of-bounds")];this.options.constraints.forEach(function(t){var e=t.outOfBoundsClass,n=t.pinnedClass;e&&h.push(e),n&&h.push(n)}),h.forEach(function(t){["left","top","right","bottom"].forEach(function(e){h.push(t+"-"+e)})});var v=[],m=l({},r),y=l({},this.attachment);return this.options.constraints.forEach(function(t){var o=t.to,s=t.attachment,c=t.pin;void 0===s&&(s="");var l=void 0,f=void 0;if(s.indexOf(" ")>=0){var h=s.split(" "),g=D(h,2);f=g[0],l=g[1]}else l=f=s;var b=E(e,o);"target"!==f&&"both"!==f||(n<b[1]&&"top"===m.top&&(n+=d,m.top="bottom"),n+a>b[3]&&"bottom"===m.top&&(n-=d,m.top="top")),"together"===f&&("top"===m.top&&("bottom"===y.top&&n<b[1]?(n+=d,m.top="bottom",n+=a,y.top="top"):"top"===y.top&&n+a>b[3]&&n-(a-d)>=b[1]&&(n-=a-d,m.top="bottom",y.top="bottom")),"bottom"===m.top&&("top"===y.top&&n+a>b[3]?(n-=d,m.top="top",n-=a,y.top="bottom"):"bottom"===y.top&&n<b[1]&&n+(2*a-d)<=b[3]&&(n+=a-d,m.top="top",y.top="top")),"middle"===m.top&&(n+a>b[3]&&"top"===y.top?(n-=a,y.top="bottom"):n<b[1]&&"bottom"===y.top&&(n+=a,y.top="top"))),"target"!==l&&"both"!==l||(i<b[0]&&"left"===m.left&&(i+=p,m.left="right"),i+u>b[2]&&"right"===m.left&&(i-=p,m.left="left")),"together"===l&&(i<b[0]&&"left"===m.left?"right"===y.left?(i+=p,m.left="right",i+=u,y.left="left"):"left"===y.left&&(i+=p,m.left="right",i-=u,y.left="right"):i+u>b[2]&&"right"===m.left?"left"===y.left?(i-=p,m.left="left",i-=u,y.left="right"):"right"===y.left&&(i-=p,m.left="left",i+=u,y.left="left"):"center"===m.left&&(i+u>b[2]&&"left"===y.left?(i-=u,y.left="right"):i<b[0]&&"right"===y.left&&(i+=u,y.left="left"))),"element"!==f&&"both"!==f||(n<b[1]&&"bottom"===y.top&&(n+=a,y.top="top"),n+a>b[3]&&"top"===y.top&&(n-=a,y.top="bottom")),"element"!==l&&"both"!==l||(i<b[0]&&("right"===y.left?(i+=u,y.left="left"):"center"===y.left&&(i+=u/2,y.left="left")),i+u>b[2]&&("left"===y.left?(i-=u,y.left="right"):"center"===y.left&&(i-=u/2,y.left="right"))),"string"==typeof c?c=c.split(",").map(function(t){return t.trim()}):!0===c&&(c=["top","left","right","bottom"]),c=c||[];var _=[],T=[];n<b[1]&&(c.indexOf("top")>=0?(n=b[1],_.push("top")):T.push("top")),n+a>b[3]&&(c.indexOf("bottom")>=0?(n=b[3]-a,_.push("bottom")):T.push("bottom")),i<b[0]&&(c.indexOf("left")>=0?(i=b[0],_.push("left")):T.push("left")),i+u>b[2]&&(c.indexOf("right")>=0?(i=b[2]-u,_.push("right")):T.push("right")),_.length&&function(){var t=void 0;t=void 0!==e.options.pinnedClass?e.options.pinnedClass:e.getClass("pinned"),v.push(t),_.forEach(function(e){v.push(t+"-"+e)})}(),T.length&&function(){var t=void 0;t=void 0!==e.options.outOfBoundsClass?e.options.outOfBoundsClass:e.getClass("out-of-bounds"),v.push(t),T.forEach(function(e){v.push(t+"-"+e)})}(),(_.indexOf("left")>=0||_.indexOf("right")>=0)&&(y.left=m.left=!1),(_.indexOf("top")>=0||_.indexOf("bottom")>=0)&&(y.top=m.top=!1),m.top===r.top&&m.left===r.left&&y.top===e.attachment.top&&y.left===e.attachment.left||(e.updateAttachClasses(y,m),e.trigger("update",{attachment:y,targetAttachment:m}))}),P(function(){!1!==e.options.addTargetClasses&&g(e.target,v,h),g(e.element,v,h)}),{top:n,left:i}}});var k=R.Utils,s=k.getBounds,g=k.updateClasses,P=k.defer;R.modules.push({position:function(t){var e=this,n=t.top,i=t.left,r=this.cache("element-bounds",function(){return s(e.element)}),o=r.height,a=r.width,u=this.getTargetBounds(),c=n+o,l=i+a,f=[];n<=u.bottom&&c>=u.top&&["left","right"].forEach(function(t){var e=u[t];e!==i&&e!==l||f.push(t)}),i<=u.right&&l>=u.left&&["top","bottom"].forEach(function(t){var e=u[t];e!==n&&e!==c||f.push(t)});var d=[],p=[],h=["left","top","right","bottom"];return d.push(this.getClass("abutted")),h.forEach(function(t){d.push(e.getClass("abutted")+"-"+t)}),f.length&&p.push(this.getClass("abutted")),f.forEach(function(t){p.push(e.getClass("abutted")+"-"+t)}),P(function(){!1!==e.options.addTargetClasses&&g(e.target,p,d),g(e.element,p,d)}),!0}});var D=function(){function t(t,e){var n=[],i=!0,r=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(i=(a=s.next()).done)&&(n.push(a.value),!e||n.length!==e);i=!0);}catch(t){r=!0,o=t}finally{try{!i&&s.return&&s.return()}finally{if(r)throw o}}return n}return function(e,n){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();return R.modules.push({position:function(t){var e=t.top,n=t.left;if(this.options.shift){var i=this.options.shift;"function"==typeof this.options.shift&&(i=this.options.shift.call(this,{top:e,left:n}));var r=void 0,o=void 0;if("string"==typeof i){i=i.split(" "),i[1]=i[1]||i[0];var a=i,s=D(a,2);r=s[0],o=s[1],r=parseFloat(r,10),o=parseFloat(o,10)}else r=i.top,o=i.left;return e+=r,n+=o,{top:e,left:n}}}}),q})},32:function(t,e,n){function i(t,e,n,i,r){function c(n){var r=s.parse(n,!0),a=o.parseInt(t.viewIndex);i.sendToBackground("tabs.CurrentTabId").then(function(n){return o.extend(r.query,{readcubeId:t.viewModel.id,tabId:n,articleIndex:a||0}),e.openTab(s.format(r)),!0}).catch(function(){return e.openTab(s.format(r)),!1})}function l(t){e.openTab(u(a.URL_DOI_RESOLVER,t))}function f(t,i){n.getInstitutionProxy().then(function(n){var r=s.parse(t,!0);o.extend(r.query,{readcubeId:i.id}),e.openTab(n.replace(a.EZPROXY_URL_REPLACE_KEY,s.format(r)))})}function d(e){t.viewModel&&r.downloadPdf(t.viewModel,e)}function p(){e.openTab(a.URL_ACCOUNT)}function h(){e.openTab(a.URL_GET_TRIAL)}function v(){return a.URL_ACCOUNT}t.onOpenLinkClick=c,t.onLoginWithProxyClick=f,t.onDownloadPdfClick=d,t.onOpenDoiClick=l,t.onOpenAccountClick=p,t.onGetTrialClick=h,t.getAccountLink=v,t.proxyIsNotAvailable=!1,t.pdfUrlsAvailable=!1,t.searchingPdfUrls=!1,t.institutionName=null,t.sfxUrl=null,t.pdfUrls=[],n.getInstitutionProxy().catch(function(){t.proxyIsNotAvailable=!0});var g=t.viewModel;g&&(g.doi||g.pmid)&&n.getSfxUrlByDoiAndPmid(g.doi,g.pmid).then(function(e){t.sfxUrl=e}),n.evaluateLoggedInUserDetail().then(function(e){t.institutionName=o.get(e,"institution",null)});var m=t.$watch("viewVisibility.visible",function(e){if(e&&t.viewModel&&t.viewModel.isPdfDownloadFailed()){t.searchingPdfUrls=!0;var n=o.get(t.viewModel,"metadata.title");n&&(t.pdfUrlsAvailable=!0,i.sendToBackground("request.GetPdfUrlsFromGoogleScholar",n).then(function(e){Array.isArray(e)&&e.length>0?t.pdfUrls=e:t.pdfUrlsAvailable=!1,t.searchingPdfUrls=!1})),m()}})}i.$inject=["$scope","BrowserTab","User","Message","TooltipApi"];var r=n(2),o=n(1),a=n(0),s=n(9),u=n(5).sprintf;r.module("App").controller("PdfWarning",i)},33:function(t,e,n){function i(t){return{restrict:"E",transclude:"element",replace:!0,scope:{viewVisibility:"="},link:function(e,n,i,r,u){e.viewVisibility||(e.viewVisibility={visible:!1});var c=s.extend(t.getOptions(),s.pick(i,["parentSelector","attachment","targetAttachment","targetOffset"])),l=null,f=null,d=null;u(function(t,e){f=a(t[0]).addClass("readcube-tooltip-container").appendTo(a("body")),d=e,l=new o({element:f.get(0),target:a(n).parents(c.parentSelector).get(0),attachment:c.attachment,targetAttachment:c.targetAttachment,targetOffset:c.targetOffset,constraints:c.constraints})}),e.$watch("viewVisibility.visible",function(t){f&&f.toggleClass("readcube-tooltip-hidden",!t)}),e.$on("$destroy",function(){l&&l.destroy(),f&&f.remove(),d&&d.$destroy()});var p=!1;e.$watch(function(){p||(p=!0,e.$$postDigest(function(){p=!1,l.position()}))})}}}i.$inject=["tetherTooltipConfig"];var r=n(2),o=n(31),a=n(4),s=n(1);r.module("App").directive("tetherTooltip",i)},34:function(t,e,n){function i(){this.config={parentSelector:".readcube-button-holder:first",attachment:"bottom center",targetAttachment:"top center",targetOffset:"-6px 0",constraints:[{to:"scrollParent"}]},this.setOptions=function(t){o.extend(this.config,t)},this.getOptions=function(){return this.config},this.$get=function(){return this}}var r=n(2),o=n(1);r.module("App").provider("tetherTooltipConfig",i)},35:function(t,e,n){function i(){return{restrict:"E",templateUrl:"tooltip/index",replace:!0,scope:{side:"@",viewModel:"=",viewVisibility:"=",viewText:"@",viewUrl:"@",viewIndex:"@",viewClass:"@",viewClose:"@",viewRetry:"@",viewRetryMethod:"&"},link:function(t,e,n){function i(e){e.stopPropagation(),t.viewVisibility.visible=!1}function r(e){"function"==typeof t.viewRetryMethod&&t.viewRetryMethod()}t.onCloseTooltipClick=i,t.onRetryClick=r,t.viewVisibility||(t.viewVisibility={visible:!1})}}}n(2).module("App").directive("tooltip",i)},36:function(t,e,n){function i(t,e){return{openLibrary:function(){return e.sendToBackground("tabs.OpenLibrary",null)},openItemInLibrary:function(t,n){return e.sendToBackground("tabs.OpenItemInLibrary",{itemId:t,collectionId:n})},openDocumentInLibrary:function(e,n){return t.open(a(o.URL_LIBRARY_DOCUMENT,e,n))},openTab:function(e){return t.open(e)},openOptions:function(){chrome.tabs.create({url:"options.html"})}}}i.$inject=["$window","Message"];var r=n(2),o=n(0),a=n(5).sprintf;r.module("App").factory("BrowserTab",i)},37:function(t,e,n){function i(t){return{connectWithBackground:function(e,n){var i=t.defer(),r=chrome.runtime.connect({name:"readcube-extension-connection"}),a=!1;return r.postMessage({message:o.MESSAGE_START,data:n,method:e}),r.onMessage.addListener(function(t){t.message==o.MESSAGE_FINISH?(i.resolve(t.data),a=!0):t.message==o.MESSAGE_PROGRESS&&i.notify(t.data)}),r.onDisconnect.addListener(function(){a||i.resolve(null)}),i.promise}}}i.$inject=["$q"];var r=n(2),o=n(0);r.module("App").factory("Connection",i)},38:function(t,e,n){function i(t){return{getUploadPromise:function(e,n){var i=new XMLHttpRequest,r=t.defer();return i.upload.addEventListener("progress",function(t){t.lengthComputable?r.notify(parseInt(t.loaded/t.total*100)):r.notify(50)}),i.onreadystatechange=function(t){4==t.target.readyState&&(200==t.target.status?r.resolve(t.target):r.reject(t.target))},i.open("PUT",e,!0),i.setRequestHeader("Content-Type","application/pdf"),i.send(n),r.promise}}}i.$inject=["$q"],n(2).module("App").factory("FileRequest",i)},39:function(t,e,n){function i(t){var e=t.navigator.onLine;return t.addEventListener("offline",function(){e=!1}),t.addEventListener("online",function(){e=!0}),{isOnline:function(){return e},isOffline:function(){return!e}}}i.$inject=["$window"],n(2).module("App").factory("OnlineStatus",i)},40:function(t,e,n){function i(t,e){return{status:function(t){if(t.ext_ids.length>100){idsCopy=[].concat(t.ext_ids);var n=idsCopy.splice(0,100);return e.all({statuses:s.post(o.URL_ARTICLES_STATUS,{ext_ids:n}),others:s.post(o.URL_ARTICLES_STATUS,{ext_ids:idsCopy})}).then(function(t){var e=u.get(t,"statuses.data.items",[]),n=u.get(t,"others.data.items",[]);return t.statuses.data.items=e.concat(n),t.statuses})}return s.post(o.URL_ARTICLES_STATUS,t)},updateStatusForArticle:function(t){return this.status({ext_ids:[t.getIdentifiers()]}).then(function(e){var n=u.get(e,"data.items[0]",null);n&&(t.collections=n.collections,t.collection_id=n.collection_id,t.hasPdf=n.has_file,t.id=n.id)})},metadata:function(t){return s.post(o.URL_ARTICLES_METADATA,t)},getStatusWithMetadata:function(t){var n={ext_ids:t};return e.all({articlesStatus:this.status(n),articlesMetadata:this.metadata(n)}).then(function(n){var i=u.get(n,"articlesStatus.data.items",[]),r=u.get(n,"articlesMetadata.data",[]);return 0==i.length?e.reject("No items in the response"):0==r.length?i:(t.forEach(function(t,e){var n=u.find(r,function(e){if(t.doi&&e.doi){if(t.doi.toLowerCase()==e.doi.toLowerCase())return!0}return!(!t.pmid||e.pmid!=t.pmid)||!(!t.gsid||e.gsid!=t.gsid)});n&&u.extend(i[e],{pdfUrl:u.get(n,"pdf_urls[0]",null),pdfHash:u.get(n,"hash",null),url:u.get(n,"url",null)})}),i)})},add:function(t){return s.post(o.URL_ADD_ARTICLE,t)},addWithMetadata:function(t){return s.post(o.URL_ADD_ARTICLE_METADATA,t)},update:function(t,e,n){return s.patch(a(o.URL_COLLECTION_ARTICLE,e,t),n)},get:function(t){return s.get(a(o.URL_ARTICLE_GET,t))}}}i.$inject=["$http","$q"];var r=n(2),o=n(0),a=n(5).sprintf,s=n(7),u=n(1);r.module("App").factory("Article",i)},42:function(t,e,n){function i(t,e,n,i){return l(t,{getArticlePdfResolvePromise:function(t){function i(){s--,r.getArticleIdFromFileHash(t).then(function(t){n.cancel(u),a.resolve(t),r.article.extend({id:t,inLibraryStatus:o.STATUS_IN_LIBRARY_WITH_PDF})}),0==s&&(n.cancel(u),a.reject("The PDF was not resolved during 1 minute"),r.article.inLibraryStatus=o.STATUS_PDF_RESOLVE_WARNING)}var r=this,a=e.defer(),s=10;r.article.inLibraryStatus=o.STATUS_PDF_RESOLVING,i();var u=n(i,6e3);return a.promise},getArticleIdFromFileHash:function(t){return c.get(a(o.URL_FILES,t)).then(function(t){var n=s.chain(t).get("data.items",[]).compact().get("[0]",null).value();return n||e.reject("Article id not found")})},upload:function(){var t=this;return t.article.extend({progressPercent:0,progressType:o.PROGRESS_DOWNLOAD,inLibraryStatus:o.STATUS_PDF_DOWNLOADING,usingPdfUrl:t.article.pdfUrl}),e.when(function(){return t.article.pdfUrl?t.getDownloadPromise({url:t.article.pdfUrl,isProxied:!1}):e.reject("Pdf url not available")}()).catch(function(n){return t.article.inLibraryStatus=o.STATUS_IN_LIBRARY_WITHOUT_PDF_WARNING,e.reject(n)}).then(function(n){return t.getArticleIdFromFileHash(n.sha256Hash).then(function(e){return t.article.id=e,t.article.inLibraryStatus=o.STATUS_IN_LIBRARY_WITH_PDF,e}).catch(function(i){if(i.status==u.UNAUTHORIZED)return t.article.inLibraryStatus=o.STATUS_NOT_LOGGED_IN,e.reject(i);var r="";t.article.pdfUrl&&t.article.pdfUrl.length&&(r=encodeURIComponent(t.article.pdfUrl.substring(0,500))),t.article.progressPercent=0,t.article.progressType=o.PROGRESS_UPLOAD;var l,f=t.fixPdfFilename(n.fileName);return l=t.article.collection_id&&t.article.id?a(o.URL_UPLOAD,t.article.collection_id,"false",n.sha256Hash,"","",n.fileSize,t.article.id,encodeURIComponent(f),r):a(o.URL_UPLOAD_DEFAULT,t.article.id?"false":"true",n.sha256Hash,"","",n.fileSize,t.article.id?t.article.id:"",encodeURIComponent(f),r),c.get(l).then(function(i){var r=s.get(i,"data.url");return r?t.getUploadPromise(r,n.blob):e.reject("Unable to receive the upload url")}).then(null,null,function(e){t.article.progressPercent=e}).catch(function(e){return t.evaluateUploadError(e,o.STATUS_IN_LIBRARY_WITHOUT_PDF_WARNING)}).then(function(){return t.article.id?(t.article.inLibraryStatus=o.STATUS_IN_LIBRARY_WITH_PDF,!0):t.getArticlePdfResolvePromise(n.sha256Hash)})})})}})}i.$inject=["Upload","$q","$interval","$http"];var r=n(2),o=n(0),a=n(5).sprintf,s=n(1),u=n(11),c=n(7),l=n(3);r.module("App").factory("RawUpload",i)},43:function(t,e,n){function i(t,e,n){return a({__constructor:function(t){this.article=t},getUploadPromise:function(e,n){var i=new XMLHttpRequest,r=t.defer();return i.upload.addEventListener("progress",function(t){t.lengthComputable?r.notify(parseInt(t.loaded/t.total*100)):r.notify(50)}),i.onreadystatechange=function(t){4==t.target.readyState&&(200==t.target.status?r.resolve(t.target):r.reject(t.target))},i.open("PUT",e,!0),i.setRequestHeader("Content-Type","application/pdf"),i.send(n),r.promise},getDownloadPromise:function(n){var i=this;return n.url?e.connectWithBackground("request.GetPdfBase64",n).then(function(e){return e&&e.base64&&e.sha256Hash?{blob:o.toBlob(e.base64),sha256Hash:e.sha256Hash,fileSize:e.fileSize,fileName:e.fileName}:t.reject("No PDF file was found")},null,function(t){i.article.progressPercent=t.percent}):t.reject("No PDF url provided")},upload:function(){throw new Error("Method not implemented")},evaluateUploadError:function(e,i){var r=this;return e.status===s.UNPROCESSABLE_ENTITY?e:e.status===s.FORBIDDEN?n.getSubscriptionStatus().then(function(e){switch(e){case u.SUBSCRIPTION_TRIAL_EXPIRED:return r.article.inLibraryStatus=u.STATUS_IN_LIBRARY_WITHOUT_PDF_EXPIRED_TRIAL,t.reject("Unable to add pdf because the trial period is expired");case u.SUBSCRIPTION_PRO_EXPIRED:return r.article.inLibraryStatus=u.STATUS_IN_LIBRARY_WITHOUT_PDF_EXPIRED_SUBSCRIPTION,t.reject("Unable to add pdf because the subscription is expired");default:return r.article.inLibraryStatus=u.STATUS_IN_LIBRARY_WITHOUT_PDF_NO_SUBSCRIPTION,t.reject("Unable to add pdf because the account is without subscription")}}):(i&&(r.article.inLibraryStatus=i),t.reject(e))},fixPdfFilename:function(t){if(t)return t;var e=c.get(this.article,"metadata.title",""),n=(new Date).toLocaleString();return e?e+".pdf":this.article.usingPdfUrl?l.getHostnameFromUrl(this.article.usingPdfUrl)+" "+n+".pdf":n+".pdf"}})}i.$inject=["$q","Connection","User"];var r=n(2),o=n(25),a=n(3),s=n(11),u=n(0),c=n(1),l=n(13);r.module("App").factory("Upload",i)},44:function(t,e,n){function i(){return{downloadPdf:function(t,e){this.article=t,this.pdfUrl=e,++this.messageCount},article:null,pdfUrl:null,messageCount:0}}n(2).module("App").factory("TooltipApi",i)},45:function(t,e,n){var i=n(8);e.sendToTabById=function(t,e){var n=i.defer();return t?chrome.tabs.sendMessage(t,e,n.resolve):n.reject("No tab id was provided"),n.promise},e.sendToBackground=function(t,e){var n=i.defer();return chrome.runtime.sendMessage({method:t,data:e},function(t){n.resolve(t)}),n.promise},e.getActiveTabId=function(){var t=i.defer();return chrome.tabs.query({active:!0,currentWindow:!0},function(e){if(0==e.length)return void t.reject("No active tabs were found");t.resolve(e[0].id)}),t.promise}},7:function(t,e,n){function i(t,e,n,i,a){var s=r.defer(),u=new XMLHttpRequest;return u.open(e,t,!0),u.onload=function(){u.status>=200&&u.status<400?s.resolve({data:i?u.responseText:JSON.parse(u.responseText),status:u.status,url:u.responseURL}):s.reject({status:u.status})},u.onerror=function(){s.reject("Error in xhr."+e)},o.isReadcubeUrl(t)&&c.forEach(function(t){u.setRequestHeader(t[0],t[1])}),a&&u.setRequestHeader("Accept",a),n?(u.setRequestHeader("Content-Type","application/json; charset=UTF-8"),u.send(JSON.stringify(n))):u.send(),s.promise}var r=n(8),o=n(13),a=n(5).sprintf,s=n(0),u=chrome.runtime.getManifest().version,c=[["Sync-Version",s.HEADER_SYNC_VERSION],["X-Readcube-Sync-Token",a(s.HEADER_VALUE_SYNC_TOKEN,u)],["X-Readcube-Sync-Client",a(s.HEADER_VALUE_SYNC_CLIENT,"chrome",u)]];!function(){var t}();t.exports={get:function(t,e,n){return i(t,"GET",null,e,n)},patch:function(t,e){return i(t,"PATCH",e)},delete:function(t){return i(t,"DELETE")},post:function(t,e){return i(t,"POST",e)}}},8:function(t,e,n){(function(e,n){/*!
 *
 * Copyright 2009-2012 Kris Kowal under the terms of the MIT
 * license found at http://github.com/kriskowal/q/raw/master/LICENSE
 *
 * With parts by Tyler Close
 * Copyright 2007-2009 Tyler Close under the terms of the MIT X license found
 * at http://www.opensource.org/licenses/mit-license.html
 * Forked at ref_send.js version: 2009-05-11
 *
 * With parts by Mark Miller
 * Copyright (C) 2011 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 */
!function(e){"use strict";if("function"==typeof bootstrap)bootstrap("promise",e);else{t.exports=e()}}(function(){"use strict";function t(t){return function(){return q.apply(t,arguments)}}function i(t){return t===Object(t)}function r(t){return"[object StopIteration]"===nt(t)||t instanceof G}function o(t,e){if(Y&&e.stack&&"object"==typeof t&&null!==t&&t.stack&&-1===t.stack.indexOf(it)){for(var n=[],i=e;i;i=i.source)i.stack&&n.unshift(i.stack);n.unshift(t.stack);var r=n.join("\n"+it+"\n");t.stack=a(r)}}function a(t){for(var e=t.split("\n"),n=[],i=0;i<e.length;++i){var r=e[i];c(r)||s(r)||!r||n.push(r)}return n.join("\n")}function s(t){return-1!==t.indexOf("(module.js:")||-1!==t.indexOf("(node.js:")}function u(t){var e=/at .+ \((.+):(\d+):(?:\d+)\)$/.exec(t);if(e)return[e[1],Number(e[2])];var n=/at ([^ ]+):(\d+):(?:\d+)$/.exec(t);if(n)return[n[1],Number(n[2])];var i=/.*@(.+):(\d+)$/.exec(t);return i?[i[1],Number(i[2])]:void 0}function c(t){var e=u(t);if(!e)return!1;var n=e[0],i=e[1];return n===H&&i>=X&&i<=ut}function l(){if(Y)try{throw new Error}catch(i){var t=i.stack.split("\n"),e=t[0].indexOf("@")>0?t[1]:t[2],n=u(e);if(!n)return;return H=n[0],n[1]}}function f(t){return t instanceof v?t:b(t)?w(t):O(t)}function d(){function t(t){e=t,o.source=t,Q(n,function(e,n){f.nextTick(function(){t.promiseDispatch.apply(t,n)})},void 0),n=void 0,i=void 0}var e,n=[],i=[],r=Z(d.prototype),o=Z(v.prototype);if(o.promiseDispatch=function(t,r,o){var a=z(arguments);n?(n.push(a),"when"===r&&o[1]&&i.push(o[1])):f.nextTick(function(){e.promiseDispatch.apply(e,a)})},o.valueOf=function(){if(n)return o;var t=m(e);return y(t)&&(e=t),t},o.inspect=function(){return e?e.inspect():{state:"pending"}},f.longStackSupport&&Y)try{throw new Error}catch(t){o.stack=t.stack.substring(t.stack.indexOf("\n")+1)}return r.promise=o,r.resolve=function(n){e||t(f(n))},r.fulfill=function(n){e||t(O(n))},r.reject=function(n){e||t(A(n))},r.notify=function(t){e||Q(i,function(e,n){f.nextTick(function(){n(t)})},void 0)},r}function p(t){if("function"!=typeof t)throw new TypeError("resolver must be a function.");var e=d();try{t(e.resolve,e.reject,e.notify)}catch(t){e.reject(t)}return e.promise}function h(t){return p(function(e,n){for(var i=0,r=t.length;i<r;i++)f(t[i]).then(e,n)})}function v(t,e,n){void 0===e&&(e=function(t){return A(new Error("Promise does not support operation: "+t))}),void 0===n&&(n=function(){return{state:"unknown"}});var i=Z(v.prototype);if(i.promiseDispatch=function(n,r,o){var a;try{a=t[r]?t[r].apply(i,o):e.call(i,r,o)}catch(t){a=A(t)}n&&n(a)},i.inspect=n,n){var r=n();"rejected"===r.state&&(i.exception=r.reason),i.valueOf=function(){var t=n();return"pending"===t.state||"rejected"===t.state?i:t.value}}return i}function g(t,e,n,i){return f(t).then(e,n,i)}function m(t){if(y(t)){var e=t.inspect();if("fulfilled"===e.state)return e.value}return t}function y(t){return t instanceof v}function b(t){return i(t)&&"function"==typeof t.then}function _(t){return y(t)&&"pending"===t.inspect().state}function T(t){return!y(t)||"fulfilled"===t.inspect().state}function E(t){return y(t)&&"rejected"===t.inspect().state}function I(){rt.length=0,ot.length=0,st||(st=!0)}function R(t,n){st&&("object"==typeof e&&"function"==typeof e.emit&&f.nextTick.runAfter(function(){-1!==K(ot,t)&&(e.emit("unhandledRejection",n,t),at.push(t))}),ot.push(t),n&&void 0!==n.stack?rt.push(n.stack):rt.push("(no stack) "+n))}function S(t){if(st){var n=K(ot,t);-1!==n&&("object"==typeof e&&"function"==typeof e.emit&&f.nextTick.runAfter(function(){var i=K(at,t);-1!==i&&(e.emit("rejectionHandled",rt[n],t),at.splice(i,1))}),ot.splice(n,1),rt.splice(n,1))}}function A(t){var e=v({when:function(e){return e&&S(this),e?e(t):this}},function(){return this},function(){return{state:"rejected",reason:t}});return R(e,t),e}function O(t){return v({when:function(){return t},get:function(e){return t[e]},set:function(e,n){t[e]=n},delete:function(e){delete t[e]},post:function(e,n){return null===e||void 0===e?t.apply(void 0,n):t[e].apply(t,n)},apply:function(e,n){return t.apply(e,n)},keys:function(){return et(t)}},void 0,function(){return{state:"fulfilled",value:t}})}function w(t){var e=d();return f.nextTick(function(){try{t.then(e.resolve,e.reject,e.notify)}catch(t){e.reject(t)}}),e.promise}function L(t){return v({isDef:function(){}},function(e,n){return x(t,e,n)},function(){return f(t).inspect()})}function U(t,e,n){return f(t).spread(e,n)}function P(t){return function(){function e(t,e){var a;if("undefined"==typeof StopIteration){try{a=n[t](e)}catch(t){return A(t)}return a.done?f(a.value):g(a.value,i,o)}try{a=n[t](e)}catch(t){return r(t)?f(t.value):A(t)}return g(a,i,o)}var n=t.apply(this,arguments),i=e.bind(e,"next"),o=e.bind(e,"throw");return i()}}function N(t){f.done(f.async(t)())}function C(t){throw new G(t)}function D(t){return function(){return U([this,k(arguments)],function(e,n){return t.apply(e,n)})}}function x(t,e,n){return f(t).dispatch(e,n)}function k(t){return g(t,function(t){var e=0,n=d();return Q(t,function(i,r,o){var a;y(r)&&"fulfilled"===(a=r.inspect()).state?t[o]=a.value:(++e,g(r,function(i){t[o]=i,0==--e&&n.resolve(t)},n.reject,function(t){n.notify({index:o,value:t})}))},void 0),0===e&&n.resolve(t),n.promise})}function j(t){if(0===t.length)return f.resolve();var e=f.defer(),n=0;return Q(t,function(i,r,o){function a(t){e.resolve(t)}function s(){0===--n&&e.reject(new Error("Can't get fulfillment value from any promise, all promises were rejected."))}function u(t){e.notify({index:o,value:t})}var c=t[o];n++,g(c,a,s,u)},void 0),e.promise}function M(t){return g(t,function(t){return t=J(t,f),g(k(J(t,function(t){return g(t,V,V)})),function(){return t})})}function F(t){return f(t).allSettled()}function B(t,e){return f(t).then(void 0,void 0,e)}function W(t,e){return f(t).nodeify(e)}var Y=!1;try{throw new Error}catch(t){Y=!!t.stack}var H,G,X=l(),V=function(){},$=function(){function t(){for(var t,e;r.next;)r=r.next,t=r.task,r.task=void 0,e=r.domain,e&&(r.domain=void 0,e.enter()),i(t,e);for(;c.length;)t=c.pop(),i(t);a=!1}function i(e,n){try{e()}catch(e){if(u)throw n&&n.exit(),setTimeout(t,0),n&&n.enter(),e;setTimeout(function(){throw e},0)}n&&n.exit()}var r={task:void 0,next:null},o=r,a=!1,s=void 0,u=!1,c=[];if($=function(t){o=o.next={task:t,domain:u&&e.domain,next:null},a||(a=!0,s())},"object"==typeof e&&"[object process]"===e.toString()&&e.nextTick)u=!0,s=function(){e.nextTick(t)};else if("function"==typeof n)s="undefined"!=typeof window?n.bind(window,t):function(){n(t)};else if("undefined"!=typeof MessageChannel){var l=new MessageChannel;l.port1.onmessage=function(){s=f,l.port1.onmessage=t,t()};var f=function(){l.port2.postMessage(0)};s=function(){setTimeout(t,0),f()}}else s=function(){setTimeout(t,0)};return $.runAfter=function(t){c.push(t),a||(a=!0,s())},$}(),q=Function.call,z=t(Array.prototype.slice),Q=t(Array.prototype.reduce||function(t,e){var n=0,i=this.length;if(1===arguments.length)for(;;){if(n in this){e=this[n++];break}if(++n>=i)throw new TypeError}for(;n<i;n++)n in this&&(e=t(e,this[n],n));return e}),K=t(Array.prototype.indexOf||function(t){for(var e=0;e<this.length;e++)if(this[e]===t)return e;return-1}),J=t(Array.prototype.map||function(t,e){var n=this,i=[];return Q(n,function(r,o,a){i.push(t.call(e,o,a,n))},void 0),i}),Z=Object.create||function(t){function e(){}return e.prototype=t,new e},tt=t(Object.prototype.hasOwnProperty),et=Object.keys||function(t){var e=[];for(var n in t)tt(t,n)&&e.push(n);return e},nt=t(Object.prototype.toString);G="undefined"!=typeof ReturnValue?ReturnValue:function(t){this.value=t};var it="From previous event:";f.resolve=f,f.nextTick=$,f.longStackSupport=!1,"object"==typeof e&&e&&e.env&&e.env.Q_DEBUG&&(f.longStackSupport=!0),f.defer=d,d.prototype.makeNodeResolver=function(){var t=this;return function(e,n){e?t.reject(e):arguments.length>2?t.resolve(z(arguments,1)):t.resolve(n)}},f.Promise=p,f.promise=p,p.race=h,p.all=k,p.reject=A,p.resolve=f,f.passByCopy=function(t){return t},v.prototype.passByCopy=function(){return this},f.join=function(t,e){return f(t).join(e)},v.prototype.join=function(t){return f([this,t]).spread(function(t,e){if(t===e)return t;throw new Error("Can't join: not the same: "+t+" "+e)})},f.race=h,v.prototype.race=function(){return this.then(f.race)},f.makePromise=v,v.prototype.toString=function(){return"[object Promise]"},v.prototype.then=function(t,e,n){function i(e){try{return"function"==typeof t?t(e):e}catch(t){return A(t)}}function r(t){if("function"==typeof e){o(t,s);try{return e(t)}catch(t){return A(t)}}return A(t)}function a(t){return"function"==typeof n?n(t):t}var s=this,u=d(),c=!1;return f.nextTick(function(){s.promiseDispatch(function(t){c||(c=!0,u.resolve(i(t)))},"when",[function(t){c||(c=!0,u.resolve(r(t)))}])}),s.promiseDispatch(void 0,"when",[void 0,function(t){var e,n=!1;try{e=a(t)}catch(t){if(n=!0,!f.onerror)throw t;f.onerror(t)}n||u.notify(e)}]),u.promise},f.tap=function(t,e){return f(t).tap(e)},v.prototype.tap=function(t){return t=f(t),this.then(function(e){return t.fcall(e).thenResolve(e)})},f.when=g,v.prototype.thenResolve=function(t){return this.then(function(){return t})},f.thenResolve=function(t,e){return f(t).thenResolve(e)},v.prototype.thenReject=function(t){return this.then(function(){throw t})},f.thenReject=function(t,e){return f(t).thenReject(e)},f.nearer=m,f.isPromise=y,f.isPromiseAlike=b,f.isPending=_,v.prototype.isPending=function(){return"pending"===this.inspect().state},f.isFulfilled=T,v.prototype.isFulfilled=function(){return"fulfilled"===this.inspect().state},f.isRejected=E,v.prototype.isRejected=function(){return"rejected"===this.inspect().state};var rt=[],ot=[],at=[],st=!0;f.resetUnhandledRejections=I,f.getUnhandledReasons=function(){return rt.slice()},f.stopUnhandledRejectionTracking=function(){I(),st=!1},I(),f.reject=A,f.fulfill=O,f.master=L,f.spread=U,v.prototype.spread=function(t,e){return this.all().then(function(e){return t.apply(void 0,e)},e)},f.async=P,f.spawn=N,f.return=C,f.promised=D,f.dispatch=x,v.prototype.dispatch=function(t,e){var n=this,i=d();return f.nextTick(function(){n.promiseDispatch(i.resolve,t,e)}),i.promise},f.get=function(t,e){return f(t).dispatch("get",[e])},v.prototype.get=function(t){return this.dispatch("get",[t])},f.set=function(t,e,n){return f(t).dispatch("set",[e,n])},v.prototype.set=function(t,e){return this.dispatch("set",[t,e])},f.del=f.delete=function(t,e){return f(t).dispatch("delete",[e])},v.prototype.del=v.prototype.delete=function(t){return this.dispatch("delete",[t])},f.mapply=f.post=function(t,e,n){return f(t).dispatch("post",[e,n])},v.prototype.mapply=v.prototype.post=function(t,e){return this.dispatch("post",[t,e])},f.send=f.mcall=f.invoke=function(t,e){return f(t).dispatch("post",[e,z(arguments,2)])},v.prototype.send=v.prototype.mcall=v.prototype.invoke=function(t){return this.dispatch("post",[t,z(arguments,1)])},f.fapply=function(t,e){return f(t).dispatch("apply",[void 0,e])},v.prototype.fapply=function(t){return this.dispatch("apply",[void 0,t])},f.try=f.fcall=function(t){return f(t).dispatch("apply",[void 0,z(arguments,1)])},v.prototype.fcall=function(){return this.dispatch("apply",[void 0,z(arguments)])},f.fbind=function(t){var e=f(t),n=z(arguments,1);return function(){return e.dispatch("apply",[this,n.concat(z(arguments))])}},v.prototype.fbind=function(){var t=this,e=z(arguments);return function(){return t.dispatch("apply",[this,e.concat(z(arguments))])}},f.keys=function(t){return f(t).dispatch("keys",[])},v.prototype.keys=function(){return this.dispatch("keys",[])},f.all=k,v.prototype.all=function(){return k(this)},f.any=j,v.prototype.any=function(){return j(this)},f.allResolved=function(t,e,n){return function(){return"undefined"!=typeof console&&"function"==typeof console.warn&&console.warn(e+" is deprecated, use "+n+" instead.",new Error("").stack),t.apply(t,arguments)}}(M,"allResolved","allSettled"),v.prototype.allResolved=function(){return M(this)},f.allSettled=F,v.prototype.allSettled=function(){return this.then(function(t){return k(J(t,function(t){function e(){return t.inspect()}return t=f(t),t.then(e,e)}))})},f.fail=f.catch=function(t,e){return f(t).then(void 0,e)},v.prototype.fail=v.prototype.catch=function(t){return this.then(void 0,t)},f.progress=B,v.prototype.progress=function(t){return this.then(void 0,void 0,t)},f.fin=f.finally=function(t,e){return f(t).finally(e)},v.prototype.fin=v.prototype.finally=function(t){return t=f(t),this.then(function(e){return t.fcall().then(function(){return e})},function(e){return t.fcall().then(function(){throw e})})},f.done=function(t,e,n,i){return f(t).done(e,n,i)},v.prototype.done=function(t,n,i){var r=function(t){f.nextTick(function(){if(o(t,a),!f.onerror)throw t;f.onerror(t)})},a=t||n||i?this.then(t,n,i):this;"object"==typeof e&&e&&e.domain&&(r=e.domain.bind(r)),a.then(void 0,r)},f.timeout=function(t,e,n){return f(t).timeout(e,n)},v.prototype.timeout=function(t,e){var n=d(),i=setTimeout(function(){e&&"string"!=typeof e||(e=new Error(e||"Timed out after "+t+" ms"),e.code="ETIMEDOUT"),n.reject(e)},t);return this.then(function(t){clearTimeout(i),n.resolve(t)},function(t){clearTimeout(i),n.reject(t)},n.notify),n.promise},f.delay=function(t,e){return void 0===e&&(e=t,t=void 0),f(t).delay(e)},v.prototype.delay=function(t){return this.then(function(e){var n=d();return setTimeout(function(){n.resolve(e)},t),n.promise})},f.nfapply=function(t,e){return f(t).nfapply(e)},v.prototype.nfapply=function(t){var e=d(),n=z(t);return n.push(e.makeNodeResolver()),this.fapply(n).fail(e.reject),e.promise},f.nfcall=function(t){var e=z(arguments,1);return f(t).nfapply(e)},v.prototype.nfcall=function(){var t=z(arguments),e=d();return t.push(e.makeNodeResolver()),this.fapply(t).fail(e.reject),e.promise},f.nfbind=f.denodeify=function(t){var e=z(arguments,1);return function(){var n=e.concat(z(arguments)),i=d();return n.push(i.makeNodeResolver()),f(t).fapply(n).fail(i.reject),i.promise}},v.prototype.nfbind=v.prototype.denodeify=function(){var t=z(arguments);return t.unshift(this),f.denodeify.apply(void 0,t)},f.nbind=function(t,e){var n=z(arguments,2);return function(){function i(){return t.apply(e,arguments)}var r=n.concat(z(arguments)),o=d();return r.push(o.makeNodeResolver()),f(i).fapply(r).fail(o.reject),o.promise}},v.prototype.nbind=function(){var t=z(arguments,0);return t.unshift(this),f.nbind.apply(void 0,t)},f.nmapply=f.npost=function(t,e,n){return f(t).npost(e,n)},v.prototype.nmapply=v.prototype.npost=function(t,e){var n=z(e||[]),i=d();return n.push(i.makeNodeResolver()),this.dispatch("post",[t,n]).fail(i.reject),i.promise},f.nsend=f.nmcall=f.ninvoke=function(t,e){var n=z(arguments,2),i=d();return n.push(i.makeNodeResolver()),f(t).dispatch("post",[e,n]).fail(i.reject),i.promise},v.prototype.nsend=v.prototype.nmcall=v.prototype.ninvoke=function(t){var e=z(arguments,1),n=d();return e.push(n.makeNodeResolver()),this.dispatch("post",[t,e]).fail(n.reject),n.promise},f.nodeify=W,v.prototype.nodeify=function(t){if(!t)return this;this.then(function(e){f.nextTick(function(){t(null,e)})},function(e){f.nextTick(function(){t(e)})})},f.noConflict=function(){throw new Error("Q.noConflict only works when Q is used as a global")};var ut=l();return f})}).call(e,n(14),n(20).setImmediate)}},[240]);