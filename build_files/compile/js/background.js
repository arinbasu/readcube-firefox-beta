webpackJsonp([7],{140:function(t,e,n){!function(n,r){t.exports=e=r()}(0,function(){var t=t||function(t,e){var n=Object.create||function(){function t(){}return function(e){var n;return t.prototype=e,n=new t,t.prototype=null,n}}(),r={},o=r.lib={},i=o.Base=function(){return{extend:function(t){var e=n(this);return t&&e.mixIn(t),e.hasOwnProperty("init")&&this.init!==e.init||(e.init=function(){e.$super.init.apply(this,arguments)}),e.init.prototype=e,e.$super=this,e},create:function(){var t=this.extend();return t.init.apply(t,arguments),t},init:function(){},mixIn:function(t){for(var e in t)t.hasOwnProperty(e)&&(this[e]=t[e]);t.hasOwnProperty("toString")&&(this.toString=t.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),s=o.WordArray=i.extend({init:function(t,e){t=this.words=t||[],this.sigBytes=void 0!=e?e:4*t.length},toString:function(t){return(t||c).stringify(this)},concat:function(t){var e=this.words,n=t.words,r=this.sigBytes,o=t.sigBytes;if(this.clamp(),r%4)for(var i=0;i<o;i++){var s=n[i>>>2]>>>24-i%4*8&255;e[r+i>>>2]|=s<<24-(r+i)%4*8}else for(var i=0;i<o;i+=4)e[r+i>>>2]=n[i>>>2];return this.sigBytes+=o,this},clamp:function(){var e=this.words,n=this.sigBytes;e[n>>>2]&=4294967295<<32-n%4*8,e.length=t.ceil(n/4)},clone:function(){var t=i.clone.call(this);return t.words=this.words.slice(0),t},random:function(e){for(var n,r=[],o=0;o<e;o+=4){var i=function(e){var e=e,n=987654321,r=4294967295;return function(){n=36969*(65535&n)+(n>>16)&r,e=18e3*(65535&e)+(e>>16)&r;var o=(n<<16)+e&r;return o/=4294967296,(o+=.5)*(t.random()>.5?1:-1)}}(4294967296*(n||t.random()));n=987654071*i(),r.push(4294967296*i()|0)}return new s.init(r,e)}}),a=r.enc={},c=a.Hex={stringify:function(t){for(var e=t.words,n=t.sigBytes,r=[],o=0;o<n;o++){var i=e[o>>>2]>>>24-o%4*8&255;r.push((i>>>4).toString(16)),r.push((15&i).toString(16))}return r.join("")},parse:function(t){for(var e=t.length,n=[],r=0;r<e;r+=2)n[r>>>3]|=parseInt(t.substr(r,2),16)<<24-r%8*4;return new s.init(n,e/2)}},u=a.Latin1={stringify:function(t){for(var e=t.words,n=t.sigBytes,r=[],o=0;o<n;o++){var i=e[o>>>2]>>>24-o%4*8&255;r.push(String.fromCharCode(i))}return r.join("")},parse:function(t){for(var e=t.length,n=[],r=0;r<e;r++)n[r>>>2]|=(255&t.charCodeAt(r))<<24-r%4*8;return new s.init(n,e)}},l=a.Utf8={stringify:function(t){try{return decodeURIComponent(escape(u.stringify(t)))}catch(t){throw new Error("Malformed UTF-8 data")}},parse:function(t){return u.parse(unescape(encodeURIComponent(t)))}},f=o.BufferedBlockAlgorithm=i.extend({reset:function(){this._data=new s.init,this._nDataBytes=0},_append:function(t){"string"==typeof t&&(t=l.parse(t)),this._data.concat(t),this._nDataBytes+=t.sigBytes},_process:function(e){var n=this._data,r=n.words,o=n.sigBytes,i=this.blockSize,a=4*i,c=o/a;c=e?t.ceil(c):t.max((0|c)-this._minBufferSize,0);var u=c*i,l=t.min(4*u,o);if(u){for(var f=0;f<u;f+=i)this._doProcessBlock(r,f);var d=r.splice(0,u);n.sigBytes-=l}return new s.init(d,l)},clone:function(){var t=i.clone.call(this);return t._data=this._data.clone(),t},_minBufferSize:0}),d=(o.Hasher=f.extend({cfg:i.extend(),init:function(t){this.cfg=this.cfg.extend(t),this.reset()},reset:function(){f.reset.call(this),this._doReset()},update:function(t){return this._append(t),this._process(),this},finalize:function(t){return t&&this._append(t),this._doFinalize()},blockSize:16,_createHelper:function(t){return function(e,n){return new t.init(n).finalize(e)}},_createHmacHelper:function(t){return function(e,n){return new d.HMAC.init(t,n).finalize(e)}}}),r.algo={});return r}(Math);return t})},151:function(t,e,n){var r=n(3);t.exports=r({getPdfUrls:function(t){throw new Error("Method not implemented")}})},153:function(t,e,n){var r=n(4),o=n(3),i=n(1);t.exports=o({getButtonHolder:function(t){return t.find(".gs_ri .gs_fl")},getArticleHolders:function(t){return r("#gs_res_ccl_mid",t||null).find(">.gs_r:not(:has(>.gs_rt))")},getAllVersionsUrl:function(t){return t.find('.gs_fl a[href^="/scholar?cluster="]').attr("href")},getParsedPdfUrl:function(t){var e=t.find('.gs_ggs a:contains("[PDF]")');return e.length?e.attr("href"):null},getTitle:function(t){var e=t.find("h3").clone();e.find("> span").remove();var n=e.text();if(!n){var r=t.find("h3").contents().filter(function(){return this.nodeType==Node.TEXT_NODE});r&&(n=i.trim(r.text()," "))}return n}})},164:function(t,e,n){var r=n(1),o=n(0),i=[{regex:o.URL_REGEXP_ACADEMIA_EDU,mutateHeaders:function(t){return!r.find(t.requestHeaders,{name:"Referer"})&&(t.requestHeaders.push({name:"Referer",value:"https://scholar.google.com/"}),!0)}},{regex:o.URL_REGEXP_PUBLISHER_WILEY,mutateHeaders:function(t){var e=r.find(t.requestHeaders,{name:"User-Agent"});return!(!e||-1!==e.value.indexOf("Macintosh"))&&(e.value+="Macintosh",!0)}}],s={listen:function(){this.requestHeaderMutations(),this.responseHeaderActions()},requestHeaderMutations:function(){chrome.webRequest.onBeforeSendHeaders.addListener(function(t){for(var e=!1,n=0;n<i.length;n++){var r=i[n];if(r.regex.test(t.url)){e=r.mutateHeaders(t);break}}return e?{}:{requestHeaders:t.requestHeaders}},{urls:["<all_urls>"]},["blocking","requestHeaders"])},tabIdsWithPdfContent:[],responseHeaderActions:function(){chrome.webRequest.onHeadersReceived.addListener(function(t){if(-1!==t.tabId){var e=r.find(t.responseHeaders,function(t){return"content-type"==t.name.toLowerCase()}),n=e&&e.value.split(";",1)[0],o=r.find(s.tabIdsWithPdfContent,r.pick(t,["tabId","frameId"])),i=r.pick(t,["tabId","frameId","url"]);if("application/pdf"==n){if(o?o.url=i.url:s.tabIdsWithPdfContent.push(i),t.url.indexOf("readcubeId")>-1){var a=r.find(t.responseHeaders,{name:"Content-Disposition"});if(a&&0==a.value.indexOf("attachment"))return a.value=a.value.replace("attachment","inline"),{responseHeaders:t.responseHeaders}}}else o&&(s.tabIdsWithPdfContent=r.reject(s.tabIdsWithPdfContent,r.pick(t,["tabId","frameId"])));return{}}},{urls:["<all_urls>"],types:["main_frame","sub_frame"]},["blocking","responseHeaders"])}};t.exports=s},173:function(t,e,n){!function(r,o){t.exports=e=o(n(140))}(0,function(t){return function(){if("function"==typeof ArrayBuffer){var e=t,n=e.lib,r=n.WordArray,o=r.init;(r.init=function(t){if(t instanceof ArrayBuffer&&(t=new Uint8Array(t)),(t instanceof Int8Array||"undefined"!=typeof Uint8ClampedArray&&t instanceof Uint8ClampedArray||t instanceof Int16Array||t instanceof Uint16Array||t instanceof Int32Array||t instanceof Uint32Array||t instanceof Float32Array||t instanceof Float64Array)&&(t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength)),t instanceof Uint8Array){for(var e=t.byteLength,n=[],r=0;r<e;r++)n[r>>>2]|=t[r]<<24-r%4*8;o.call(this,n,e)}else o.apply(this,arguments)}).prototype=r}}(),t.lib.WordArray})},174:function(t,e,n){var r=n(1),o=n(0),i=n(3),s=n(8),a=n(216),c=n(175),u=n(214),l=n(26),f=n(176),d=n(9),h=n(4);t.exports=i({__constructor:function(t,e){this.port=t,this.params=e,this.metadata=new a,this.downloadPdf=new c,this.uploadPdf=new u,this.googleScholar=new f,this.validateParams()?this.startPdfImport():this.postMessage({status:o.EXTERNAL_STATUS_FAILED,error:o.EXTERNAL_ERROR_INVALID_PARAMS},!0)},validateParams:function(){return r.get(this.params,"doi",null)&&r.get(this.params,"item_id",null)},postMessage:function(t,e){this.port.postMessage(t),void 0===e&&(e=!1),e&&this.disconnect()},disconnect:function(){this.port.disconnect()},startPdfImport:function(){var t=this;t.postMessage({status:o.EXTERNAL_STATUS_STARTED}),s.when(function(){return t.params.pdf_url?t.params.pdf_url:t.metadata.getPdfUrls(t.params).then(function(t){return t.length>0?t[0]:s.reject("No pdf urls on Readcube server found")})}()).catch(function(t){return s.reject({status:o.EXTERNAL_STATUS_FAILED,error:o.EXTERNAL_ERROR_NOT_FOUND})}).then(function(e){var n=d.parse(e).hostname;return t.postMessage({status:o.EXTERNAL_STATUS_DOWNLOADING,progress:0,source:n}),t.downloadPdf.getPdf({url:e,isProxied:!1}).catch(function(n){return t.getInstitutionProxy().catch(function(t){return s.reject({status:o.EXTERNAL_STATUS_FAILED,error:o.EXTERNAL_ERROR_FAILED})}).then(function(n){var r=n.replace(o.EZPROXY_URL_REPLACE_KEY,e);return t.downloadPdf.getPdf({url:r,isProxied:!0}).catch(function(t){return s.reject({status:o.EXTERNAL_STATUS_FAILED,error:o.EXTERNAL_ERROR_PROXY_FAILED})})})}).progress(function(e){t.postMessage({status:o.EXTERNAL_STATUS_DOWNLOADING,progress:e,source:n})}).then(function(n){return t.postMessage({status:o.EXTERNAL_STATUS_UPLOADING,progress:0}),t.uploadPdf.uploadToReadcube(n,t.params,e).then(function(){t.postMessage({status:o.EXTERNAL_STATUS_COMPLETED},!0)},function(){return s.reject({status:o.EXTERNAL_STATUS_FAILED,error:o.EXTERNAL_ERROR_FAILED})},function(e){t.postMessage({status:o.EXTERNAL_STATUS_UPLOADING,progress:e})})})}).catch(function(e){return e.error?t.googleScholar.getPdfUrls(t.params.title).then(function(t){return e.gs_urls=t,!0}).catch(function(t){return e.gs_urls=[],console.error(t),!1}).then(function(){return t.postMessage(e,!0),s.reject(e)}):s.reject(e)}).done()},getInstitutionProxy:function(){return l.get("loggedInUserDetails",null).then(function(t){return t||s(h.get(o.URL_USER_DETAILS))}).then(function(t){switch(r.get(t,"proxy_url_selection",null)){case o.VALUE_PROXY_URL_SELECTION_NONE:case o.VALUE_PROXY_URL_SELECTION_NULL:return s.reject('Proxy url selection is "none" or "null"');case o.VALUE_PROXY_URL_SELECTION_MANUAL:var e=r.get(t,"proxy_url",null);return e||s.reject("Proxy url is not available");case o.VALUE_PROXY_URL_SELECTION_INSTITUTION:var n=r.get(t,"institution_proxy_url",null);return n||s.reject("Institution proxy url is not available");default:return s.reject("Unknown proxy selection option")}})}})},175:function(t,e,n){var r=n(185),o=n(140),i=n(0),s=n(4),a=n(8),c=n(25),u=n(3),l=n(13);n(173),t.exports=u({getPdf:function(t){var e=this;return e.getBlob(t.url).then(function(n){return e.isValidBlob(n)?n:t.isProxied?e.getPdfUrlFromProxyRedirectMessage(n).then(function(t){return e.getBlob(t)}).then(function(t){return e.isValidBlob(t)?t:a.reject("Blob empty or not valid content type, fetched from redirect link")}):a.reject("Blob empty or not valid content type")}).then(function(n){return e.formatBlobResult(n,t.url)})},isWileyFirefoxIssue:function(t,e){return i.URL_REGEXP_PUBLISHER_WILEY.test(t)&&"text/html"==e.type},getWileyPdfLinkForFirefox:function(t){return this.getDataFromBlob("text",t).then(function(t){return s(t).find("#pdfDocument").attr("src")})},formatBlobResult:function(t,e){return this.getDataFromBlob("base64",t).then(function(n){var i=o.lib.WordArray.create(c.toArrayBuffer(n)),s=r(i).toString(),a=l.getPdfFilenameFromUrl(e);return{blob:t,base64:n,sha256Hash:s,fileSize:t.size,fileName:a}})},getPdfUrlFromProxyRedirectMessage:function(t){return this.getDataFromBlob("text",t).then(function(t){var e=s(t),n=e.filter("a");return 0!=n.length&&n.attr("href")?n.attr("href"):a.reject("Blob empty or not valid content type, no valid redirect links found")})},isValidBlob:function(t){var e=["application/pdf","application/octet-stream"];return t.size>0&&-1!=e.indexOf(t.type)},updateProgress:function(t,e){if(t.lengthComputable&&t.total>0){var n=t.loaded/t.total;e.notify(parseInt(100*n))}else e.notify(0)},getDataFromBlob:function(t,e){var n=a.defer(),r=new FileReader;switch(t){case"base64":r.readAsDataURL(e);break;case"text":r.readAsText(e);break;default:return n.reject("Unknown data type to read from Blob")}return r.onload=function(){n.resolve(r.result)},r.onerror=function(t){n.reject(t)},n.promise},getBlob:function(t){var e=new XMLHttpRequest,n=a.defer(),r=this;return e.responseType="blob",e.addEventListener("progress",function(t){r.updateProgress(t,n)}),e.onreadystatechange=function(t){if(4==t.target.readyState)if(200==t.target.status||0==t.target.status){var e=this.response;n.resolve(e)}else n.reject("Unable to download the pdf blob")},e.open("GET",t,!0),e.send(),n.promise}})},176:function(t,e,n){var r=n(3),o=n(153),i=n(8),s=n(4),a=n(5).sprintf,c=n(0),u=n(1),l=n(151),f=n(9),d=n(193);t.exports=r([l,o],{getPdfUrls:function(t){var e=this;return t?i(s.get(a(c.URL_SEARCH_GOOGLE_SCHOLAR,encodeURIComponent(t)))).then(function(n){var r=s(n),o=u.first(e.getArticleHolders(r)),a=null;if(o){o=s(o);var l=d([t]),h=u.get(l.get(e.getTitle(o)),"[0][0]",null);if(!h||h<.8)return i.reject("No articles found on Google Scholar");a=e.getAllVersionsUrl(o);var p=e.getParsedPdfUrl(o),g=[];return p&&g.push(p),i.when(function(){return a?e.getPdfUrlsFromAllVersions(f.resolve(c.URL_GOOGLE_SCHOLAR,a)):i.reject("No all versions url available")}()).catch(function(){return[]}).then(function(t){return g=u.uniq(g.concat(t)),g.length>0?g:i.reject("No pdf urls found on Google Scholar")})}return i.reject("No articles found on Google Scholar")}):i.reject("No article title specified")},getPdfUrlsFromAllVersions:function(t){var e=this;return i(s.get(t)).then(function(t){var n=s(t),r=[];return e.getArticleHolders(n).each(function(){var t=e.getParsedPdfUrl(s(this));t&&r.push(t)}),r.length>0?r:i.reject("No pdf urls found on Google Scholar all versions page")})}})},177:function(t,e){e.SetBadgeAndIcon=function(t,e,n){var r=n.tab.id;t>0&&(chrome.browserAction.setIcon({tabId:r,path:{19:"icons/icon19.png",38:"icons/icon38.png"}}),chrome.browserAction.setBadgeText({text:t.toString(),tabId:r}),chrome.browserAction.setPopup({tabId:r,popup:"popup.html"}))},e.DisablePopup=function(t,e,n){var r=n.tab.id;chrome.browserAction.setPopup({tabId:r,popup:""})}},179:function(t,e,n){var r=n(0),o={listen:function(){chrome.runtime.onConnect.addListener(function(t){if("readcube-extension-connection"==t.name)return t.onMessage.addListener(function(e){if(e.message==r.MESSAGE_START&&e.method)try{o.caller(e.method,e.data,t)}catch(e){console.error(e),t.disconnect()}}),!0})},caller:function(t,e,n){var r=t.split(".");if(2!=r.length)throw new Error("The method send to background is incorrect");var i=null,s=o.getRequiredByName(r[0]);if(!s||!s[r[1]])throw new Error("The method sent to background does not exist");return i=s[r[1]],i(e,n),null},getRequiredByName:function(t){switch(t.toLowerCase()){case"request":return n(212);default:throw new Error("Unable to load the module: "+t)}}};t.exports=o},180:function(t,e,n){var r=n(174),o={listen:function(){chrome.runtime.onConnectExternal.addListener(function(t){var e=null;return"client_pdf_download"!=t.name?void t.disconnect():(t.onMessage.addListener(function(n){e||(e=new r(t,n))}),!0)})}};t.exports=o},181:function(t,e,n){var r=n(0),o={listenForInstallEvent:function(){chrome.runtime.onInstalled.addListener(function(t){"install"===t.reason&&chrome.tabs.create({url:r.URL_GETTING_STARTED})})}};t.exports=o},182:function(t,e,n){var r={listen:function(){chrome.runtime.onMessage.addListener(function(t,e,n){return t.method&&r.caller(t.method,t.data,n,e),!0})},caller:function(t,e,n,o){var i=t.split(".");if(2!=i.length)throw new Error("The method send to background is incorrect");var s=null,a=r.getRequiredByName(i[0]);if(!a||!a[i[1]])throw new Error("The method sent to background does not exist");s=a[i[1]];var c=s(e,n,o);return"__RESPONSE_IN_METHOD__"!=c?n(c):null},getRequiredByName:function(t){switch(t.toLowerCase()){case"browser_action":return n(177);case"tabs":return n(221);case"extensions":return n(219);case"request":return n(220);case"article":return n(218);default:throw new Error("Unable to load the module: "+t)}}};t.exports=r},183:function(t,e,n){var r=n(177),o=n(0),i=n(13),s=n(26),a=n(222),c=n(223),u=n(8),l=window,f={listenForTabUpdates:function(){chrome.tabs.onUpdated.addListener(function(t,e,n){var r=window.sessionStorage[t],o=e.url;if(o){if(f.onlyTabChanged(r,o))return;window.sessionStorage[t]=o}a.urls[n.url]||a.regex(n.url)||(f.setBrowserActionIcon(t,e,n),f.checkLocalFilesAccess(t,e,n),f.injectContentScripts(t,e,n))})},onlyTabChanged:function(t,e){return!!(c.regex(t)&&c.regex(e)&&(t.indexOf(".figures-only")>-1||t.indexOf(".info")>-1||t.indexOf(".comments")>-1||(t.indexOf(".supplemental")>-1)(e.indexOf(".figures-only")>-1)||e.indexOf(".info")>-1||e.indexOf(".comments")>-1||e.indexOf(".supplemental")>-1))},setBrowserActionIcon:function(t,e,n){e.url&&"loading"==e.status&&(chrome.browserAction.setIcon({tabId:t,path:{19:"icons/icon19disabled.png",38:"icons/icon38disabled.png"}}),chrome.browserAction.setBadgeText({text:"",tabId:t}),o.URL_REGEXP_PUBLISHER_TAILOR_FRANCIS.test(e.url)&&chrome.tabs.sendMessage(t,{message:o.MESSAGE_GET_ARTICLES},function(t){t&&t.length>0&&r.SetBadgeAndIcon(t.length,function(){},{tab:n})}))},checkLocalFilesAccess:function(t,e,n){var r=n.url;"complete"===e.status&&i.isProtocol(r,["file:"])&&i.getPdfFilenameFromUrl(r)&&chrome.extension.isAllowedFileSchemeAccess(function(t){t||s.get(o.STORAGE_KEY_NEVER_ASK_FOR_FILESYSTEM_ACCESS,!1).then(function(t){return!t||u.reject("Do not ask permission")}).then(function(){return f.getRequestFileSystemWindow().then(function(window){chrome.windows.update(window.id,{focused:!0})}).catch(function(){f.openRequestFileSystemWindow()})}).done()})},fileSystemWindowId:null,openRequestFileSystemWindow:function(){var t=Math.round((l.screen.width-400)/2),e=Math.round((l.screen.height-300)/2);chrome.windows.create({url:chrome.runtime.getURL("request_filesystem.html"),width:400,height:300,left:t,top:e,focused:!0,type:"popup"},function(window){f.fileSystemWindowId=window.id})},getRequestFileSystemWindow:function(){var t=u.defer();return null===f.fileSystemWindowId?u.reject("Popup window not created"):(chrome.windows.get(f.fileSystemWindowId,{},function(window){chrome.runtime.lastError&&console.error(chrome.runtime.lastError),window?t.resolve(window):(console.log("Not found"),t.reject("Popup window not found"))}),t.promise)},insertJavaScript:function(t,e){chrome.tabs.executeScript(t,{file:e,runAt:"document_end"})},insertCss:function(t,e){chrome.tabs.insertCSS(t,{file:e})},safelyInject:function(t,e){chrome.tabs.executeScript(t,{code:"if (window.r3) { true; } else { window.r3 = true; false; }",runAt:"document_end"},function(t){t&&t[0]||e()})},injectContentScripts:function(t,e,n){var r=n.url;if(r&&"complete"===e.status&&i.isProtocol(r,["http:","https:","ftp:","file:"])){var o=f.insertJavaScript.bind(f,t),s=f.insertCss.bind(f,t);i.isRsc(r)?this.safelyInject(t,function(){["/compile/js/vendors.js","/compile/js/publisher.js"].forEach(o),["/compile/css/publisher.css","/compile/css/general.css"].forEach(s)}):i.isPublisherWebsite(r)?this.safelyInject(t,function(){["/compile/js/vendors.js","/compile/js/publisher.js"].forEach(o),["/compile/css/publisher.css","/compile/css/general.css"].forEach(s)}):i.isGoogleScholar(r)?this.safelyInject(t,function(){["/compile/js/vendors.js","/compile/js/google_scholar.js"].forEach(o),["compile/css/google_scholar.css"].forEach(s)}):i.isPubmed(r)?this.safelyInject(t,function(){["/compile/js/vendors.js","/compile/js/pubmed.js"].forEach(o),["/compile/css/pubmed.css"].forEach(s)}):i.isReadcubeWebLibrary(r)||i.isReadcubeUrl(r)||this.safelyInject(t,function(){["/compile/js/vendors_simple.js","/compile/js/general.js"].forEach(o),s("/compile/css/general.css")})}}};t.exports=f},185:function(t,e,n){!function(r,o){t.exports=e=o(n(140))}(0,function(t){return function(e){var n=t,r=n.lib,o=r.WordArray,i=r.Hasher,s=n.algo,a=[],c=[];!function(){function t(t){return 4294967296*(t-(0|t))|0}for(var n=2,r=0;r<64;)(function(t){for(var n=e.sqrt(t),r=2;r<=n;r++)if(!(t%r))return!1;return!0})(n)&&(r<8&&(a[r]=t(e.pow(n,.5))),c[r]=t(e.pow(n,1/3)),r++),n++}();var u=[],l=s.SHA256=i.extend({_doReset:function(){this._hash=new o.init(a.slice(0))},_doProcessBlock:function(t,e){for(var n=this._hash.words,r=n[0],o=n[1],i=n[2],s=n[3],a=n[4],l=n[5],f=n[6],d=n[7],h=0;h<64;h++){if(h<16)u[h]=0|t[e+h];else{var p=u[h-15],g=(p<<25|p>>>7)^(p<<14|p>>>18)^p>>>3,m=u[h-2],_=(m<<15|m>>>17)^(m<<13|m>>>19)^m>>>10;u[h]=g+u[h-7]+_+u[h-16]}var v=a&l^~a&f,E=r&o^r&i^o&i,A=(r<<30|r>>>2)^(r<<19|r>>>13)^(r<<10|r>>>22),S=(a<<26|a>>>6)^(a<<21|a>>>11)^(a<<7|a>>>25),I=d+S+v+c[h]+u[h],R=A+E;d=f,f=l,l=a,a=s+I|0,s=i,i=o,o=r,r=I+R|0}n[0]=n[0]+r|0,n[1]=n[1]+o|0,n[2]=n[2]+i|0,n[3]=n[3]+s|0,n[4]=n[4]+a|0,n[5]=n[5]+l|0,n[6]=n[6]+f|0,n[7]=n[7]+d|0},_doFinalize:function(){var t=this._data,n=t.words,r=8*this._nDataBytes,o=8*t.sigBytes;return n[o>>>5]|=128<<24-o%32,n[14+(o+64>>>9<<4)]=e.floor(r/4294967296),n[15+(o+64>>>9<<4)]=r,t.sigBytes=4*n.length,this._process(),this._hash},clone:function(){var t=i.clone.call(this);return t._hash=this._hash.clone(),t}});n.SHA256=i._createHelper(l),n.HmacSHA256=i._createHmacHelper(l)}(Math),t.SHA256})},193:function(t,e,n){t.exports=n(194)},194:function(t,e){!function(){var e=function(t,e,n,r){var o={version:"0.0.1"};t=t||[],o.gramSizeLower=n||2,o.gramSizeUpper=r||3,o.useLevenshtein=e||!0,o.exactSet={},o.matchDict={},o.items={};var i=function(t,e){for(var n,r,o=[],i=0;i<=e.length;i++)for(var s=0;s<=t.length;s++)r=i&&s?t.charAt(s-1)===e.charAt(i-1)?n:Math.min(o[s],o[s-1],n)+1:i+s,n=o[s],o[s]=r;return o.pop()},s=function(t,e){if(null==t&&null==e)throw"Trying to compare two null values";if(null==t||null==e)return 0;t=String(t),e=String(e);var n=i(t,e);return t.length>e.length?1-n/t.length:1-n/e.length},a=/[^\w, ]+/,c=function(t,e){e=e||2;var n="-"+t.toLowerCase().replace(a,"")+"-",r=e-n.length,o=[];if(r>0)for(var i=0;i<r;++i)t+="-";for(var i=0;i<n.length-e+1;++i)o.push(n.slice(i,i+e));return o},u=function(t,e){e=e||2;var n={},r=c(t,e),o=0;for(o;o<r.length;++o)r[o]in n?n[r[o]]+=1:n[r[o]]=1;return n};o.get=function(t,e){var n=this._get(t);return!n&&e?e:n},o._get=function(t){var e=this._normalizeStr(t),n=this.exactSet[e];if(n)return[[1,n]];for(var r=[],o=this.gramSizeUpper;o>this.gramSizeLower;--o)if(r=this.__get(t,o))return r;return null},o.__get=function(t,e){var n,r,o,i,a,c=this._normalizeStr(t),l={},f=u(c,e),d=this.items[e],h=0;for(n in f)if(r=f[n],h+=Math.pow(r,2),n in this.matchDict)for(o=0;o<this.matchDict[n].length;++o)i=this.matchDict[n][o][0],a=this.matchDict[n][o][1],i in l?l[i]+=r*a:l[i]=r*a;if(function(t){for(var e in t)if(t.hasOwnProperty(e))return!1;return!0}(l))return null;var p,g=Math.sqrt(h),m=[];for(var _ in l)p=l[_],m.push([p/(g*d[_][0]),d[_][1]]);var v=function(t,e){return t[0]<e[0]?1:t[0]>e[0]?-1:0};if(m.sort(v),this.useLevenshtein){for(var E=[],A=Math.min(50,m.length),o=0;o<A;++o)E.push([s(m[o][1],c),m[o][1]]);m=E,m.sort(v)}for(var E=[],o=0;o<m.length;++o)m[o][0]==m[0][0]&&E.push([m[o][0],this.exactSet[m[o][1]]]);return E},o.add=function(t){if(this._normalizeStr(t)in this.exactSet)return!1;var e=this.gramSizeLower;for(e;e<this.gramSizeUpper+1;++e)this._add(t,e)},o._add=function(t,e){var n=this._normalizeStr(t),r=this.items[e]||[],o=r.length;r.push(0);var i,s,a=u(n,e),c=0;for(var i in a)s=a[i],c+=Math.pow(s,2),i in this.matchDict?this.matchDict[i].push([o,s]):this.matchDict[i]=[[o,s]];var l=Math.sqrt(c);r[o]=[l,n],this.items[e]=r,this.exactSet[n]=t},o._normalizeStr=function(t){if("[object String]"!==Object.prototype.toString.call(t))throw"Must use a string as argument to FuzzySet functions";return t.toLowerCase()},o.length=function(){var t,e=0;for(t in this.exactSet)this.exactSet.hasOwnProperty(t)&&(e+=1);return e},o.isEmpty=function(){for(var t in this.exactSet)if(this.exactSet.hasOwnProperty(t))return!1;return!0},o.values=function(){var t,e=[];for(t in this.exactSet)this.exactSet.hasOwnProperty(t)&&e.push(this.exactSet[t]);return e};var l=o.gramSizeLower;for(l;l<o.gramSizeUpper+1;++l)o.items[l]=[];for(l=0;l<t.length;++l)o.add(t[l]);return o},n=this;void 0!==t&&t.exports?(t.exports=e,n.FuzzySet=e):n.FuzzySet=e}()},211:function(t,e,n){var r=n(0),o=n(3),i=n(175),s=n(174),a=n(1);t.exports=o(s,{__constructor:function(t,e){this.port=t,this.params=e,this.downloadPdf=new i},startPdfDownload:function(){var t=this;t.downloadPdf.getPdf(t.params).then(function(e){t.postMessage({message:r.MESSAGE_FINISH,data:a.pick(e,["base64","fileSize","sha256Hash","fileName"])},!0)},function(e){console.error(e),t.postMessage({message:r.MESSAGE_FINISH,data:null},!0)},function(e){t.postMessage({message:r.MESSAGE_PROGRESS,data:{percent:parseInt(e)}})}).done()}})},212:function(t,e,n){var r=n(211);n(173),e.GetPdfBase64=function(t,e){new r(e,t).startPdfDownload()}},213:function(t,e,n){var r=n(3),o=n(26),i=n(1),s=n(7),a=n(0),c=n(8),u=n(11),l=n(45),f=n(5).sprintf;t.exports=r({__constructor:function(t,e,n){this.article=t,this.index=e,this.includeNote=n},addArticle:function(){var t=this,e=null;return l.getActiveTabId().then(function(t){return e=t,!0}).catch(function(){return!1}).then(function(){return t.addArticleByParams()}).catch(function(e){switch(e.status){case u.UNAUTHORIZED:return c.reject({success:!1,status:u.UNAUTHORIZED,article:null});case u.BAD_REQUEST:case"no_params":return t.addArticleByMetadata();default:return c.reject({success:!1,status:e.status,article:null})}}).then(function(e){return o.get(a.SETTING_PDF_DOWNLOAD,a.VALUE_PDF_DOWNLOAD_AUTOMATIC_ENABLED).then(function(n){var r=n==a.VALUE_PDF_DOWNLOAD_AUTOMATIC_ENABLED,o=i.find(e,function(t){return null==i.get(t,"item.collection_group_id","not null")});o||(o=e[0]),t.article.extend({inLibraryStatus:r?a.STATUS_IN_LIBRARY_WITHOUT_PDF:a.STATUS_IN_LIBRARY,id:i.get(o,"item.id",null)});var s=i.reduce(e,function(t,e){return t[e.item.collection_id]=e.item.id,t},{});return t.addArticlesToLists(s).catch(function(){return null}).then(function(t){var n={};return e.length&&(n=e.reduce(function(t,e){return"ok"==e.status&&(t[e.item.collection_id]=e.item.id),t},{})),{lists:t,articleLookup:n}})})}).then(function(n){return null==t.index||void 0==t.index||l.sendToTabById(e,{message:a.MESSAGE_UPDATE_ARTICLE,data:{index:t.index,updateDetails:{id:t.article.id,inLibraryStatus:t.article.inLibraryStatus}}}).catch(function(t){return console.error(t),!0}).then(function(){return l.sendToTabById(e,{message:a.MESSAGE_UPDATE_LISTS,data:{lists:n.lists}}),n.articleLookup})}).then(function(e){return{success:!0,status:null,article:i.pick(t.article,["inLibraryStatus","id"]),articleIdLookup:e}})},getUserIdAndCollectionAndListIdsFromStorage:function(){return o.get("loggedInUserDetails",null).then(function(t){return o.get("selectedItems",{}).then(function(e){return{userId:i.get(t,"id",null),selectedItems:e}})})},addToUrlWithPayload:function(t,e){return this.getUserIdAndCollectionAndListIdsFromStorage().then(function(n){if(n.userId){if(i.isEmpty(n.selectedItems))return c.reject("No selected collections");var r=i.chain(n.selectedItems).keys().without("0").value();return c.all(i.map(r,function(n){return s.post(f(t,n),e)})).then(function(t){return i.reduce(t,function(t,e){return 200==e.status&&t.push(e.data),t},[])})}return c.reject({status:u.UNAUTHORIZED})})},addArticleByParams:function(){var t=this.article;if(!(t.doi||t.pmid||t.gsid||t.id||t.url))throw{status:"no_params"};var e=t.toJsonForAPI({includeNote:this.includeNote});return this.addToUrlWithPayload(a.URL_ADD_TO_COLLECTION,e)},addArticleByMetadata:function(){var t=this.article.toJsonForAPI({includeMetadata:!0,includeNote:this.includeNote});return this.addToUrlWithPayload(a.URL_ADD_TO_COLLECTION_METADATA,t)},addArticlesToLists:function(t){var e=this;return this.getUserIdAndCollectionAndListIdsFromStorage().then(function(n){return c.all(i.flatMap(i.toPairs(n.selectedItems),function(n){var r=n[0],o=t[r],s=n[1];return i.map(s,function(t){return e.addArticleToListRequest(o,r,t)})}))})},addArticleToListRequest:function(t,e,n){return s.post(f(a.URL_ADD_TO_COLLECTION_LIST,e,n),{item_ids:[t]})}})},214:function(t,e,n){var r=n(0),o=n(7),i=n(8),s=n(1),a=n(3),c=n(5).sprintf,u=n(11);t.exports=a({uploadToReadcube:function(t,e,n){var a=encodeURIComponent(t.fileName),l=this,f="";n&&n.length&&(f=encodeURIComponent(n.substring(0,500)));var d=c(r.URL_UPLOAD,e.collection_id,"false",t.sha256Hash,e.doi?e.doi:"","",t.fileSize,e.item_id?e.item_id:"",a,f);return o.get(d).then(function(e){var n=s.get(e,"data.url");return n?l.getUploadPromise(t.blob,n):i.reject("Unable to receive the upload url")}).catch(function(t){return t.status==u.UNPROCESSABLE_ENTITY?i.resolve(!0):i.reject(t)})},getUploadPromise:function(t,e){var n=new XMLHttpRequest,r=i.defer();return n.upload.addEventListener("progress",function(t){t.lengthComputable?r.notify(parseInt(t.loaded/t.total*100)):r.notify(50)}),n.onreadystatechange=function(t){4==t.target.readyState&&(200==t.target.status?r.resolve(t.target):r.reject(t.target))},n.open("PUT",e,!0),n.setRequestHeader("Content-Type","application/pdf"),n.send(t),r.promise}})},215:function(t,e,n){var r=n(3),o=n(8),i=n(4),s=n(7),a=n(5).sprintf,c=n(0),u=n(151),l=n(9);t.exports=r(u,{getPdfUrls:function(t){var e=this;return s.get(a(c.URL_DOI_RESOLVER,t),!0).then(function(n){var r=e.getUrlFromMetaTags(n.data,n.url);return r?[r]:o.reject(a("Unable to get the pdf url from resolving the doi: %s",t))})},getUrlFromMetaTags:function(t,e){var n,r=i(t),o=r.closest('meta[name="citation_pdf_url"]').attr("content");if(o||(n=i('a[href].js-readcube-pdf, a[href].download-pdf, a[href].pdf, a[title="Download PDF"], a[href]:contains("Download as PDF")',r),n.length>0&&(o=n.attr("href"))),o){c.URL_REGEXP_ABSOLUTE.test(o)||(o=l.resolve(e,o))}return o}})},216:function(t,e,n){var r=n(0),o=n(8),i=n(1),s=n(7),a=n(3),c=n(151);t.exports=a(c,{getPdfUrls:function(t){var e={ext_ids:[{doi:t.doi}]};return s.post(r.URL_ARTICLES_METADATA,e).then(function(t){var e=i.get(t,"data.[0].pdf_urls[0]",null);return e?[e]:o.reject("Pdf url is null")})}})},217:function(t,e,n){var r=n(182),o=n(179),i=n(183),s=n(164),a=n(180),c=n(181);r.listen(),o.listen(),i.listenForTabUpdates(),s.listen(),a.listen(),c.listenForInstallEvent()},218:function(t,e,n){var r=n(213),o=n(15),i=n(0);e.AddFromMetadata=function(t,e){return new r(new o(t.article),t.index,t.includeNote).addArticle().then(e).catch(e).done(),i.RESPONSE_IN_METHOD}},219:function(t,e,n){var r=n(0),o=n(1);e.IsEvernoteExtensionEnabled=function(t,e,n){return chrome.management.get(r.EXTENSION_ID_EVERNOTE,function(t){chrome.runtime.lastError?(console.log(chrome.runtime.lastError.message),e(!1)):e(o.get(t,"enabled",!1))}),r.RESPONSE_IN_METHOD}},220:function(t,e,n){var r=n(0),o=(n(1),n(215)),i=n(176);e.GetPdfUrlsFromDxDoi=function(t,e){return(new o).getPdfUrls(t).catch(function(t){return console.error(t),null}).then(e),r.RESPONSE_IN_METHOD},e.GetPdfUrlsFromGoogleScholar=function(t,e){return(new i).getPdfUrls(t).catch(function(t){return console.error(t),null}).then(e),r.RESPONSE_IN_METHOD}},221:function(t,e,n){var r=n(0),o=n(5).sprintf,i=n(1),s=n(164);e.OpenItemInLibrary=function(t,e){chrome.tabs.query({currentWindow:!0},function(e){var n="";n=t.collectionId?o(r.URL_SHARED_LIBRARY_ITEM,t.collectionId,t.itemId):o(r.URL_LIBRARY_ITEM,t.itemId);var s=i.find(e,function(t){if(-1!==t.url.indexOf(r.URL_LIBRARY))return t});s?chrome.tabs.update(s.id,{highlighted:!0,url:n}):chrome.tabs.create({active:!0,url:n})})},e.OpenLibrary=function(){chrome.tabs.query({currentWindow:!0},function(t){var e=i.find(t,function(t){if(-1!==t.url.indexOf(r.URL_LIBRARY))return t});e?chrome.tabs.update(e.id,{highlighted:!0,url:r.URL_LIBRARY}):chrome.tabs.create({active:!0,url:r.URL_LIBRARY})})},e.CurrentFramePdfUrl=function(t,e,n){var o=i.get(n,"tab.id",null),a={frameId:n.frameId,tabId:o};return e(i.chain(s.tabIdsWithPdfContent).find(a).get("url",null).value()),r.RESPONSE_IN_METHOD},e.CurrentTabId=function(t,e,n){return e(i.get(n,"tab.id",null)),r.RESPONSE_IN_METHOD},e.UpdateArticleInTab=function(t,e,n){var o=i.get(t,"tabId",null),s=i.get(t,"payload",null);return o&&s?chrome.tabs.sendMessage(o,s,function(t){e(t)}):e(!1),r.RESPONSE_IN_METHOD},e.ReloadActiveTabWithProxy=function(t,e,n){return chrome.tabs.query({currentWindow:!0,active:!0},function(e){if(e.length){var n=e[0];chrome.tabs.update(n.id,{url:t.replace(r.EZPROXY_URL_REPLACE_KEY,n.url)})}}),!0}},222:function(t,e){var n=["growkudos.com/about/researchers","springer.com/economics/journal/41294"],r=[/www\.google\..+\/search.+/,/blogs.plos.org/,/altmetric.com/,/atlassian.net/];e.regex=function(t){return r.some(function(e){return e.test(t)})},e.urls=n.reduce(function(t,e){return t["https://"+e]=!0,t["https://www."+e]=!0,t["http://"+e]=!0,t["http://www."+e]=!0,t},{})},223:function(t,e){var n=[/aappublications.org/,/royalsocietypublishing.org/];e.regex=function(t){return n.some(function(e){return e.test(t)})}}},[217]);