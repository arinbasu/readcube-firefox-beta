webpackJsonp([3],[,,,,,,,function(e,t,n){function i(e,t,n,i,a){var s=o.defer(),l=new XMLHttpRequest;return l.open(t,e,!0),l.onload=function(){l.status>=200&&l.status<400?s.resolve({data:i?l.responseText:JSON.parse(l.responseText),status:l.status,url:l.responseURL}):s.reject({status:l.status})},l.onerror=function(){s.reject("Error in xhr."+t)},r.isReadcubeUrl(e)&&c.forEach(function(e){l.setRequestHeader(e[0],e[1])}),a&&l.setRequestHeader("Accept",a),n?(l.setRequestHeader("Content-Type","application/json; charset=UTF-8"),l.send(JSON.stringify(n))):l.send(),s.promise}var o=n(8),r=n(13),a=n(5).sprintf,s=n(0),l=chrome.runtime.getManifest().version,c=[["Sync-Version",s.HEADER_SYNC_VERSION],["X-Readcube-Sync-Token",a(s.HEADER_VALUE_SYNC_TOKEN,l)],["X-Readcube-Sync-Client",a(s.HEADER_VALUE_SYNC_CLIENT,"chrome",l)]];!function(){var e}();e.exports={get:function(e,t,n){return i(e,"GET",null,t,n)},patch:function(e,t){return i(e,"PATCH",t)},delete:function(e){return i(e,"DELETE")},post:function(e,t){return i(e,"POST",t)}}},function(e,t,n){(function(t,n){/*!
 *
 * Copyright 2009-2012 Kris Kowal under the terms of the MIT
 * license found at http://github.com/kriskowal/q/raw/master/LICENSE
 *
 * With parts by Tyler Close
 * Copyright 2007-2009 Tyler Close under the terms of the MIT X license found
 * at http://www.opensource.org/licenses/mit-license.html
 * Forked at ref_send.js version: 2009-05-11
 *
 * With parts by Mark Miller
 * Copyright (C) 2011 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 */
!function(t){"use strict";if("function"==typeof bootstrap)bootstrap("promise",t);else{e.exports=t()}}(function(){"use strict";function e(e){return function(){return q.apply(e,arguments)}}function i(e){return e===Object(e)}function o(e){return"[object StopIteration]"===ne(e)||e instanceof H}function r(e,t){if(W&&t.stack&&"object"==typeof e&&null!==e&&e.stack&&-1===e.stack.indexOf(ie)){for(var n=[],i=t;i;i=i.source)i.stack&&n.unshift(i.stack);n.unshift(e.stack);var o=n.join("\n"+ie+"\n");e.stack=a(o)}}function a(e){for(var t=e.split("\n"),n=[],i=0;i<t.length;++i){var o=t[i];c(o)||s(o)||!o||n.push(o)}return n.join("\n")}function s(e){return-1!==e.indexOf("(module.js:")||-1!==e.indexOf("(node.js:")}function l(e){var t=/at .+ \((.+):(\d+):(?:\d+)\)$/.exec(e);if(t)return[t[1],Number(t[2])];var n=/at ([^ ]+):(\d+):(?:\d+)$/.exec(e);if(n)return[n[1],Number(n[2])];var i=/.*@(.+):(\d+)$/.exec(e);return i?[i[1],Number(i[2])]:void 0}function c(e){var t=l(e);if(!t)return!1;var n=t[0],i=t[1];return n===G&&i>=V&&i<=le}function u(){if(W)try{throw new Error}catch(i){var e=i.stack.split("\n"),t=e[0].indexOf("@")>0?e[1]:e[2],n=l(t);if(!n)return;return G=n[0],n[1]}}function d(e){return e instanceof g?e:y(e)?O(e):L(e)}function p(){function e(e){t=e,r.source=e,z(n,function(t,n){d.nextTick(function(){e.promiseDispatch.apply(e,n)})},void 0),n=void 0,i=void 0}var t,n=[],i=[],o=Z(p.prototype),r=Z(g.prototype);if(r.promiseDispatch=function(e,o,r){var a=K(arguments);n?(n.push(a),"when"===o&&r[1]&&i.push(r[1])):d.nextTick(function(){t.promiseDispatch.apply(t,a)})},r.valueOf=function(){if(n)return r;var e=v(t);return m(e)&&(t=e),e},r.inspect=function(){return t?t.inspect():{state:"pending"}},d.longStackSupport&&W)try{throw new Error}catch(e){r.stack=e.stack.substring(e.stack.indexOf("\n")+1)}return o.promise=r,o.resolve=function(n){t||e(d(n))},o.fulfill=function(n){t||e(L(n))},o.reject=function(n){t||e(I(n))},o.notify=function(e){t||z(i,function(t,n){d.nextTick(function(){n(e)})},void 0)},o}function f(e){if("function"!=typeof e)throw new TypeError("resolver must be a function.");var t=p();try{e(t.resolve,t.reject,t.notify)}catch(e){t.reject(e)}return t.promise}function h(e){return f(function(t,n){for(var i=0,o=e.length;i<o;i++)d(e[i]).then(t,n)})}function g(e,t,n){void 0===t&&(t=function(e){return I(new Error("Promise does not support operation: "+e))}),void 0===n&&(n=function(){return{state:"unknown"}});var i=Z(g.prototype);if(i.promiseDispatch=function(n,o,r){var a;try{a=e[o]?e[o].apply(i,r):t.call(i,o,r)}catch(e){a=I(e)}n&&n(a)},i.inspect=n,n){var o=n();"rejected"===o.state&&(i.exception=o.reason),i.valueOf=function(){var e=n();return"pending"===e.state||"rejected"===e.state?i:e.value}}return i}function b(e,t,n,i){return d(e).then(t,n,i)}function v(e){if(m(e)){var t=e.inspect();if("fulfilled"===t.state)return t.value}return e}function m(e){return e instanceof g}function y(e){return i(e)&&"function"==typeof e.then}function _(e){return m(e)&&"pending"===e.inspect().state}function T(e){return!m(e)||"fulfilled"===e.inspect().state}function w(e){return m(e)&&"rejected"===e.inspect().state}function E(){oe.length=0,re.length=0,se||(se=!0)}function A(e,n){se&&("object"==typeof t&&"function"==typeof t.emit&&d.nextTick.runAfter(function(){-1!==Q(re,e)&&(t.emit("unhandledRejection",n,e),ae.push(e))}),re.push(e),n&&void 0!==n.stack?oe.push(n.stack):oe.push("(no stack) "+n))}function S(e){if(se){var n=Q(re,e);-1!==n&&("object"==typeof t&&"function"==typeof t.emit&&d.nextTick.runAfter(function(){var i=Q(ae,e);-1!==i&&(t.emit("rejectionHandled",oe[n],e),ae.splice(i,1))}),re.splice(n,1),oe.splice(n,1))}}function I(e){var t=g({when:function(t){return t&&S(this),t?t(e):this}},function(){return this},function(){return{state:"rejected",reason:e}});return A(t,e),t}function L(e){return g({when:function(){return e},get:function(t){return e[t]},set:function(t,n){e[t]=n},delete:function(t){delete e[t]},post:function(t,n){return null===t||void 0===t?e.apply(void 0,n):e[t].apply(e,n)},apply:function(t,n){return e.apply(t,n)},keys:function(){return te(e)}},void 0,function(){return{state:"fulfilled",value:e}})}function O(e){var t=p();return d.nextTick(function(){try{e.then(t.resolve,t.reject,t.notify)}catch(e){t.reject(e)}}),t.promise}function P(e){return g({isDef:function(){}},function(t,n){return N(e,t,n)},function(){return d(e).inspect()})}function C(e,t,n){return d(e).spread(t,n)}function x(e){return function(){function t(e,t){var a;if("undefined"==typeof StopIteration){try{a=n[e](t)}catch(e){return I(e)}return a.done?d(a.value):b(a.value,i,r)}try{a=n[e](t)}catch(e){return o(e)?d(e.value):I(e)}return b(a,i,r)}var n=e.apply(this,arguments),i=t.bind(t,"next"),r=t.bind(t,"throw");return i()}}function R(e){d.done(d.async(e)())}function D(e){throw new H(e)}function k(e){return function(){return C([this,U(arguments)],function(t,n){return e.apply(t,n)})}}function N(e,t,n){return d(e).dispatch(t,n)}function U(e){return b(e,function(e){var t=0,n=p();return z(e,function(i,o,r){var a;m(o)&&"fulfilled"===(a=o.inspect()).state?e[r]=a.value:(++t,b(o,function(i){e[r]=i,0==--t&&n.resolve(e)},n.reject,function(e){n.notify({index:r,value:e})}))},void 0),0===t&&n.resolve(e),n.promise})}function M(e){if(0===e.length)return d.resolve();var t=d.defer(),n=0;return z(e,function(i,o,r){function a(e){t.resolve(e)}function s(){0===--n&&t.reject(new Error("Can't get fulfillment value from any promise, all promises were rejected."))}function l(e){t.notify({index:r,value:e})}var c=e[r];n++,b(c,a,s,l)},void 0),t.promise}function $(e){return b(e,function(e){return e=J(e,d),b(U(J(e,function(e){return b(e,X,X)})),function(){return e})})}function B(e){return d(e).allSettled()}function F(e,t){return d(e).then(void 0,void 0,t)}function j(e,t){return d(e).nodeify(t)}var W=!1;try{throw new Error}catch(e){W=!!e.stack}var G,H,V=u(),X=function(){},Y=function(){function e(){for(var e,t;o.next;)o=o.next,e=o.task,o.task=void 0,t=o.domain,t&&(o.domain=void 0,t.enter()),i(e,t);for(;c.length;)e=c.pop(),i(e);a=!1}function i(t,n){try{t()}catch(t){if(l)throw n&&n.exit(),setTimeout(e,0),n&&n.enter(),t;setTimeout(function(){throw t},0)}n&&n.exit()}var o={task:void 0,next:null},r=o,a=!1,s=void 0,l=!1,c=[];if(Y=function(e){r=r.next={task:e,domain:l&&t.domain,next:null},a||(a=!0,s())},"object"==typeof t&&"[object process]"===t.toString()&&t.nextTick)l=!0,s=function(){t.nextTick(e)};else if("function"==typeof n)s="undefined"!=typeof window?n.bind(window,e):function(){n(e)};else if("undefined"!=typeof MessageChannel){var u=new MessageChannel;u.port1.onmessage=function(){s=d,u.port1.onmessage=e,e()};var d=function(){u.port2.postMessage(0)};s=function(){setTimeout(e,0),d()}}else s=function(){setTimeout(e,0)};return Y.runAfter=function(e){c.push(e),a||(a=!0,s())},Y}(),q=Function.call,K=e(Array.prototype.slice),z=e(Array.prototype.reduce||function(e,t){var n=0,i=this.length;if(1===arguments.length)for(;;){if(n in this){t=this[n++];break}if(++n>=i)throw new TypeError}for(;n<i;n++)n in this&&(t=e(t,this[n],n));return t}),Q=e(Array.prototype.indexOf||function(e){for(var t=0;t<this.length;t++)if(this[t]===e)return t;return-1}),J=e(Array.prototype.map||function(e,t){var n=this,i=[];return z(n,function(o,r,a){i.push(e.call(t,r,a,n))},void 0),i}),Z=Object.create||function(e){function t(){}return t.prototype=e,new t},ee=e(Object.prototype.hasOwnProperty),te=Object.keys||function(e){var t=[];for(var n in e)ee(e,n)&&t.push(n);return t},ne=e(Object.prototype.toString);H="undefined"!=typeof ReturnValue?ReturnValue:function(e){this.value=e};var ie="From previous event:";d.resolve=d,d.nextTick=Y,d.longStackSupport=!1,"object"==typeof t&&t&&t.env&&t.env.Q_DEBUG&&(d.longStackSupport=!0),d.defer=p,p.prototype.makeNodeResolver=function(){var e=this;return function(t,n){t?e.reject(t):arguments.length>2?e.resolve(K(arguments,1)):e.resolve(n)}},d.Promise=f,d.promise=f,f.race=h,f.all=U,f.reject=I,f.resolve=d,d.passByCopy=function(e){return e},g.prototype.passByCopy=function(){return this},d.join=function(e,t){return d(e).join(t)},g.prototype.join=function(e){return d([this,e]).spread(function(e,t){if(e===t)return e;throw new Error("Can't join: not the same: "+e+" "+t)})},d.race=h,g.prototype.race=function(){return this.then(d.race)},d.makePromise=g,g.prototype.toString=function(){return"[object Promise]"},g.prototype.then=function(e,t,n){function i(t){try{return"function"==typeof e?e(t):t}catch(e){return I(e)}}function o(e){if("function"==typeof t){r(e,s);try{return t(e)}catch(e){return I(e)}}return I(e)}function a(e){return"function"==typeof n?n(e):e}var s=this,l=p(),c=!1;return d.nextTick(function(){s.promiseDispatch(function(e){c||(c=!0,l.resolve(i(e)))},"when",[function(e){c||(c=!0,l.resolve(o(e)))}])}),s.promiseDispatch(void 0,"when",[void 0,function(e){var t,n=!1;try{t=a(e)}catch(e){if(n=!0,!d.onerror)throw e;d.onerror(e)}n||l.notify(t)}]),l.promise},d.tap=function(e,t){return d(e).tap(t)},g.prototype.tap=function(e){return e=d(e),this.then(function(t){return e.fcall(t).thenResolve(t)})},d.when=b,g.prototype.thenResolve=function(e){return this.then(function(){return e})},d.thenResolve=function(e,t){return d(e).thenResolve(t)},g.prototype.thenReject=function(e){return this.then(function(){throw e})},d.thenReject=function(e,t){return d(e).thenReject(t)},d.nearer=v,d.isPromise=m,d.isPromiseAlike=y,d.isPending=_,g.prototype.isPending=function(){return"pending"===this.inspect().state},d.isFulfilled=T,g.prototype.isFulfilled=function(){return"fulfilled"===this.inspect().state},d.isRejected=w,g.prototype.isRejected=function(){return"rejected"===this.inspect().state};var oe=[],re=[],ae=[],se=!0;d.resetUnhandledRejections=E,d.getUnhandledReasons=function(){return oe.slice()},d.stopUnhandledRejectionTracking=function(){E(),se=!1},E(),d.reject=I,d.fulfill=L,d.master=P,d.spread=C,g.prototype.spread=function(e,t){return this.all().then(function(t){return e.apply(void 0,t)},t)},d.async=x,d.spawn=R,d.return=D,d.promised=k,d.dispatch=N,g.prototype.dispatch=function(e,t){var n=this,i=p();return d.nextTick(function(){n.promiseDispatch(i.resolve,e,t)}),i.promise},d.get=function(e,t){return d(e).dispatch("get",[t])},g.prototype.get=function(e){return this.dispatch("get",[e])},d.set=function(e,t,n){return d(e).dispatch("set",[t,n])},g.prototype.set=function(e,t){return this.dispatch("set",[e,t])},d.del=d.delete=function(e,t){return d(e).dispatch("delete",[t])},g.prototype.del=g.prototype.delete=function(e){return this.dispatch("delete",[e])},d.mapply=d.post=function(e,t,n){return d(e).dispatch("post",[t,n])},g.prototype.mapply=g.prototype.post=function(e,t){return this.dispatch("post",[e,t])},d.send=d.mcall=d.invoke=function(e,t){return d(e).dispatch("post",[t,K(arguments,2)])},g.prototype.send=g.prototype.mcall=g.prototype.invoke=function(e){return this.dispatch("post",[e,K(arguments,1)])},d.fapply=function(e,t){return d(e).dispatch("apply",[void 0,t])},g.prototype.fapply=function(e){return this.dispatch("apply",[void 0,e])},d.try=d.fcall=function(e){return d(e).dispatch("apply",[void 0,K(arguments,1)])},g.prototype.fcall=function(){return this.dispatch("apply",[void 0,K(arguments)])},d.fbind=function(e){var t=d(e),n=K(arguments,1);return function(){return t.dispatch("apply",[this,n.concat(K(arguments))])}},g.prototype.fbind=function(){var e=this,t=K(arguments);return function(){return e.dispatch("apply",[this,t.concat(K(arguments))])}},d.keys=function(e){return d(e).dispatch("keys",[])},g.prototype.keys=function(){return this.dispatch("keys",[])},d.all=U,g.prototype.all=function(){return U(this)},d.any=M,g.prototype.any=function(){return M(this)},d.allResolved=function(e,t,n){return function(){return"undefined"!=typeof console&&"function"==typeof console.warn&&console.warn(t+" is deprecated, use "+n+" instead.",new Error("").stack),e.apply(e,arguments)}}($,"allResolved","allSettled"),g.prototype.allResolved=function(){return $(this)},d.allSettled=B,g.prototype.allSettled=function(){return this.then(function(e){return U(J(e,function(e){function t(){return e.inspect()}return e=d(e),e.then(t,t)}))})},d.fail=d.catch=function(e,t){return d(e).then(void 0,t)},g.prototype.fail=g.prototype.catch=function(e){return this.then(void 0,e)},d.progress=F,g.prototype.progress=function(e){return this.then(void 0,void 0,e)},d.fin=d.finally=function(e,t){return d(e).finally(t)},g.prototype.fin=g.prototype.finally=function(e){return e=d(e),this.then(function(t){return e.fcall().then(function(){return t})},function(t){return e.fcall().then(function(){throw t})})},d.done=function(e,t,n,i){return d(e).done(t,n,i)},g.prototype.done=function(e,n,i){var o=function(e){d.nextTick(function(){if(r(e,a),!d.onerror)throw e;d.onerror(e)})},a=e||n||i?this.then(e,n,i):this;"object"==typeof t&&t&&t.domain&&(o=t.domain.bind(o)),a.then(void 0,o)},d.timeout=function(e,t,n){return d(e).timeout(t,n)},g.prototype.timeout=function(e,t){var n=p(),i=setTimeout(function(){t&&"string"!=typeof t||(t=new Error(t||"Timed out after "+e+" ms"),t.code="ETIMEDOUT"),n.reject(t)},e);return this.then(function(e){clearTimeout(i),n.resolve(e)},function(e){clearTimeout(i),n.reject(e)},n.notify),n.promise},d.delay=function(e,t){return void 0===t&&(t=e,e=void 0),d(e).delay(t)},g.prototype.delay=function(e){return this.then(function(t){var n=p();return setTimeout(function(){n.resolve(t)},e),n.promise})},d.nfapply=function(e,t){return d(e).nfapply(t)},g.prototype.nfapply=function(e){var t=p(),n=K(e);return n.push(t.makeNodeResolver()),this.fapply(n).fail(t.reject),t.promise},d.nfcall=function(e){var t=K(arguments,1);return d(e).nfapply(t)},g.prototype.nfcall=function(){var e=K(arguments),t=p();return e.push(t.makeNodeResolver()),this.fapply(e).fail(t.reject),t.promise},d.nfbind=d.denodeify=function(e){var t=K(arguments,1);return function(){var n=t.concat(K(arguments)),i=p();return n.push(i.makeNodeResolver()),d(e).fapply(n).fail(i.reject),i.promise}},g.prototype.nfbind=g.prototype.denodeify=function(){var e=K(arguments);return e.unshift(this),d.denodeify.apply(void 0,e)},d.nbind=function(e,t){var n=K(arguments,2);return function(){function i(){return e.apply(t,arguments)}var o=n.concat(K(arguments)),r=p();return o.push(r.makeNodeResolver()),d(i).fapply(o).fail(r.reject),r.promise}},g.prototype.nbind=function(){var e=K(arguments,0);return e.unshift(this),d.nbind.apply(void 0,e)},d.nmapply=d.npost=function(e,t,n){return d(e).npost(t,n)},g.prototype.nmapply=g.prototype.npost=function(e,t){var n=K(t||[]),i=p();return n.push(i.makeNodeResolver()),this.dispatch("post",[e,n]).fail(i.reject),i.promise},d.nsend=d.nmcall=d.ninvoke=function(e,t){var n=K(arguments,2),i=p();return n.push(i.makeNodeResolver()),d(e).dispatch("post",[t,n]).fail(i.reject),i.promise},g.prototype.nsend=g.prototype.nmcall=g.prototype.ninvoke=function(e){var t=K(arguments,1),n=p();return t.push(n.makeNodeResolver()),this.dispatch("post",[e,t]).fail(n.reject),n.promise},d.nodeify=j,g.prototype.nodeify=function(e){if(!e)return this;this.then(function(t){d.nextTick(function(){e(null,t)})},function(t){d.nextTick(function(){e(t)})})},d.noConflict=function(){throw new Error("Q.noConflict only works when Q is used as a global")};var le=u();return d})}).call(t,n(14),n(20).setImmediate)},,,function(e,t){e.exports={100:"Continue",101:"Switching Protocols",200:"OK",201:"Created",202:"Accepted",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",300:"Multiple Choices",301:"Moved Permanently",302:"Found",303:"See Other",304:"Not Modified",305:"Use Proxy",307:"Temporary Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Time-out",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Request Entity Too Large",414:"Request-URI Too Large",415:"Unsupported Media Type",416:"Requested Range not Satisfiable",417:"Expectation Failed",422:"Unprocessable Entity",423:"Locked",424:"Failed Dependency",429:"Too Many Requests",451:"Unavailable For Legal Reasons",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Time-out",505:"HTTP Version not Supported",507:"Insufficient Storage",CONTINUE:100,SWITCHING_PROTOCOLS:101,OK:200,CREATED:201,ACCEPTED:202,NON_AUTHORITATIVE_INFORMATION:203,NO_CONTENT:204,RESET_CONTENT:205,PARTIAL_CONTENT:206,MULTIPLE_CHOICES:300,MOVED_PERMANENTLY:301,FOUND:302,SEE_OTHER:303,NOT_MODIFIED:304,USE_PROXY:305,TEMPORARY_REDIRECT:307,BAD_REQUEST:400,UNAUTHORIZED:401,PAYMENT_REQUIRED:402,FORBIDDEN:403,NOT_FOUND:404,METHOD_NOT_ALLOWED:405,NOT_ACCEPTABLE:406,PROXY_AUTHENTICATION_REQUIRED:407,REQUEST_TIMEOUT:408,CONFLICT:409,GONE:410,LENGTH_REQUIRED:411,PRECONDITION_FAILED:412,REQUEST_ENTITY_TOO_LARGE:413,REQUEST_URI_TOO_LONG:414,UNSUPPORTED_MEDIA_TYPE:415,REQUESTED_RANGE_NOT_SATISFIABLE:416,EXPECTATION_FAILED:417,UNPROCESSABLE_ENTITY:422,LOCKED:423,FAILED_DEPENDENCY:424,TOO_MANY_REQUESTS:429,UNAVAILABLE_FOR_LEGAL_REASONS:451,INTERNAL_SERVER_ERROR:500,NOT_IMPLEMENTED:501,BAD_GATEWAY:502,SERVICE_UNAVAILABLE:503,GATEWAY_TIMEOUT:504,HTTP_VERSION_NOT_SUPPORTED:505,INSUFFICIENT_STORAGE:507}},,function(e,t,n){var i=n(1),o=n(9),r=n(0),a={getPdfFilenameFromUrl:function(e){return"string"!=typeof e||0===e.length?"":i.chain(o.parse(e)).get("pathname","").thru(function(e){return e.split("/")}).last().thru(function(e){var t=decodeURIComponent(e).toLowerCase();return i.endsWith(t,".pdf")?t:""}).value()},isReadcubeUrl:function(e){return-1!==e.indexOf(r.DOMAIN_READCUBE)},isUrlAbsolute:function(e){return e.indexOf("://")>0||0===e.indexOf("//")},isProtocol:function(e,t){return"string"==typeof e&&0!=e.length&&i.chain(o.parse(e)).get("protocol","").thru(function(e){return-1!==t.indexOf(e)}).value()},getHostnameFromUrl:function(e){return"string"!=typeof e||0===e.length?"":o.parse(e).hostname},getUrlWithoutQuery:function(e){return"string"!=typeof e||0===e.length?"":o.format(i.extend(o.parse(e),{hash:null,query:null,search:null}))},publisherWebsiteRegExps:i.reduce(r,function(e,t,n){return n.indexOf("URL_REGEXP_PUBLISHER")>-1?e.concat(t):e},[]),isPublisherWebsite:function(e){if("string"!=typeof e||0===e.length)return!1;var t=a.getUrlWithoutQuery(e);return a.publisherWebsiteRegExps.some(function(e){return"string"==typeof e?-1!==e.indexOf(t):e.test(t)})},isRsc:function(e){if("string"!=typeof e||0===e.length)return!1;var t=a.getUrlWithoutQuery(e);return r.URL_REGEXP_PUBLISHER_RSC.test(t)},isGoogleScholar:function(e){if("string"!=typeof e||0===e.length)return!1;var t=a.getUrlWithoutQuery(e);return r.URL_REGEXP_SOURCE_GOOGLE_SCHOLAR.test(t)},isPubmed:function(e){if("string"!=typeof e||0===e.length)return!1;var t=a.getUrlWithoutQuery(e);return r.URL_REGEXP_SOURCE_PUBMED.test(t)},isReadcubeWebLibrary:function(e){if("string"!=typeof e||0===e.length)return!1;var t=a.getUrlWithoutQuery(e);return r.URL_REGEXP_WEB_LIBRARY_URL.test(t)}};e.exports=a},function(e,t){function n(){throw new Error("setTimeout has not been defined")}function i(){throw new Error("clearTimeout has not been defined")}function o(e){if(u===setTimeout)return setTimeout(e,0);if((u===n||!u)&&setTimeout)return u=setTimeout,setTimeout(e,0);try{return u(e,0)}catch(t){try{return u.call(null,e,0)}catch(t){return u.call(this,e,0)}}}function r(e){if(d===clearTimeout)return clearTimeout(e);if((d===i||!d)&&clearTimeout)return d=clearTimeout,clearTimeout(e);try{return d(e)}catch(t){try{return d.call(null,e)}catch(t){return d.call(this,e)}}}function a(){g&&f&&(g=!1,f.length?h=f.concat(h):b=-1,h.length&&s())}function s(){if(!g){var e=o(a);g=!0;for(var t=h.length;t;){for(f=h,h=[];++b<t;)f&&f[b].run();b=-1,t=h.length}f=null,g=!1,r(e)}}function l(e,t){this.fun=e,this.array=t}function c(){}var u,d,p=e.exports={};!function(){try{u="function"==typeof setTimeout?setTimeout:n}catch(e){u=n}try{d="function"==typeof clearTimeout?clearTimeout:i}catch(e){d=i}}();var f,h=[],g=!1,b=-1;p.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];h.push(new l(e,t)),1!==h.length||g||o(s)},l.prototype.run=function(){this.fun.apply(null,this.array)},p.title="browser",p.browser=!0,p.env={},p.argv=[],p.version="",p.versions={},p.on=c,p.addListener=c,p.once=c,p.off=c,p.removeListener=c,p.removeAllListeners=c,p.emit=c,p.prependListener=c,p.prependOnceListener=c,p.listeners=function(e){return[]},p.binding=function(e){throw new Error("process.binding is not supported")},p.cwd=function(){return"/"},p.chdir=function(e){throw new Error("process.chdir is not supported")},p.umask=function(){return 0}},function(e,t,n){var i=n(3),o=n(1),r=n(0);n(9);e.exports=i({__constructor:function(e){this.id=null,this.pmid=null,this.doi=null,this.gsid=null,this.inLibraryStatus=r.STATUS_NOT_FOUND,this.isReadyForShowing=!1,this.metadata={},this.pdfUrl=null,this.usingPdfUrl=null,this.url=null,this.pdfHash=null,this.hasPdf=!1,this.note="",this.progressPercent=0,this.progressType=r.PROGRESS_DOWNLOAD,o.isObject(e)&&this.extend(e)},extend:function(e){return o.extend(this,e),this},getIdentifiers:function(){return o.pick(this,["doi","pmid","gsid"])},setInLibraryStatus:function(e,t){return e==r.STATUS_IN_LIBRARY?t?this.hasPdf?this.inLibraryStatus=r.STATUS_IN_LIBRARY_WITH_PDF:this.inLibraryStatus=r.STATUS_IN_LIBRARY_WITHOUT_PDF:this.inLibraryStatus=this.hasPdf?r.STATUS_IN_LIBRARY_WITH_PDF:r.STATUS_IN_LIBRARY:this.inLibraryStatus=r.STATUS_NOT_FOUND,this},isProcessingStatus:function(){return this.inLibraryStatus==r.STATUS_METADATA_ADDING||this.inLibraryStatus==r.STATUS_PDF_DOWNLOADING},finishProcessingStatus:function(e){this.hasPdf?this.inLibraryStatus=r.STATUS_IN_LIBRARY_WITH_PDF:this.inLibraryStatus==r.STATUS_METADATA_ADDING?this.inLibraryStatus=r.STATUS_NOT_FOUND:this.inLibraryStatus==r.STATUS_PDF_DOWNLOADING&&(this.inLibraryStatus=e?r.STATUS_IN_LIBRARY_WITHOUT_PDF_WARNING_PROXY:r.STATUS_IN_LIBRARY_WITHOUT_PDF_WARNING)},isInLibrary:function(){var e=!1;switch(this.inLibraryStatus){case r.STATUS_IN_LIBRARY:case r.STATUS_IN_LIBRARY_WITH_PDF:case r.STATUS_IN_LIBRARY_WITHOUT_PDF:case r.STATUS_IN_LIBRARY_WITHOUT_PDF_WARNING:case r.STATUS_IN_LIBRARY_WITHOUT_PDF_WARNING_PROXY:e=!0}return e},isPdfDownloadFailed:function(){var e=!1;switch(this.inLibraryStatus){case r.STATUS_IN_LIBRARY_WITHOUT_PDF_WARNING:case r.STATUS_IN_LIBRARY_WITHOUT_PDF_WARNING_PROXY:e=!0}return e},toJsonForAPI:function(e){var t={ext_ids:this.getIdentifiers(),note:null,return_item:!0};return t.ext_ids.gsid&&t.ext_ids.gsid.indexOf("null")>-1&&(t.ext_ids.gsid=null),o.get(e,"includeMetadata",!1)&&(t.article=this.metadata),o.get(e,"includeNote",!1)&&(t.note=this.note,t.user_data={notes:this.note}),t},toJson:function(){var e={};for(var t in this)"function"!=typeof this[t]&&(e[t]=this[t]);return e},getPdfUrl:function(){return this.pdfUrl?this.pdfUrl:null}})},,,,function(e,t,n){(function(e,t){!function(e,n){"use strict";function i(e){"function"!=typeof e&&(e=new Function(""+e));for(var t=new Array(arguments.length-1),n=0;n<t.length;n++)t[n]=arguments[n+1];var i={callback:e,args:t};return c[l]=i,s(l),l++}function o(e){delete c[e]}function r(e){var t=e.callback,i=e.args;switch(i.length){case 0:t();break;case 1:t(i[0]);break;case 2:t(i[0],i[1]);break;case 3:t(i[0],i[1],i[2]);break;default:t.apply(n,i)}}function a(e){if(u)setTimeout(a,0,e);else{var t=c[e];if(t){u=!0;try{r(t)}finally{o(e),u=!1}}}}if(!e.setImmediate){var s,l=1,c={},u=!1,d=e.document,p=Object.getPrototypeOf&&Object.getPrototypeOf(e);p=p&&p.setTimeout?p:e,"[object process]"==={}.toString.call(e.process)?function(){s=function(e){t.nextTick(function(){a(e)})}}():function(){if(e.postMessage&&!e.importScripts){var t=!0,n=e.onmessage;return e.onmessage=function(){t=!1},e.postMessage("","*"),e.onmessage=n,t}}()?function(){var t="setImmediate$"+Math.random()+"$",n=function(n){n.source===e&&"string"==typeof n.data&&0===n.data.indexOf(t)&&a(+n.data.slice(t.length))};e.addEventListener?e.addEventListener("message",n,!1):e.attachEvent("onmessage",n),s=function(n){e.postMessage(t+n,"*")}}():e.MessageChannel?function(){var e=new MessageChannel;e.port1.onmessage=function(e){a(e.data)},s=function(t){e.port2.postMessage(t)}}():d&&"onreadystatechange"in d.createElement("script")?function(){var e=d.documentElement;s=function(t){var n=d.createElement("script");n.onreadystatechange=function(){a(t),n.onreadystatechange=null,e.removeChild(n),n=null},e.appendChild(n)}}():function(){s=function(e){setTimeout(a,0,e)}}(),p.setImmediate=i,p.clearImmediate=o}}("undefined"==typeof self?void 0===e?this:e:self)}).call(t,n(16),n(14))},function(e,t,n){function i(e,t){this._id=e,this._clearFn=t}var o=Function.prototype.apply;t.setTimeout=function(){return new i(o.call(setTimeout,window,arguments),clearTimeout)},t.setInterval=function(){return new i(o.call(setInterval,window,arguments),clearInterval)},t.clearTimeout=t.clearInterval=function(e){e&&e.close()},i.prototype.unref=i.prototype.ref=function(){},i.prototype.close=function(){this._clearFn.call(window,this._id)},t.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},t.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},t._unrefActive=t.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;t>=0&&(e._idleTimeoutId=setTimeout(function(){e._onTimeout&&e._onTimeout()},t))},n(19),t.setImmediate=setImmediate,t.clearImmediate=clearImmediate},function(e,t,n){var i=n(2),o=n(0);i.module("App").run(["Mixpanel",function(e){var t=chrome.runtime.getManifest().version;e.setProperty(o.MIXPANEL_PROPERTY_BROWSER_EXTENSION_VERSION,t);var n={};n[o.MIXPANEL_SUPER_PROPERTY_CLIENT]="Browser Ext",n[o.MIXPANEL_SUPER_PROPERTY_BROWSER_EXTENSION_VERSION]=t,e.setSuperProperty(n),e.union(o.MIXPANEL_PROPERTY_CLIENTS_USED,"browser_ext")}])},function(e,t,n){function i(e,t){var n=!1;r.init(a.MIXPANEL_TOKEN,{api_host:a.MIXPANEL_API_URL});var i={get:function(){return n?e.resolve(r):(n=!0,t.evaluateLoggedInUserDetail().then(function(t){return t.id?(r.identify(t.id),r):e.reject("Unable to get user id")}).catch(function(t){return console.error(t),e.reject(t)}))},getObjectFromParams:function(e,t){var n={};return"string"==typeof e?n[e]=t:n=e,n},setProperty:function(e,t){return i.get().then(function(n){return n.people.set(i.getObjectFromParams(e,t)),!0})},setSuperProperty:function(e,t){return i.get().then(function(n){return n.register(i.getObjectFromParams(e,t)),!0})},incrementProperty:function(e,t){return i.get().then(function(n){return n.people.increment(i.getObjectFromParams(e,t)),!0})},trackEvent:function(e,t){return i.get().then(function(n){return n.track(e,t),!0})},union:function(e,t){return i.get().then(function(n){return n.people.union(e,t),!0})}};return i}i.$inject=["$q","User"];var o=n(2),r=n(47),a=n(0);o.module("App").factory("Mixpanel",i)},function(e,t,n){function i(e){return{sendToBackground:function(t,n){var i=e.defer();return chrome.runtime.sendMessage({method:t,data:n},function(e){i.resolve(e)}),i.promise},listenForMessages:function(e){function t(t,n,i){return e(t,i),!0}chrome.runtime.onMessage.addListener(t),window.onbeforeunload=function(){chrome.runtime.onMessage.hasListener(t)&&chrome.runtime.onMessage.removeListener(t)}},sendToActiveTab:function(t){var n=e.defer();return chrome.tabs.query({active:!0,currentWindow:!0},function(e){if(0==e.length)return void n.reject("No active tabs were found");chrome.tabs.sendMessage(e[0].id,t,n.resolve)}),n.promise}}}i.$inject=["$q"],n(2).module("App").factory("Message",i)},function(e,t,n){function i(e,t,n){var i={INITIAL:0,PROCESSING:1,DONE:2},o=i.INITIAL,c=[],u={getLoggedInUserDetails:function(){return t.get(r.STORAGE_KEY_LOGGED_IN_USER_DETAILS,null).then(function(e){return a.get(e,"id")?e:n.reject("User data not available in the storage")})},evaluateLoggedInUserDetail:function(){var e=this,t=n.defer();if(o===i.INITIAL)o=i.PROCESSING,c.push(t),e.queryUserDetails().then(function(e){u.setLoggedInUserDetails(e),o=i.DONE,c.forEach(function(t){t.resolve(e)})}).catch(function(t){e.clearLoggedInUserDetails(),o=i.INITIAL,c.forEach(function(e){e.reject(t)})}).finally(function(){c=[]});else{if(o!==i.PROCESSING)return u.getLoggedInUserDetails();c.push(t)}return t.promise},clearProcessingStatus:function(){o=i.INITIAL},getInstitutionProxy:function(){return this.evaluateLoggedInUserDetail().then(function(e){switch(a.get(e,"proxy_url_selection",null)){case r.VALUE_PROXY_URL_SELECTION_NONE:case r.VALUE_PROXY_URL_SELECTION_NULL:return n.reject('Proxy url selection is "none" or "null"');case r.VALUE_PROXY_URL_SELECTION_MANUAL:var t=a.get(e,"proxy_url",null);return t||n.reject("Proxy url is not available");case r.VALUE_PROXY_URL_SELECTION_INSTITUTION:var i=a.get(e,"institution_proxy_url",null);return i||n.reject("Institution proxy url is not available");default:return n.reject("Unknown proxy selection option")}})},getSfxUrlByDoiAndPmid:function(e,t){return this.evaluateLoggedInUserDetail().then(function(i){var o=a.get(i,"sfx_url",null);if(!o)return n.reject("Sfx url is not available");var r=l.parse(o,!0);return e&&(r.query.__DOI__="doi:"+e),t&&(r.query.__PMID__="pmid:"+t),l.format(r).replace("__DOI__","id").replace("__PMID__","id")})},getSubscriptionStatus:function(){return this.querySubscriptionStatus().then(function(e){return"free"===e.account?"expired"===e.status?"trial"===e.previous_type?r.SUBSCRIPTION_TRIAL_EXPIRED:r.SUBSCRIPTION_PRO_EXPIRED:r.SUBSCRIPTION_FREE:r.SUBSCRIPTION_PRO}).catch(function(){return r.SUBSCRIPTION_FREE})},setLoggedInUserDetails:function(e){t.set(r.STORAGE_KEY_LOGGED_IN_USER_DETAILS,e)},clearLoggedInUserDetails:function(){t.set(r.STORAGE_KEY_LOGGED_IN_USER_DETAILS,null),t.set(r.STORAGE_KEY_DISPLAYED_GO_PRO_TOOLTIP,!1)},queryUserDetails:function(){return s.get(r.URL_USER_DETAILS).then(function(e){var t=a.get(e,"data",null);return t?{email:t.email,name:t.full_name,id:t.id,institution:t.institution,institution_proxy_url:t.institution_proxy_url,proxy_url:t.proxy_url,proxy_url_selection:t.proxy_url_selection,sfx_url:t.sfx_url}:n.reject("Unable to get user details")})},querySubscriptionStatus:function(){return s.get(r.URL_SUBSCRIPTION_STATUS).then(function(e){var t=a.get(e,"data",null);return t||n.reject("Unable to load subscription details")})},logout:function(){return s.get(r.URL_LOGOUT,!0)}};return u}i.$inject=["$http","Storage","$q"];var o=n(2),r=n(0),a=n(1),s=n(7),l=n(9);o.module("App").factory("User",i)},function(e,t){function n(e){for(var t=atob(e.split(",")[1]),n=new ArrayBuffer(t.length),i=new Uint8Array(n),o=0;o<t.length;o++)i[o]=t.charCodeAt(o);return n}t.toArrayBuffer=n,t.toBlob=function(e){return new Blob([n(e)])}},function(e,t,n){var i=chrome.storage.local,o=n(8);e.exports={get:function(e,t){void 0===t&&(t=null);var n=o.defer();return i.get(e,function(i){"string"==typeof e&&null==i[e]?n.resolve(t):"object"==typeof e&&null==i?n.resolve(t):"string"==typeof e?n.resolve(i[e]):n.resolve(i)}),n.promise},set:function(e,t){var n={},r=o.defer();if("string"==typeof e)n[e]=t;else{if("object"!=typeof e)return!1;n=e}return i.set(n,r.resolve),r.promise}}},,,function(e,t){e.exports='<div class="tether-content">\n  <div class="readcube-tooltip {{ viewClass }}">\n    <div class="readcube-tooltip-icons">\n      <span ng-if="viewRetry == \'yes\'" title="Retry" class="readcube-icon-close"\n            ng-click="onRetryClick($event)">&#8634;</span>\n      <span ng-if="viewClose == \'yes\'" title="Close tooltip" class="readcube-icon-close"\n            ng-click="onCloseTooltipClick($event)">×</span>\n    </div>\n\n    <div ng-include="viewUrl" ng-if="viewUrl" ng-controller="PdfWarning"></div>\n    <div class="readcube-tooltip-title" ng-if="viewText">{{ viewText }}</div>\n  </div>\n</div>'},,function(e,t,n){var i,o;/*! tether 1.4.0 */
!function(r,a){i=a,void 0!==(o="function"==typeof i?i.call(t,n,t,e):i)&&(e.exports=o)}(0,function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e){var t=e.getBoundingClientRect(),n={};for(var i in t)n[i]=t[i];if(e.ownerDocument!==document){var r=e.ownerDocument.defaultView.frameElement;if(r){var a=o(r);n.top+=a.top,n.bottom+=a.top,n.left+=a.left,n.right+=a.left}}return n}function r(e){var t=getComputedStyle(e)||{},n=t.position,i=[];if("fixed"===n)return[e];for(var o=e;(o=o.parentNode)&&o&&1===o.nodeType;){var r=void 0;try{r=getComputedStyle(o)}catch(e){}if(void 0===r||null===r)return i.push(o),i;var a=r,s=a.overflow,l=a.overflowX;/(auto|scroll)/.test(s+a.overflowY+l)&&("absolute"!==n||["relative","absolute","fixed"].indexOf(r.position)>=0)&&i.push(o)}return i.push(e.ownerDocument.body),e.ownerDocument!==document&&i.push(e.ownerDocument.defaultView),i}function a(){S&&document.body.removeChild(S),S=null}function s(e){var t=void 0;e===document?(t=document,e=document.documentElement):t=e.ownerDocument;var n=t.documentElement,i=o(e),r=O();return i.top-=r.top,i.left-=r.left,void 0===i.width&&(i.width=document.body.scrollWidth-i.left-i.right),void 0===i.height&&(i.height=document.body.scrollHeight-i.top-i.bottom),i.top=i.top-n.clientTop,i.left=i.left-n.clientLeft,i.right=t.body.clientWidth-i.width-i.left,i.bottom=t.body.clientHeight-i.height-i.top,i}function l(e){return e.offsetParent||document.documentElement}function c(){if(P)return P;var e=document.createElement("div");e.style.width="100%",e.style.height="200px";var t=document.createElement("div");u(t.style,{position:"absolute",top:0,left:0,pointerEvents:"none",visibility:"hidden",width:"200px",height:"150px",overflow:"hidden"}),t.appendChild(e),document.body.appendChild(t);var n=e.offsetWidth;t.style.overflow="scroll";var i=e.offsetWidth;n===i&&(i=t.clientWidth),document.body.removeChild(t);var o=n-i;return P={width:o,height:o}}function u(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],t=[];return Array.prototype.push.apply(t,arguments),t.slice(1).forEach(function(t){if(t)for(var n in t)({}).hasOwnProperty.call(t,n)&&(e[n]=t[n])}),e}function d(e,t){if(void 0!==e.classList)t.split(" ").forEach(function(t){t.trim()&&e.classList.remove(t)});else{var n=new RegExp("(^| )"+t.split(" ").join("|")+"( |$)","gi"),i=h(e).replace(n," ");g(e,i)}}function p(e,t){if(void 0!==e.classList)t.split(" ").forEach(function(t){t.trim()&&e.classList.add(t)});else{d(e,t);var n=h(e)+" "+t;g(e,n)}}function f(e,t){if(void 0!==e.classList)return e.classList.contains(t);var n=h(e);return new RegExp("(^| )"+t+"( |$)","gi").test(n)}function h(e){return e.className instanceof e.ownerDocument.defaultView.SVGAnimatedString?e.className.baseVal:e.className}function g(e,t){e.setAttribute("class",t)}function b(e,t,n){n.forEach(function(n){-1===t.indexOf(n)&&f(e,n)&&d(e,n)}),t.forEach(function(t){f(e,t)||p(e,t)})}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function v(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function m(e,t){var n=arguments.length<=2||void 0===arguments[2]?1:arguments[2];return e+n>=t&&t>=e-n}function y(){return"undefined"!=typeof performance&&void 0!==performance.now?performance.now():+new Date}function _(){for(var e={top:0,left:0},t=arguments.length,n=Array(t),i=0;i<t;i++)n[i]=arguments[i];return n.forEach(function(t){var n=t.top,i=t.left;"string"==typeof n&&(n=parseFloat(n,10)),"string"==typeof i&&(i=parseFloat(i,10)),e.top+=n,e.left+=i}),e}function T(e,t){return"string"==typeof e.left&&-1!==e.left.indexOf("%")&&(e.left=parseFloat(e.left,10)/100*t.width),"string"==typeof e.top&&-1!==e.top.indexOf("%")&&(e.top=parseFloat(e.top,10)/100*t.height),e}function w(e,t){return"scrollParent"===t?t=e.scrollParents[0]:"window"===t&&(t=[pageXOffset,pageYOffset,innerWidth+pageXOffset,innerHeight+pageYOffset]),t===document&&(t=t.documentElement),void 0!==t.nodeType&&function(){var e=t,n=s(t),i=n,o=getComputedStyle(t);if(t=[i.left,i.top,n.width+i.left,n.height+i.top],e.ownerDocument!==document){var r=e.ownerDocument.defaultView;t[0]+=r.pageXOffset,t[1]+=r.pageYOffset,t[2]+=r.pageXOffset,t[3]+=r.pageYOffset}K.forEach(function(e,n){e=e[0].toUpperCase()+e.substr(1),"Top"===e||"Left"===e?t[n]+=parseFloat(o["border"+e+"Width"]):t[n]-=parseFloat(o["border"+e+"Width"])})}(),t}var E=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),A=void 0;void 0===A&&(A={modules:[]});var S=null,I=function(){var e=0;return function(){return++e}}(),L={},O=function(){var e=S;e&&document.body.contains(e)||(e=document.createElement("div"),e.setAttribute("data-tether-id",I()),u(e.style,{top:0,left:0,position:"absolute"}),document.body.appendChild(e),S=e);var t=e.getAttribute("data-tether-id");return void 0===L[t]&&(L[t]=o(e),x(function(){delete L[t]})),L[t]},P=null,C=[],x=function(e){C.push(e)},R=function(){for(var e=void 0;e=C.pop();)e()},D=function(){function e(){i(this,e)}return E(e,[{key:"on",value:function(e,t,n){var i=!(arguments.length<=3||void 0===arguments[3])&&arguments[3];void 0===this.bindings&&(this.bindings={}),void 0===this.bindings[e]&&(this.bindings[e]=[]),this.bindings[e].push({handler:t,ctx:n,once:i})}},{key:"once",value:function(e,t,n){this.on(e,t,n,!0)}},{key:"off",value:function(e,t){if(void 0!==this.bindings&&void 0!==this.bindings[e])if(void 0===t)delete this.bindings[e];else for(var n=0;n<this.bindings[e].length;)this.bindings[e][n].handler===t?this.bindings[e].splice(n,1):++n}},{key:"trigger",value:function(e){if(void 0!==this.bindings&&this.bindings[e]){for(var t=0,n=arguments.length,i=Array(n>1?n-1:0),o=1;o<n;o++)i[o-1]=arguments[o];for(;t<this.bindings[e].length;){var r=this.bindings[e][t],a=r.handler,s=r.ctx,l=r.once,c=s;void 0===c&&(c=this),a.apply(c,i),l?this.bindings[e].splice(t,1):++t}}}}]),e}();A.Utils={getActualBoundingClientRect:o,getScrollParents:r,getBounds:s,getOffsetParent:l,extend:u,addClass:p,removeClass:d,hasClass:f,updateClasses:b,defer:x,flush:R,uniqueId:I,Evented:D,getScrollBarSize:c,removeUtilElements:a};var k=function(){function e(e,t){var n=[],i=!0,o=!1,r=void 0;try{for(var a,s=e[Symbol.iterator]();!(i=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);i=!0);}catch(e){o=!0,r=e}finally{try{!i&&s.return&&s.return()}finally{if(o)throw r}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),E=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),N=function(e,t,n){for(var i=!0;i;){var o=e,r=t,a=n;i=!1,null===o&&(o=Function.prototype);var s=Object.getOwnPropertyDescriptor(o,r);if(void 0!==s){if("value"in s)return s.value;var l=s.get;if(void 0===l)return;return l.call(a)}var c=Object.getPrototypeOf(o);if(null===c)return;e=c,t=r,n=a,i=!0,s=c=void 0}};if(void 0===A)throw new Error("You must include the utils.js file before tether.js");var U=A.Utils,r=U.getScrollParents,s=U.getBounds,l=U.getOffsetParent,u=U.extend,p=U.addClass,d=U.removeClass,b=U.updateClasses,x=U.defer,R=U.flush,c=U.getScrollBarSize,a=U.removeUtilElements,M=function(){if("undefined"==typeof document)return"";for(var e=document.createElement("div"),t=["transform","WebkitTransform","OTransform","MozTransform","msTransform"],n=0;n<t.length;++n){var i=t[n];if(void 0!==e.style[i])return i}}(),$=[],B=function(){$.forEach(function(e){e.position(!1)}),R()};!function(){var e=null,t=null,n=null,i=function i(){if(void 0!==t&&t>16)return t=Math.min(t-16,250),void(n=setTimeout(i,250));void 0!==e&&y()-e<10||(null!=n&&(clearTimeout(n),n=null),e=y(),B(),t=y()-e)};"undefined"!=typeof window&&void 0!==window.addEventListener&&["resize","scroll","touchmove"].forEach(function(e){window.addEventListener(e,i)})}();var F={center:"center",left:"right",right:"left"},j={middle:"middle",top:"bottom",bottom:"top"},W={top:0,left:0,middle:"50%",center:"50%",bottom:"100%",right:"100%"},G=function(e,t){var n=e.left,i=e.top;return"auto"===n&&(n=F[t.left]),"auto"===i&&(i=j[t.top]),{left:n,top:i}},H=function(e){var t=e.left,n=e.top;return void 0!==W[e.left]&&(t=W[e.left]),void 0!==W[e.top]&&(n=W[e.top]),{left:t,top:n}},V=function(e){var t=e.split(" "),n=k(t,2);return{top:n[0],left:n[1]}},X=V,Y=function(e){function t(e){var n=this;i(this,t),N(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),this.position=this.position.bind(this),$.push(this),this.history=[],this.setOptions(e,!1),A.modules.forEach(function(e){void 0!==e.initialize&&e.initialize.call(n)}),this.position()}return v(t,e),E(t,[{key:"getClass",value:function(){var e=arguments.length<=0||void 0===arguments[0]?"":arguments[0],t=this.options.classes;return void 0!==t&&t[e]?this.options.classes[e]:this.options.classPrefix?this.options.classPrefix+"-"+e:e}},{key:"setOptions",value:function(e){var t=this,n=arguments.length<=1||void 0===arguments[1]||arguments[1],i={offset:"0 0",targetOffset:"0 0",targetAttachment:"auto auto",classPrefix:"tether"};this.options=u(i,e);var o=this.options,a=o.element,s=o.target,l=o.targetModifier;if(this.element=a,this.target=s,this.targetModifier=l,"viewport"===this.target?(this.target=document.body,this.targetModifier="visible"):"scroll-handle"===this.target&&(this.target=document.body,this.targetModifier="scroll-handle"),["element","target"].forEach(function(e){if(void 0===t[e])throw new Error("Tether Error: Both element and target must be defined");void 0!==t[e].jquery?t[e]=t[e][0]:"string"==typeof t[e]&&(t[e]=document.querySelector(t[e]))}),p(this.element,this.getClass("element")),!1!==this.options.addTargetClasses&&p(this.target,this.getClass("target")),!this.options.attachment)throw new Error("Tether Error: You must provide an attachment");this.targetAttachment=X(this.options.targetAttachment),this.attachment=X(this.options.attachment),this.offset=V(this.options.offset),this.targetOffset=V(this.options.targetOffset),void 0!==this.scrollParents&&this.disable(),"scroll-handle"===this.targetModifier?this.scrollParents=[this.target]:this.scrollParents=r(this.target),!1!==this.options.enabled&&this.enable(n)}},{key:"getTargetBounds",value:function(){if(void 0===this.targetModifier)return s(this.target);if("visible"===this.targetModifier){if(this.target===document.body)return{top:pageYOffset,left:pageXOffset,height:innerHeight,width:innerWidth};var e=s(this.target),t={height:e.height,width:e.width,top:e.top,left:e.left};return t.height=Math.min(t.height,e.height-(pageYOffset-e.top)),t.height=Math.min(t.height,e.height-(e.top+e.height-(pageYOffset+innerHeight))),t.height=Math.min(innerHeight,t.height),t.height-=2,t.width=Math.min(t.width,e.width-(pageXOffset-e.left)),t.width=Math.min(t.width,e.width-(e.left+e.width-(pageXOffset+innerWidth))),t.width=Math.min(innerWidth,t.width),t.width-=2,t.top<pageYOffset&&(t.top=pageYOffset),t.left<pageXOffset&&(t.left=pageXOffset),t}if("scroll-handle"===this.targetModifier){var e=void 0,n=this.target;n===document.body?(n=document.documentElement,e={left:pageXOffset,top:pageYOffset,height:innerHeight,width:innerWidth}):e=s(n);var i=getComputedStyle(n),o=n.scrollWidth>n.clientWidth||[i.overflow,i.overflowX].indexOf("scroll")>=0||this.target!==document.body,r=0;o&&(r=15);var a=e.height-parseFloat(i.borderTopWidth)-parseFloat(i.borderBottomWidth)-r,t={width:15,height:.975*a*(a/n.scrollHeight),left:e.left+e.width-parseFloat(i.borderLeftWidth)-15},l=0;a<408&&this.target===document.body&&(l=-11e-5*Math.pow(a,2)-.00727*a+22.58),this.target!==document.body&&(t.height=Math.max(t.height,24));var c=this.target.scrollTop/(n.scrollHeight-a);return t.top=c*(a-t.height-l)+e.top+parseFloat(i.borderTopWidth),this.target===document.body&&(t.height=Math.max(t.height,24)),t}}},{key:"clearCache",value:function(){this._cache={}}},{key:"cache",value:function(e,t){return void 0===this._cache&&(this._cache={}),void 0===this._cache[e]&&(this._cache[e]=t.call(this)),this._cache[e]}},{key:"enable",value:function(){var e=this,t=arguments.length<=0||void 0===arguments[0]||arguments[0];!1!==this.options.addTargetClasses&&p(this.target,this.getClass("enabled")),p(this.element,this.getClass("enabled")),this.enabled=!0,this.scrollParents.forEach(function(t){t!==e.target.ownerDocument&&t.addEventListener("scroll",e.position)}),t&&this.position()}},{key:"disable",value:function(){var e=this;d(this.target,this.getClass("enabled")),d(this.element,this.getClass("enabled")),this.enabled=!1,void 0!==this.scrollParents&&this.scrollParents.forEach(function(t){t.removeEventListener("scroll",e.position)})}},{key:"destroy",value:function(){var e=this;this.disable(),$.forEach(function(t,n){t===e&&$.splice(n,1)}),0===$.length&&a()}},{key:"updateAttachClasses",value:function(e,t){var n=this;e=e||this.attachment,t=t||this.targetAttachment;var i=["left","top","bottom","right","middle","center"];void 0!==this._addAttachClasses&&this._addAttachClasses.length&&this._addAttachClasses.splice(0,this._addAttachClasses.length),void 0===this._addAttachClasses&&(this._addAttachClasses=[]);var o=this._addAttachClasses;e.top&&o.push(this.getClass("element-attached")+"-"+e.top),e.left&&o.push(this.getClass("element-attached")+"-"+e.left),t.top&&o.push(this.getClass("target-attached")+"-"+t.top),t.left&&o.push(this.getClass("target-attached")+"-"+t.left);var r=[];i.forEach(function(e){r.push(n.getClass("element-attached")+"-"+e),r.push(n.getClass("target-attached")+"-"+e)}),x(function(){void 0!==n._addAttachClasses&&(b(n.element,n._addAttachClasses,r),!1!==n.options.addTargetClasses&&b(n.target,n._addAttachClasses,r),delete n._addAttachClasses)})}},{key:"position",value:function(){var e=this,t=arguments.length<=0||void 0===arguments[0]||arguments[0];if(this.enabled){this.clearCache();var n=G(this.targetAttachment,this.attachment);this.updateAttachClasses(this.attachment,n);var i=this.cache("element-bounds",function(){return s(e.element)}),o=i.width,r=i.height;if(0===o&&0===r&&void 0!==this.lastSize){var a=this.lastSize;o=a.width,r=a.height}else this.lastSize={width:o,height:r};var u=this.cache("target-bounds",function(){return e.getTargetBounds()}),d=u,p=T(H(this.attachment),{width:o,height:r}),f=T(H(n),d),h=T(this.offset,{width:o,height:r}),g=T(this.targetOffset,d);p=_(p,h),f=_(f,g);for(var b=u.left+f.left-p.left,v=u.top+f.top-p.top,m=0;m<A.modules.length;++m){var y=A.modules[m],w=y.position.call(this,{left:b,top:v,targetAttachment:n,targetPos:u,elementPos:i,offset:p,targetOffset:f,manualOffset:h,manualTargetOffset:g,scrollbarSize:L,attachment:this.attachment});if(!1===w)return!1;void 0!==w&&"object"==typeof w&&(v=w.top,b=w.left)}var E={page:{top:v,left:b},viewport:{top:v-pageYOffset,bottom:pageYOffset-v-r+innerHeight,left:b-pageXOffset,right:pageXOffset-b-o+innerWidth}},S=this.target.ownerDocument,I=S.defaultView,L=void 0;return I.innerHeight>S.documentElement.clientHeight&&(L=this.cache("scrollbar-size",c),E.viewport.bottom-=L.height),I.innerWidth>S.documentElement.clientWidth&&(L=this.cache("scrollbar-size",c),E.viewport.right-=L.width),-1!==["","static"].indexOf(S.body.style.position)&&-1!==["","static"].indexOf(S.body.parentElement.style.position)||(E.page.bottom=S.body.scrollHeight-v-r,E.page.right=S.body.scrollWidth-b-o),void 0!==this.options.optimizations&&!1!==this.options.optimizations.moveElement&&void 0===this.targetModifier&&function(){var t=e.cache("target-offsetparent",function(){return l(e.target)}),n=e.cache("target-offsetparent-bounds",function(){return s(t)}),i=getComputedStyle(t),o=n,r={};if(["Top","Left","Bottom","Right"].forEach(function(e){r[e.toLowerCase()]=parseFloat(i["border"+e+"Width"])}),n.right=S.body.scrollWidth-n.left-o.width+r.right,n.bottom=S.body.scrollHeight-n.top-o.height+r.bottom,E.page.top>=n.top+r.top&&E.page.bottom>=n.bottom&&E.page.left>=n.left+r.left&&E.page.right>=n.right){var a=t.scrollTop,c=t.scrollLeft;E.offset={top:E.page.top-n.top+a-r.top,left:E.page.left-n.left+c-r.left}}}(),this.move(E),this.history.unshift(E),this.history.length>3&&this.history.pop(),t&&R(),!0}}},{key:"move",value:function(e){var t=this;if(void 0!==this.element.parentNode){var n={};for(var i in e){n[i]={};for(var o in e[i]){for(var r=!1,a=0;a<this.history.length;++a){var s=this.history[a];if(void 0!==s[i]&&!m(s[i][o],e[i][o])){r=!0;break}}r||(n[i][o]=!0)}}var c={top:"",left:"",right:"",bottom:""},d=function(e,n){if(!1!==(void 0!==t.options.optimizations?t.options.optimizations.gpu:null)){var i=void 0,o=void 0;e.top?(c.top=0,i=n.top):(c.bottom=0,i=-n.bottom),e.left?(c.left=0,o=n.left):(c.right=0,o=-n.right),window.matchMedia&&(window.matchMedia("only screen and (min-resolution: 1.3dppx)").matches||window.matchMedia("only screen and (-webkit-min-device-pixel-ratio: 1.3)").matches||(o=Math.round(o),i=Math.round(i))),c[M]="translateX("+o+"px) translateY("+i+"px)","msTransform"!==M&&(c[M]+=" translateZ(0)")}else e.top?c.top=n.top+"px":c.bottom=n.bottom+"px",e.left?c.left=n.left+"px":c.right=n.right+"px"},p=!1;if((n.page.top||n.page.bottom)&&(n.page.left||n.page.right)?(c.position="absolute",d(n.page,e.page)):(n.viewport.top||n.viewport.bottom)&&(n.viewport.left||n.viewport.right)?(c.position="fixed",d(n.viewport,e.viewport)):void 0!==n.offset&&n.offset.top&&n.offset.left?function(){c.position="absolute";var i=t.cache("target-offsetparent",function(){return l(t.target)});l(t.element)!==i&&x(function(){t.element.parentNode.removeChild(t.element),i.appendChild(t.element)}),d(n.offset,e.offset),p=!0}():(c.position="absolute",d({top:!0,left:!0},e.page)),!p)if(this.options.bodyElement)this.options.bodyElement.appendChild(this.element);else{for(var f=!0,h=this.element.parentNode;h&&1===h.nodeType&&"BODY"!==h.tagName;){if("static"!==getComputedStyle(h).position){f=!1;break}h=h.parentNode}f||(this.element.parentNode.removeChild(this.element),this.element.ownerDocument.body.appendChild(this.element))}var g={},b=!1;for(var o in c){var v=c[o];this.element.style[o]!==v&&(b=!0,g[o]=v)}b&&x(function(){u(t.element.style,g),t.trigger("repositioned")})}}}]),t}(D);Y.modules=[],A.position=B;var q=u(Y,A),k=function(){function e(e,t){var n=[],i=!0,o=!1,r=void 0;try{for(var a,s=e[Symbol.iterator]();!(i=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);i=!0);}catch(e){o=!0,r=e}finally{try{!i&&s.return&&s.return()}finally{if(o)throw r}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),U=A.Utils,s=U.getBounds,u=U.extend,b=U.updateClasses,x=U.defer,K=["left","top","right","bottom"];A.modules.push({position:function(e){var t=this,n=e.top,i=e.left,o=e.targetAttachment;if(!this.options.constraints)return!0;var r=this.cache("element-bounds",function(){return s(t.element)}),a=r.height,l=r.width;if(0===l&&0===a&&void 0!==this.lastSize){var c=this.lastSize;l=c.width,a=c.height}var d=this.cache("target-bounds",function(){return t.getTargetBounds()}),p=d.height,f=d.width,h=[this.getClass("pinned"),this.getClass("out-of-bounds")];this.options.constraints.forEach(function(e){var t=e.outOfBoundsClass,n=e.pinnedClass;t&&h.push(t),n&&h.push(n)}),h.forEach(function(e){["left","top","right","bottom"].forEach(function(t){h.push(e+"-"+t)})});var g=[],v=u({},o),m=u({},this.attachment);return this.options.constraints.forEach(function(e){var r=e.to,s=e.attachment,c=e.pin;void 0===s&&(s="");var u=void 0,d=void 0;if(s.indexOf(" ")>=0){var h=s.split(" "),b=k(h,2);d=b[0],u=b[1]}else u=d=s;var y=w(t,r);"target"!==d&&"both"!==d||(n<y[1]&&"top"===v.top&&(n+=p,v.top="bottom"),n+a>y[3]&&"bottom"===v.top&&(n-=p,v.top="top")),"together"===d&&("top"===v.top&&("bottom"===m.top&&n<y[1]?(n+=p,v.top="bottom",n+=a,m.top="top"):"top"===m.top&&n+a>y[3]&&n-(a-p)>=y[1]&&(n-=a-p,v.top="bottom",m.top="bottom")),"bottom"===v.top&&("top"===m.top&&n+a>y[3]?(n-=p,v.top="top",n-=a,m.top="bottom"):"bottom"===m.top&&n<y[1]&&n+(2*a-p)<=y[3]&&(n+=a-p,v.top="top",m.top="top")),"middle"===v.top&&(n+a>y[3]&&"top"===m.top?(n-=a,m.top="bottom"):n<y[1]&&"bottom"===m.top&&(n+=a,m.top="top"))),"target"!==u&&"both"!==u||(i<y[0]&&"left"===v.left&&(i+=f,v.left="right"),i+l>y[2]&&"right"===v.left&&(i-=f,v.left="left")),"together"===u&&(i<y[0]&&"left"===v.left?"right"===m.left?(i+=f,v.left="right",i+=l,m.left="left"):"left"===m.left&&(i+=f,v.left="right",i-=l,m.left="right"):i+l>y[2]&&"right"===v.left?"left"===m.left?(i-=f,v.left="left",i-=l,m.left="right"):"right"===m.left&&(i-=f,v.left="left",i+=l,m.left="left"):"center"===v.left&&(i+l>y[2]&&"left"===m.left?(i-=l,m.left="right"):i<y[0]&&"right"===m.left&&(i+=l,m.left="left"))),"element"!==d&&"both"!==d||(n<y[1]&&"bottom"===m.top&&(n+=a,m.top="top"),n+a>y[3]&&"top"===m.top&&(n-=a,m.top="bottom")),"element"!==u&&"both"!==u||(i<y[0]&&("right"===m.left?(i+=l,m.left="left"):"center"===m.left&&(i+=l/2,m.left="left")),i+l>y[2]&&("left"===m.left?(i-=l,m.left="right"):"center"===m.left&&(i-=l/2,m.left="right"))),"string"==typeof c?c=c.split(",").map(function(e){return e.trim()}):!0===c&&(c=["top","left","right","bottom"]),c=c||[];var _=[],T=[];n<y[1]&&(c.indexOf("top")>=0?(n=y[1],_.push("top")):T.push("top")),n+a>y[3]&&(c.indexOf("bottom")>=0?(n=y[3]-a,_.push("bottom")):T.push("bottom")),i<y[0]&&(c.indexOf("left")>=0?(i=y[0],_.push("left")):T.push("left")),i+l>y[2]&&(c.indexOf("right")>=0?(i=y[2]-l,_.push("right")):T.push("right")),_.length&&function(){var e=void 0;e=void 0!==t.options.pinnedClass?t.options.pinnedClass:t.getClass("pinned"),g.push(e),_.forEach(function(t){g.push(e+"-"+t)})}(),T.length&&function(){var e=void 0;e=void 0!==t.options.outOfBoundsClass?t.options.outOfBoundsClass:t.getClass("out-of-bounds"),g.push(e),T.forEach(function(t){g.push(e+"-"+t)})}(),(_.indexOf("left")>=0||_.indexOf("right")>=0)&&(m.left=v.left=!1),(_.indexOf("top")>=0||_.indexOf("bottom")>=0)&&(m.top=v.top=!1),v.top===o.top&&v.left===o.left&&m.top===t.attachment.top&&m.left===t.attachment.left||(t.updateAttachClasses(m,v),t.trigger("update",{attachment:m,targetAttachment:v}))}),x(function(){!1!==t.options.addTargetClasses&&b(t.target,g,h),b(t.element,g,h)}),{top:n,left:i}}});var U=A.Utils,s=U.getBounds,b=U.updateClasses,x=U.defer;A.modules.push({position:function(e){var t=this,n=e.top,i=e.left,o=this.cache("element-bounds",function(){return s(t.element)}),r=o.height,a=o.width,l=this.getTargetBounds(),c=n+r,u=i+a,d=[];n<=l.bottom&&c>=l.top&&["left","right"].forEach(function(e){var t=l[e];t!==i&&t!==u||d.push(e)}),i<=l.right&&u>=l.left&&["top","bottom"].forEach(function(e){var t=l[e];t!==n&&t!==c||d.push(e)});var p=[],f=[],h=["left","top","right","bottom"];return p.push(this.getClass("abutted")),h.forEach(function(e){p.push(t.getClass("abutted")+"-"+e)}),d.length&&f.push(this.getClass("abutted")),d.forEach(function(e){f.push(t.getClass("abutted")+"-"+e)}),x(function(){!1!==t.options.addTargetClasses&&b(t.target,f,p),b(t.element,f,p)}),!0}});var k=function(){function e(e,t){var n=[],i=!0,o=!1,r=void 0;try{for(var a,s=e[Symbol.iterator]();!(i=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);i=!0);}catch(e){o=!0,r=e}finally{try{!i&&s.return&&s.return()}finally{if(o)throw r}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();return A.modules.push({position:function(e){var t=e.top,n=e.left;if(this.options.shift){var i=this.options.shift;"function"==typeof this.options.shift&&(i=this.options.shift.call(this,{top:t,left:n}));var o=void 0,r=void 0;if("string"==typeof i){i=i.split(" "),i[1]=i[1]||i[0];var a=i,s=k(a,2);o=s[0],r=s[1],o=parseFloat(o,10),r=parseFloat(r,10)}else o=i.top,r=i.left;return t+=o,n+=r,{top:t,left:n}}}}),q})},function(e,t,n){function i(e,t,n,i,o){function c(n){var o=s.parse(n,!0),a=r.parseInt(e.viewIndex);i.sendToBackground("tabs.CurrentTabId").then(function(n){return r.extend(o.query,{readcubeId:e.viewModel.id,tabId:n,articleIndex:a||0}),t.openTab(s.format(o)),!0}).catch(function(){return t.openTab(s.format(o)),!1})}function u(e){t.openTab(l(a.URL_DOI_RESOLVER,e))}function d(e,i){n.getInstitutionProxy().then(function(n){var o=s.parse(e,!0);r.extend(o.query,{readcubeId:i.id}),t.openTab(n.replace(a.EZPROXY_URL_REPLACE_KEY,s.format(o)))})}function p(t){e.viewModel&&o.downloadPdf(e.viewModel,t)}function f(){t.openTab(a.URL_ACCOUNT)}function h(){t.openTab(a.URL_GET_TRIAL)}function g(){return a.URL_ACCOUNT}e.onOpenLinkClick=c,e.onLoginWithProxyClick=d,e.onDownloadPdfClick=p,e.onOpenDoiClick=u,e.onOpenAccountClick=f,e.onGetTrialClick=h,e.getAccountLink=g,e.proxyIsNotAvailable=!1,e.pdfUrlsAvailable=!1,e.searchingPdfUrls=!1,e.institutionName=null,e.sfxUrl=null,e.pdfUrls=[],n.getInstitutionProxy().catch(function(){e.proxyIsNotAvailable=!0});var b=e.viewModel;b&&(b.doi||b.pmid)&&n.getSfxUrlByDoiAndPmid(b.doi,b.pmid).then(function(t){e.sfxUrl=t}),n.evaluateLoggedInUserDetail().then(function(t){e.institutionName=r.get(t,"institution",null)});var v=e.$watch("viewVisibility.visible",function(t){if(t&&e.viewModel&&e.viewModel.isPdfDownloadFailed()){e.searchingPdfUrls=!0;var n=r.get(e.viewModel,"metadata.title");n&&(e.pdfUrlsAvailable=!0,i.sendToBackground("request.GetPdfUrlsFromGoogleScholar",n).then(function(t){Array.isArray(t)&&t.length>0?e.pdfUrls=t:e.pdfUrlsAvailable=!1,e.searchingPdfUrls=!1})),v()}})}i.$inject=["$scope","BrowserTab","User","Message","TooltipApi"];var o=n(2),r=n(1),a=n(0),s=n(9),l=n(5).sprintf;o.module("App").controller("PdfWarning",i)},function(e,t,n){function i(e){return{restrict:"E",transclude:"element",replace:!0,scope:{viewVisibility:"="},link:function(t,n,i,o,l){t.viewVisibility||(t.viewVisibility={visible:!1});var c=s.extend(e.getOptions(),s.pick(i,["parentSelector","attachment","targetAttachment","targetOffset"])),u=null,d=null,p=null;l(function(e,t){d=a(e[0]).addClass("readcube-tooltip-container").appendTo(a("body")),p=t,u=new r({element:d.get(0),target:a(n).parents(c.parentSelector).get(0),attachment:c.attachment,targetAttachment:c.targetAttachment,targetOffset:c.targetOffset,constraints:c.constraints})}),t.$watch("viewVisibility.visible",function(e){d&&d.toggleClass("readcube-tooltip-hidden",!e)}),t.$on("$destroy",function(){u&&u.destroy(),d&&d.remove(),p&&p.$destroy()});var f=!1;t.$watch(function(){f||(f=!0,t.$$postDigest(function(){f=!1,u.position()}))})}}}i.$inject=["tetherTooltipConfig"];var o=n(2),r=n(31),a=n(4),s=n(1);o.module("App").directive("tetherTooltip",i)},function(e,t,n){function i(){this.config={parentSelector:".readcube-button-holder:first",attachment:"bottom center",targetAttachment:"top center",targetOffset:"-6px 0",constraints:[{to:"scrollParent"}]},this.setOptions=function(e){r.extend(this.config,e)},this.getOptions=function(){return this.config},this.$get=function(){return this}}var o=n(2),r=n(1);o.module("App").provider("tetherTooltipConfig",i)},function(e,t,n){function i(){return{restrict:"E",templateUrl:"tooltip/index",replace:!0,scope:{side:"@",viewModel:"=",viewVisibility:"=",viewText:"@",viewUrl:"@",viewIndex:"@",viewClass:"@",viewClose:"@",viewRetry:"@",viewRetryMethod:"&"},link:function(e,t,n){function i(t){t.stopPropagation(),e.viewVisibility.visible=!1}function o(t){"function"==typeof e.viewRetryMethod&&e.viewRetryMethod()}e.onCloseTooltipClick=i,e.onRetryClick=o,e.viewVisibility||(e.viewVisibility={visible:!1})}}}n(2).module("App").directive("tooltip",i)},function(e,t,n){function i(e,t){return{openLibrary:function(){return t.sendToBackground("tabs.OpenLibrary",null)},openItemInLibrary:function(e,n){return t.sendToBackground("tabs.OpenItemInLibrary",{itemId:e,collectionId:n})},openDocumentInLibrary:function(t,n){return e.open(a(r.URL_LIBRARY_DOCUMENT,t,n))},openTab:function(t){return e.open(t)},openOptions:function(){chrome.tabs.create({url:"options.html"})}}}i.$inject=["$window","Message"];var o=n(2),r=n(0),a=n(5).sprintf;o.module("App").factory("BrowserTab",i)},function(e,t,n){function i(e){return{connectWithBackground:function(t,n){var i=e.defer(),o=chrome.runtime.connect({name:"readcube-extension-connection"}),a=!1;return o.postMessage({message:r.MESSAGE_START,data:n,method:t}),o.onMessage.addListener(function(e){e.message==r.MESSAGE_FINISH?(i.resolve(e.data),a=!0):e.message==r.MESSAGE_PROGRESS&&i.notify(e.data)}),o.onDisconnect.addListener(function(){a||i.resolve(null)}),i.promise}}}i.$inject=["$q"];var o=n(2),r=n(0);o.module("App").factory("Connection",i)},function(e,t,n){function i(e){return{getUploadPromise:function(t,n){var i=new XMLHttpRequest,o=e.defer();return i.upload.addEventListener("progress",function(e){e.lengthComputable?o.notify(parseInt(e.loaded/e.total*100)):o.notify(50)}),i.onreadystatechange=function(e){4==e.target.readyState&&(200==e.target.status?o.resolve(e.target):o.reject(e.target))},i.open("PUT",t,!0),i.setRequestHeader("Content-Type","application/pdf"),i.send(n),o.promise}}}i.$inject=["$q"],n(2).module("App").factory("FileRequest",i)},function(e,t,n){function i(e){var t=e.navigator.onLine;return e.addEventListener("offline",function(){t=!1}),e.addEventListener("online",function(){t=!0}),{isOnline:function(){return t},isOffline:function(){return!t}}}i.$inject=["$window"],n(2).module("App").factory("OnlineStatus",i)},function(e,t,n){function i(e,t){return{status:function(e){if(e.ext_ids.length>100){idsCopy=[].concat(e.ext_ids);var n=idsCopy.splice(0,100);return t.all({statuses:s.post(r.URL_ARTICLES_STATUS,{ext_ids:n}),others:s.post(r.URL_ARTICLES_STATUS,{ext_ids:idsCopy})}).then(function(e){var t=l.get(e,"statuses.data.items",[]),n=l.get(e,"others.data.items",[]);return e.statuses.data.items=t.concat(n),e.statuses})}return s.post(r.URL_ARTICLES_STATUS,e)},updateStatusForArticle:function(e){return this.status({ext_ids:[e.getIdentifiers()]}).then(function(t){var n=l.get(t,"data.items[0]",null);n&&(e.collections=n.collections,e.collection_id=n.collection_id,e.hasPdf=n.has_file,e.id=n.id)})},metadata:function(e){return s.post(r.URL_ARTICLES_METADATA,e)},getStatusWithMetadata:function(e){var n={ext_ids:e};return t.all({articlesStatus:this.status(n),articlesMetadata:this.metadata(n)}).then(function(n){var i=l.get(n,"articlesStatus.data.items",[]),o=l.get(n,"articlesMetadata.data",[]);return 0==i.length?t.reject("No items in the response"):0==o.length?i:(e.forEach(function(e,t){var n=l.find(o,function(t){if(e.doi&&t.doi){if(e.doi.toLowerCase()==t.doi.toLowerCase())return!0}return!(!e.pmid||t.pmid!=e.pmid)||!(!e.gsid||t.gsid!=e.gsid)});n&&l.extend(i[t],{pdfUrl:l.get(n,"pdf_urls[0]",null),pdfHash:l.get(n,"hash",null),url:l.get(n,"url",null)})}),i)})},add:function(e){return s.post(r.URL_ADD_ARTICLE,e)},addWithMetadata:function(e){return s.post(r.URL_ADD_ARTICLE_METADATA,e)},update:function(e,t,n){return s.patch(a(r.URL_COLLECTION_ARTICLE,t,e),n)},get:function(e){return s.get(a(r.URL_ARTICLE_GET,e))}}}i.$inject=["$http","$q"];var o=n(2),r=n(0),a=n(5).sprintf,s=n(7),l=n(1);o.module("App").factory("Article",i)},function(e,t,n){function i(e,t,n){function i(e){return!e.group_id&&!e.name}function o(){return l.get(r.URL_COLLECTIONS).then(function(e){var t=s.get(e,"data.collections",[]),n=[];return t.forEach(function(e){i(e)&&(e.name=r.DEFAULT_PERSONAL_LIBRARY_NAME),n.push(l.get(c(r.URL_COLLECTION_LISTS,e.collection_id)).then(function(t){var n=s.get(t,"data.lists",[]);return e.lists=d(n),!0}))}),a.all(n).then(function(){return u().then(function(e){return{groups:s.reduce(e,function(e,n,i){return e.push({group_id:i,collections:s.filter(t,{group_id:parseInt(i)||null})}),e},[]).sort(function(e){return null!==e}),groupNames:e}})})})}function u(){return l.get(r.URL_GROUPS).then(function(e){var t=s.get(e,"data.groups",[]);return s.reduce(t,function(e,t){return e[t.id]=t.name,e},{null:"Personal"})})}function d(e){function t(e,n,i,o){return s.sortBy(e,"name").forEach(function(e){e.level=i,o.push(e);var r=s.partition(n,{parent_id:e.id});t(r[0],r[1],i+1,o)}),o}var n=s.partition(e,function(e){return!e.parent_id});return t(n[0],n[1],0,[])}return{queryFlat:function(){return o()},queryStorage:function(){return t.get("lists",null).then(function(e){return s.isNull(e)?n.reject("The lists array is empty"):e})},addItems:function(e,t){return l.post(c(r.URL_LISTS_ADD_ITEMS,e),{item_ids:t})},clear:function(){t.set("lists",null)}}}i.$inject=["$http","Storage","$q"];var o=n(2),r=n(0),a=n(8),s=n(1),l=n(7),c=n(5).sprintf;o.module("App").factory("List",i)},function(e,t,n){function i(e,t,n,i){return u(e,{getArticlePdfResolvePromise:function(e){function i(){s--,o.getArticleIdFromFileHash(e).then(function(e){n.cancel(l),a.resolve(e),o.article.extend({id:e,inLibraryStatus:r.STATUS_IN_LIBRARY_WITH_PDF})}),0==s&&(n.cancel(l),a.reject("The PDF was not resolved during 1 minute"),o.article.inLibraryStatus=r.STATUS_PDF_RESOLVE_WARNING)}var o=this,a=t.defer(),s=10;o.article.inLibraryStatus=r.STATUS_PDF_RESOLVING,i();var l=n(i,6e3);return a.promise},getArticleIdFromFileHash:function(e){return c.get(a(r.URL_FILES,e)).then(function(e){var n=s.chain(e).get("data.items",[]).compact().get("[0]",null).value();return n||t.reject("Article id not found")})},upload:function(){var e=this;return e.article.extend({progressPercent:0,progressType:r.PROGRESS_DOWNLOAD,inLibraryStatus:r.STATUS_PDF_DOWNLOADING,usingPdfUrl:e.article.pdfUrl}),t.when(function(){return e.article.pdfUrl?e.getDownloadPromise({url:e.article.pdfUrl,isProxied:!1}):t.reject("Pdf url not available")}()).catch(function(n){return e.article.inLibraryStatus=r.STATUS_IN_LIBRARY_WITHOUT_PDF_WARNING,t.reject(n)}).then(function(n){return e.getArticleIdFromFileHash(n.sha256Hash).then(function(t){return e.article.id=t,e.article.inLibraryStatus=r.STATUS_IN_LIBRARY_WITH_PDF,t}).catch(function(i){if(i.status==l.UNAUTHORIZED)return e.article.inLibraryStatus=r.STATUS_NOT_LOGGED_IN,t.reject(i);var o="";e.article.pdfUrl&&e.article.pdfUrl.length&&(o=encodeURIComponent(e.article.pdfUrl.substring(0,500))),e.article.progressPercent=0,e.article.progressType=r.PROGRESS_UPLOAD;var u,d=e.fixPdfFilename(n.fileName);return u=e.article.collection_id&&e.article.id?a(r.URL_UPLOAD,e.article.collection_id,"false",n.sha256Hash,"","",n.fileSize,e.article.id,encodeURIComponent(d),o):a(r.URL_UPLOAD_DEFAULT,e.article.id?"false":"true",n.sha256Hash,"","",n.fileSize,e.article.id?e.article.id:"",encodeURIComponent(d),o),c.get(u).then(function(i){var o=s.get(i,"data.url");return o?e.getUploadPromise(o,n.blob):t.reject("Unable to receive the upload url")}).then(null,null,function(t){e.article.progressPercent=t}).catch(function(t){return e.evaluateUploadError(t,r.STATUS_IN_LIBRARY_WITHOUT_PDF_WARNING)}).then(function(){return e.article.id?(e.article.inLibraryStatus=r.STATUS_IN_LIBRARY_WITH_PDF,!0):e.getArticlePdfResolvePromise(n.sha256Hash)})})})}})}i.$inject=["Upload","$q","$interval","$http"];var o=n(2),r=n(0),a=n(5).sprintf,s=n(1),l=n(11),c=n(7),u=n(3);o.module("App").factory("RawUpload",i)},function(e,t,n){function i(e,t,n){return a({__constructor:function(e){this.article=e},getUploadPromise:function(t,n){var i=new XMLHttpRequest,o=e.defer();return i.upload.addEventListener("progress",function(e){e.lengthComputable?o.notify(parseInt(e.loaded/e.total*100)):o.notify(50)}),i.onreadystatechange=function(e){4==e.target.readyState&&(200==e.target.status?o.resolve(e.target):o.reject(e.target))},i.open("PUT",t,!0),i.setRequestHeader("Content-Type","application/pdf"),i.send(n),o.promise},getDownloadPromise:function(n){var i=this;return n.url?t.connectWithBackground("request.GetPdfBase64",n).then(function(t){return t&&t.base64&&t.sha256Hash?{blob:r.toBlob(t.base64),sha256Hash:t.sha256Hash,fileSize:t.fileSize,fileName:t.fileName}:e.reject("No PDF file was found")},null,function(e){i.article.progressPercent=e.percent}):e.reject("No PDF url provided")},upload:function(){throw new Error("Method not implemented")},evaluateUploadError:function(t,i){var o=this;return t.status===s.UNPROCESSABLE_ENTITY?t:t.status===s.FORBIDDEN?n.getSubscriptionStatus().then(function(t){switch(t){case l.SUBSCRIPTION_TRIAL_EXPIRED:return o.article.inLibraryStatus=l.STATUS_IN_LIBRARY_WITHOUT_PDF_EXPIRED_TRIAL,e.reject("Unable to add pdf because the trial period is expired");case l.SUBSCRIPTION_PRO_EXPIRED:return o.article.inLibraryStatus=l.STATUS_IN_LIBRARY_WITHOUT_PDF_EXPIRED_SUBSCRIPTION,e.reject("Unable to add pdf because the subscription is expired");default:return o.article.inLibraryStatus=l.STATUS_IN_LIBRARY_WITHOUT_PDF_NO_SUBSCRIPTION,e.reject("Unable to add pdf because the account is without subscription")}}):(i&&(o.article.inLibraryStatus=i),e.reject(t))},fixPdfFilename:function(e){if(e)return e;var t=c.get(this.article,"metadata.title",""),n=(new Date).toLocaleString();return t?t+".pdf":this.article.usingPdfUrl?u.getHostnameFromUrl(this.article.usingPdfUrl)+" "+n+".pdf":n+".pdf"}})}i.$inject=["$q","Connection","User"];var o=n(2),r=n(25),a=n(3),s=n(11),l=n(0),c=n(1),u=n(13);o.module("App").factory("Upload",i)},function(e,t,n){function i(){return{downloadPdf:function(e,t){this.article=e,this.pdfUrl=t,++this.messageCount},article:null,pdfUrl:null,messageCount:0}}n(2).module("App").factory("TooltipApi",i)},,,,function(e,t){e.exports='<div ng-switch="buttonData.inLibraryStatus" class="readcube-relative">\n  <a ng-switch-when="in_library"  class="readcube-button right-space" href ng-click="onInLibraryClick($event)">\n    <span class="readcube-icon-extended readcube-icon-check"></span> In Library\n    <span class="readcube-triangle-holder" ng-click="onTriangleClick($event)" ng-hide="isPopup">\n      <span class="readcube-icon readcube-icon-triangle readcube-icon-triangle-imported"></span>\n    </span>\n  </a>\n\n  <a ng-switch-when="in_library_with_pdf" class="readcube-button right-space-icon" href ng-click="onInLibraryClick($event)">\n    <span class="readcube-icon-extended readcube-icon-check"></span> In Library\n    <span class="readcube-triangle-holder" ng-click="onTriangleClick($event)" ng-hide="isPopup">\n      <span class="readcube-icon readcube-icon-triangle readcube-icon-triangle-imported"></span>\n    </span>\n    <span class="readcube-right-box" ng-click="onInLibraryDocumentClick($event)">\n      <span class="readcube-icon-extended readcube-icon-document"></span>\n    </span>\n  </a>\n\n  <a ng-switch-when="in_library_without_pdf" class="readcube-button right-space-icon" href ng-click="onInLibraryClick($event)">\n    <span class="readcube-icon-extended readcube-icon-check"></span> In Library\n    <span class="readcube-triangle-holder" ng-click="onTriangleClick($event)" ng-hide="isPopup">\n      <span class="readcube-icon readcube-icon-triangle readcube-icon-triangle-imported"></span>\n    </span>\n    <span class="readcube-right-box-gray" ng-click="onDownloadPdfClick($event)">\n      <span class="readcube-icon-extended readcube-icon-arrow-down"></span>\n    </span>\n  </a>\n\n  <a ng-switch-when="in_library_without_pdf_warning_proxy" class="readcube-button right-space-icon" href\n     ng-click="onInLibraryClick($event)">\n    <span class="readcube-icon-extended readcube-icon-check"></span> In Library\n    <span class="readcube-triangle-holder" ng-click="onTriangleClick($event)" ng-hide="isPopup">\n      <span class="readcube-icon readcube-icon-triangle readcube-icon-triangle-imported"></span>\n    </span>\n    <span class="readcube-right-box-orange" ng-click="onShowTooltipClick($event)">\n      <span class="readcube-exclamation">!</span>\n    </span>\n  </a>\n\n  <div ng-switch-when="in_library_without_pdf_warning_proxy">\n    <tether-tooltip view-visibility="tooltipVisibility">\n      <tooltip view-visibility="tooltipVisibility" view-url="tooltip/pdf_warning_proxy" view-class="readcube-tooltip-warning"\n        view-model="buttonData" view-index="{{buttonIndex}}" view-close="yes"></tooltip>\n    </tether-tooltip>\n  </div>\n\n  <a ng-switch-when="in_library_without_pdf_warning" class="readcube-button right-space-icon" href ng-click="onInLibraryClick($event)">\n    <span class="readcube-icon-extended readcube-icon-check"></span> In Library\n    <span class="readcube-triangle-holder" ng-click="onTriangleClick($event)" ng-hide="isPopup">\n      <span class="readcube-icon readcube-icon-triangle readcube-icon-triangle-imported"></span>\n    </span>\n    <span class="readcube-right-box-orange" ng-click="onShowTooltipClick($event)">\n      <span class="readcube-exclamation">!</span>\n    </span>\n  </a>\n  <div ng-switch-when="in_library_without_pdf_warning">\n    <tether-tooltip view-visibility="tooltipVisibility">\n      <tooltip view-url="tooltip/pdf_warning" view-class="readcube-tooltip-warning" view-visibility="tooltipVisibility"\n        view-model="buttonData" view-index="{{buttonIndex}}" view-close="yes"></tooltip>\n    </tether-tooltip>\n  </div>\n\n  <a ng-switch-when="not_found" class="readcube-button readcube-decolored" href ng-click="onAddToLibraryClick($event)"\n     ng-mouseenter="onMouseEnter()" ng-mouseleave="onMouseLeave()">\n    <span class="readcube-icon readcube-icon-add"></span>\n    ReadCube\n    <span class="readcube-triangle-holder" ng-click="onTriangleClick($event)">\n      <span class="readcube-icon readcube-icon-triangle"></span>\n    </span>\n  </a>\n\n  <a ng-switch-when="metadata_adding" class="readcube-button right-space-icon left-space" href="#"\n     ng-click="preventPropagation($event)">\n    Importing...\n    <span class="readcube-right-box" ng-click="onShowTooltipClick($event)">\n      <span class="readcube-icon-extended readcube-icon-circle"></span>\n    </span>\n  </a>\n  <div ng-switch-when="metadata_adding">\n    <tether-tooltip view-visibility="tooltipVisibility">\n      <tooltip view-visibility="tooltipVisibility" view-text="Adding metadata to your library..." view-close="yes"></tooltip>\n    </tether-tooltip>\n  </div>\n\n  <a ng-switch-when="pdf_downloading" class="readcube-button right-space-icon" href="#">\n    <span class="readcube-icon-extended readcube-icon-check"></span> In Library\n    <span class="readcube-triangle-holder" ng-click="onTriangleClick($event)" ng-hide="isPopup">\n      <span class="readcube-icon readcube-icon-triangle readcube-icon-triangle-imported"></span>\n    </span>\n    <span class="readcube-right-box" ng-click="onShowTooltipClick($event)">\n      <span class="readcube-icon-extended readcube-icon-circle"></span>\n    </span>\n  </a>\n  <div ng-switch-when="pdf_downloading">\n    <tether-tooltip view-visibility="tooltipVisibility">\n      <tooltip view-url="tooltip/pdf_downloading" view-model="buttonData" view-visibility="tooltipVisibility"\n               view-class="readcube-tooltip-progress" view-close="yes"></tooltip>\n    </tether-tooltip>\n  </div>\n\n  <a href="#" ng-switch-when="status_in_library_without_pdf_no_subscription" class="readcube-button right-space-icon"\n     ng-click="onInLibraryClick($event)">\n    <span class="readcube-icon-extended readcube-icon-check"></span> In Library\n    <span class="readcube-triangle-holder" ng-click="onTriangleClick($event)" ng-hide="isPopup">\n      <span class="readcube-icon readcube-icon-triangle readcube-icon-triangle-imported"></span>\n    </span>\n    <span class="readcube-right-box" ng-click="onShowTooltipClick($event)">\n      <span class="readcube-icon-extended readcube-icon-arrow-down"></span>\n    </span>\n  </a>\n  <div ng-switch-when="status_in_library_without_pdf_no_subscription">\n    <tether-tooltip view-visibility="tooltipVisibility">\n      <tooltip view-close="yes" view-class="readcube-tooltip-warning" view-url="tooltip/pdf_no_subscription"\n               view-visibility="tooltipVisibility"></tooltip>\n    </tether-tooltip>\n  </div>\n\n  <a href="#" ng-switch-when="status_in_library_without_pdf_expired_subscription" class="readcube-button right-space-icon"\n     ng-click="onInLibraryClick($event)">\n    <span class="readcube-icon-extended readcube-icon-check"></span> In Library\n    <span class="readcube-triangle-holder" ng-click="onTriangleClick($event)" ng-hide="isPopup">\n      <span class="readcube-icon readcube-icon-triangle readcube-icon-triangle-imported"></span>\n    </span>\n    <span class="readcube-right-box" ng-click="onShowTooltipClick($event)">\n      <span class="readcube-icon-extended readcube-icon-arrow-down"></span>\n    </span>\n  </a>\n  <div ng-switch-when="status_in_library_without_pdf_expired_subscription">\n    <tether-tooltip view-visibility="tooltipVisibility">\n      <tooltip view-close="yes" view-class="readcube-tooltip-warning" view-url="tooltip/pdf_expired_subscription"\n               view-visibility="tooltipVisibility"></tooltip>\n    </tether-tooltip>\n  </div>\n\n  <a href="#" ng-switch-when="status_in_library_without_pdf_expired_trial" class="readcube-button right-space-icon"\n     ng-click="onInLibraryClick($event)">\n    <span class="readcube-icon-extended readcube-icon-check"></span> In Library\n    <span class="readcube-triangle-holder" ng-click="onTriangleClick($event)" ng-hide="isPopup">\n      <span class="readcube-icon readcube-icon-triangle readcube-icon-triangle-imported"></span>\n    </span>\n    <span class="readcube-right-box" ng-click="onShowTooltipClick($event)">\n      <span class="readcube-icon-extended readcube-icon-arrow-down"></span>\n    </span>\n  </a>\n  <div ng-switch-when="status_in_library_without_pdf_expired_trial">\n    <tether-tooltip view-visibility="tooltipVisibility">\n      <tooltip view-close="yes" view-class="readcube-tooltip-warning" view-url="tooltip/pdf_expired_trial"\n               view-visibility="tooltipVisibility"></tooltip>\n    </tether-tooltip>\n  </div>\n\n  <div ng-if="offlineTooltipVisibility.visible">\n    <tether-tooltip view-visibility="offlineTooltipVisibility">\n      <tooltip view-close="yes" view-text="Import error - please check your network connection and try again"\n               view-visibility="offlineTooltipVisibility"></tooltip>\n    </tether-tooltip>\n  </div>\n</div>\n'},function(e,t){e.exports='<div class="readcube-dropdown-container" ng-show="show">\n  <div class="dropdown-menu-triangle" ng-class="{down :!isBelowButton, up: isBelowButton}" ng-style="triangleStyle"></div>\n  <ul class="dropdown-menu" ng-style="boxStyle">\n    <button ng-if="shouldDisplayAddButton" ng-click="addToLibrary()" type="button"\n            class="add-to-library-button"\n            style="margin:0 auto; display:block;">\n      Add to Library\n    </button>\n    <li ng-repeat="data in options.groups"\n      class="dropdown-group-name">\n      <span class="dropdown-collection-header" ng-if="hasMultipleCollections()">\n        {{ options.groupNames[data.group_id] }}\n      </span>\n      <ul class="dropdown-group-list" ng-repeat="collection in data.collections">\n        <li class="dropdown-collection-name">\n          <label\n            ng-click="$event.stopPropagation()"\n            style="padding-left: 20px"\n            class="dropdown-truncate">\n            <input\n              class="dropdown-checkbox"\n              type="checkbox"\n              ng-disabled="collection.disabled"\n              ng-model="collection.selected">\n              {{ collection.name }}<span\n                ng-show="!shouldDisplayAddButton && collection._imported"\n                style="cursor: pointer"\n                ng-click="onClickOpenArrow($event, collection.collection_id)"> ➜</span>\n          </label>\n        </li>\n        <ul class="dropdown-group-list" ng-repeat="list in collection.lists">\n          <li class="dropdown-list-name">\n            <label\n              ng-click="$event.stopPropagation()"\n              ng-style="{\'padding-left\': ((list.level + 2) * 20) + \'px\' }"\n              class="dropdown-truncate">\n              <input\n                class="dropdown-checkbox"\n                type="checkbox"\n                ng-disabled="list.disabled"\n                ng-model="list.selected">\n                {{ list.name }}<span\n                  ng-show="!shouldDisplayAddButton && list._imported"\n                  style="cursor: pointer"\n                  ng-click="onClickOpenArrow($event, collection.collection_id)"> ➜</span>\n            </label>\n          </li>\n        </ul>\n      </ul>\n    </li>\n  </ul>\n</div>\n'},,function(e,t){e.exports='<span\n  ng-if="isInSharedLibrary()"\n  class="readcube-icon-shared-library"\n  ng-attr-title="{{sharedLibrariesTooltip()}}"\n></span>\n'},function(e,t){e.exports='<div class="readcube-progress-bar"\n     ng-class="{\'readcube-progress-bar-upload\': viewModel.progressType == \'progress_upload\',\n      \'readcube-cancel-transition\': viewModel.progressPercent == 100 }"\n     style="width: {{ viewModel.progressPercent }}%"></div>\n<div class="reacube-tooltip-content">\n  <div class="readcube-tooltip-title">\n    Downloading PDF from {{ viewModel.usingPdfUrl | hostname }}...\n  </div>\n</div>'},function(e,t){e.exports='<div class="readcube-tooltip-title">\n  Article metadata imported. <br/> Your <a href="{{ getAccountLink() }}" target="_blank">ReadCube Pro</a> has expired -\n  re-subscribe to also automatically find and import PDFs\n</div>\n<div>\n  <button ng-click="onOpenAccountClick()" class="readcube-blue-button">\n    Go Pro\n  </button>\n  <button ng-click="viewVisibility.visible = false" class="readcube-blue-button readcube-blue-button-disabled">\n    Later\n  </button>\n</div>'},function(e,t){e.exports='<div class="readcube-tooltip-title">\n  Article metadata imported. Your ReadCube Pro has expired - <a href="{{ getAccountLink() }}" target="_blank">re-subscribe</a>\n  or get another 30 day free trial to automatically find and import PDFs\n</div>\n<div>\n  <button ng-click="onOpenAccountClick()" class="readcube-blue-button readcube-small-button">\n    Go Pro\n  </button>\n  <button ng-click="onGetTrialClick()" class="readcube-blue-button readcube-small-button">\n    Get Trial\n  </button>\n  <button ng-click="viewVisibility.visible = false" class="readcube-blue-button readcube-blue-button-disabled readcube-small-button">\n    Later\n  </button>\n</div>'},function(e,t){e.exports='<div ng-if="searchingPdfUrls" class="readcube-tooltip-searching-locations">\n  <span class="readcube-icon-extended readcube-icon-circle"></span> Searching for more download locations...\n</div>\n<div ng-if="!searchingPdfUrls" class="readcube-tooltip-pdf-text">\n  This full text PDF of this article may be available from one or more of the following sites:\n</div>\n<div ng-if="!searchingPdfUrls" class="readcube-tooltip-pdfs-list">\n  <div class="readcube-tooltip-pdf" ng-repeat="pdfUrl in pdfUrls">\n    <span ng-click="onDownloadPdfClick(pdfUrl)" title="Import pdf" class="readcube-tooltip-pdf-download">\n      <span class="readcube-icon-extended readcube-icon-download"></span>\n    </span>\n    <span class="readcube-tooltip-pdf-hostname" title="Open pdf file {{ pdfUrl }}" ng-click="onOpenLinkClick(pdfUrl)">{{pdfUrl | hostname}}</span>\n  </div>\n</div>\n'},function(e,t){e.exports='<div class="readcube-tooltip-title">\n  Article metadata imported. <br/> Try <a href="{{ getAccountLink() }}" target="_blank">ReadCube Pro</a> to also automatically\n  find and import PDFs. Start your risk-free 30 day trial?\n</div>\n<div>\n  <button ng-click="onOpenAccountClick()" class="readcube-blue-button">\n    Start trial\n  </button>\n  <button ng-click="viewVisibility.visible = false" class="readcube-blue-button readcube-blue-button-disabled">\n    Later\n  </button>\n</div>'},function(e,t){e.exports='<div class="readcube-tooltip-title">\n  Automatic PDF Download Unsuccessful\n</div>\n<div>\n  <button ng-if="viewModel.url" ng-click="onOpenLinkClick(viewModel.url)" class="readcube-blue-button">\n    Go to Article Page\n  </button>\n  <button ng-if="!viewModel.url && viewModel.doi" ng-click="onOpenDoiClick(viewModel.doi)" class="readcube-blue-button">\n    Go to Article Page\n  </button>\n  <span class="readcube-icon-holder">\n    <button ng-if="viewModel.pdfUrl" ng-click="onOpenLinkClick(viewModel.pdfUrl)" class="readcube-blue-button">\n      Go to PDF\n    </button>\n    <span ng-if="viewModel.pdfUrl" class="readcube-icon-extended readcube-icon-lock"></span>\n  </span>\n  <div ng-if="institutionName && sfxUrl" class="readcube-institution-sfx">\n    <a href="{{ sfxUrl }}" target="_blank"><span class="readcube-icon-extended readcube-icon-arrow-orange"></span></a>\n    <a href="{{ sfxUrl }}" target="_blank">Find at {{ institutionName }} (SFX)</a>\n  </div>\n  <div ng-if="pdfUrlsAvailable" ng-include="\'tooltip/pdf_list\'" class="readcube-pdf-advanced-search"></div>\n</div>'},function(e,t){e.exports='<div class="readcube-tooltip-title">\n  Automatic PDF Download Unsuccessful\n</div>\n<div>\n  <button ng-if="viewModel.url" ng-click="onLoginWithProxyClick(viewModel.url, viewModel)" class="readcube-blue-button">\n    Go to Article Page\n  </button>\n  <button ng-if="!viewModel.url && viewModel.doi" ng-click="onOpenDoiClick(viewModel.doi)" class="readcube-blue-button">\n    Go to Article Page\n  </button>\n  <span class="readcube-icon-holder">\n    <button ng-if="viewModel.pdfUrl" ng-click="onLoginWithProxyClick(viewModel.pdfUrl, viewModel)"\n            class="readcube-blue-button">\n      Go to PDF\n    </button>\n    <span ng-if="viewModel.pdfUrl" class="readcube-icon-extended readcube-icon-lock"></span>\n  </span>\n  <div ng-if="institutionName && sfxUrl" class="readcube-institution-sfx">\n    <a href="{{ sfxUrl }}" target="_blank"><span class="readcube-icon-extended readcube-icon-arrow-orange"></span></a>\n    <a href="{{ sfxUrl }}" target="_blank">Find at {{ institutionName }} (SFX)</a>\n  </div>\n  <div ng-if="pdfUrlsAvailable" ng-include="\'tooltip/pdf_list\'" class="readcube-pdf-advanced-search"></div>\n</div>'},,function(e,t,n){n(2).module("App").run(["$templateCache",function(e){e.put("tooltip/pdf_expired_subscription",n(53)),e.put("tooltip/pdf_expired_trial",n(54)),e.put("tooltip/pdf_no_subscription",n(56)),e.put("tooltip/pdf_downloading",n(52)),e.put("tooltip/pdf_warning",n(57)),e.put("tooltip/pdf_warning_proxy",n(58)),e.put("tooltip/pdf_list",n(55)),e.put("tooltip/index",n(29))}])},,function(e,t,n){function i(e,t,n,i,o,c,u,d,p,f,h,g,b,v){function m(e){o.listenForMessages(function(t,n){switch(t.message){case r.MESSAGE_GET_ARTICLES:n(N.articlesList);break;case r.MESSAGE_UPDATE_ARTICLE:var i=a.get(t,"data.updateDetails",{}),o=a.get(t,"data.index",null);if(!a.isNull(o)&&!a.isEmpty(i)){var s=N.articlesList.filter(function(e){return e.isReadyForShowing});a.extend(s[o],i),b.$apply()}n(!0);break;case r.MESSAGE_IS_ABSTRACT_PAGE:n(e.isAbstractPage());break;case r.MESSAGE_SELECT_ALL_SHOW:n(!0);break;case r.MESSAGE_SHOW_LOGIN:N.loginIframe.show=!0,N.queuedArticleIndexes=a.get(t,"data.queuedArticleIndexes",[]),b.$apply(),n(!0);break;default:n(null)}})}function y(){b.tooltipApi=v,b.$watchGroup(["tooltipApi.article","tooltipApi.pdfUrl","tooltipApi.messageCount"],function(e){var t=a.get(e,"[0]"),n=a.get(e,"[1]");t&&n&&N.onDownloadRawPdf(t,n)})}function _(e){var t=N.articlesList[e];n.openDocumentInLibrary(t.collection_id,t.id)}function T(e){var t=N.articlesList[e];n.openItemInLibrary(t.id,t.collection_id),h.trackEvent(r.MIXPANEL_EVENT_INJECTED_BUTTON_IN_LIBRARY_CLICKED)}function w(){var e=!1,t=!1;return d.get(r.SETTING_BUTTON_AVAILABLE_ON,[r.VALUE_BUTTON_AVAILABLE_ON_GOOGLE_SCHOLAR,r.VALUE_BUTTON_AVAILABLE_ON_PUBMED,r.VALUE_BUTTON_AVAILABLE_ON_PUBLISHER_WEBSITES]).then(function(t){return e=t.indexOf(g)>-1,d.get(r.SETTING_PDF_DOWNLOAD,r.VALUE_PDF_DOWNLOAD_AUTOMATIC_ENABLED)}).then(function(e){t=e==r.VALUE_PDF_DOWNLOAD_AUTOMATIC_ENABLED;var n=E();return n.length?i.getStatusWithMetadata(n):[]}).then(function(n){n.forEach(function(n,i){var o=N.articlesList[i];o.extend({isReadyForShowing:o.metadata&&e,id:a.get(n,"id",null),note:n.notes,pdfUrl:n.pdfUrl,pdfHash:n.pdfHash,hasPdf:n.has_file,collections:n.collections,collection_id:n.collection_id,url:n.url}).setInLibraryStatus(n.status,t)})}).catch(function(t){return a.each(N.articlesList,function(t){t.isReadyForShowing=e}),console.error(t),!0}).finally(function(){var e=N.articlesList.filter(function(e){return e.isReadyForShowing});o.sendToBackground("browser_action.SetBadgeAndIcon",e.length)})}function E(){return a.map(N.articlesList,function(e){return e.getIdentifiers()})}function A(e){e.get().forEach(function(e){N.articlesList.push(new l(e))})}function S(e,t,n){var i=N.articlesList[t];c.toggleDropdown(e,t,i,n)}function I(e){c.hideDropdown();var t=N.articlesList[e],n="";switch(g){case r.VALUE_BUTTON_AVAILABLE_ON_GOOGLE_SCHOLAR:n="Google scholar";break;case r.VALUE_BUTTON_AVAILABLE_ON_PUBMED:n="Pubmed";break;default:n="Publisher sites"}return h.trackEvent(r.MIXPANEL_EVENT_INJECTED_BUTTON_ADD_TO_LIBRARY_CLICKED,{"Browser Ext Site Type":n}),!t.isProcessingStatus()&&(t.inLibraryStatus=r.STATUS_METADATA_ADDING,C(t,e).then(function(e){return P(t)}).finally(function(){N.updateStatusForArticle(t).then(function(){D(t).then(function(){chrome.runtime.sendMessage({message:r.MESSAGE_UPDATE_POPUP_ARTICLE_FROM_CONTENT_SCRIPT,data:{index:e,updateDetails:{id:t.id,inLibraryStatus:t.inLibraryStatus,collection_id:t.collection_id,collections:t.collections}}})})})}))}function L(e){var t=N.articlesList[e];return!t.isProcessingStatus()&&P(t).finally(function(){D(t)})}function O(e,n){var i=new t(e),o=e.pdfUrl,a=e.inLibraryStatus;return e.extend({pdfUrl:n,usingPdfUrl:n}),h.setProperty(r.MIXPANEL_PROPERTY_BROWSER_EXTENSION_LAST_SEEN,(new Date).toISOString()),i.upload().then(function(e){h.incrementProperty(r.MIXPANEL_PROPERTY_BROWSER_EXTENSION_PDF,1),h.trackEvent(r.MIXPANEL_EVENT_PDF_DOWNLOADED)}).catch(function(e){h.trackEvent(r.MIXPANEL_EVENT_PDF_DOWNLOAD_FAILED)}).finally(function(){e.pdfUrl=o,e.isPdfDownloadFailed()&&(e.inLibraryStatus=a)})}function P(t,n,i){return d.get(r.SETTING_PDF_DOWNLOAD,r.VALUE_PDF_DOWNLOAD_AUTOMATIC_ENABLED).then(function(n){return n!==r.VALUE_PDF_DOWNLOAD_AUTOMATIC_ENABLED?u.reject("Automatic PDF upload is not enabled"):(h.setProperty(r.MIXPANEL_PROPERTY_BROWSER_EXTENSION_LAST_SEEN,(new Date).toISOString()),t.inLibraryStatus=r.STATUS_PDF_DOWNLOADING,new e(t).upload(i).then(function(e){h.incrementProperty(r.MIXPANEL_PROPERTY_BROWSER_EXTENSION_PDF,1),h.trackEvent(r.MIXPANEL_EVENT_PDF_DOWNLOADED),a.extend(t,{inLibraryStatus:r.STATUS_IN_LIBRARY_WITH_PDF})}).catch(function(e){return h.trackEvent(r.MIXPANEL_EVENT_PDF_DOWNLOAD_FAILED),console.error(e),u.reject("PDF upload and resolve failed")}))})}function C(e,t,n){return void 0===n&&(n=!1),h.setProperty(r.MIXPANEL_PROPERTY_BROWSER_EXTENSION_LAST_SEEN,(new Date).toISOString()),o.sendToBackground("article.AddFromMetadata",{article:e.toJson(),index:t,includeNote:n}).then(function(n){return n.success?(e.extend(n.article),h.incrementProperty(r.MIXPANEL_PROPERTY_BROWSER_EXTENSION_IMPORTED,1),h.trackEvent(r.MIXPANEL_EVENT_METADATA_IMPORTED),n):n.status===s.UNAUTHORIZED?(N.loginIframe.show=!0,N.queuedArticleIndexes=[t],u.reject("User is not authorized")):u.reject(n)})}function x(e){N.loginIframe.show=!1,N.loadArticles().then(c.loadListOptions).then(N.addQueuedArticles).finally(function(){N.queuedArticleIndexes=[]}),f.setLoggedInUserDetails(e)}function R(){var e=[];return a.each(N.queuedArticleIndexes,function(t){N.articlesList[t].isInLibrary()||e.push(N.onAddToLibraryClick(t))}),u.all(e)}function D(e){return f.getInstitutionProxy().then(function(t){return e.finishProcessingStatus(!0),!0}).catch(function(){return e.finishProcessingStatus(!1),!1})}function k(e){h.trackEvent(r.MIXPANEL_EVENT_INJECTED_BUTTON_LIST_SELECTED),this.onAddToLibraryClick(e)}var N=this;N.articlesList=[],N.loginIframe={show:!1},N.queuedArticleIndexes=[],N.onInLibraryDocumentClick=_,N.onInLibraryClick=T,N.onTriangleClick=S,N.onAddToLibraryClick=I,N.onDownloadRawPdf=O,N.onDownloadPdfClick=L,N.onListClick=k,N.onSuccessfullyLoggedIn=x,N.addArticleFromPDF=P,N.addArticleFromMetadata=C,N.initArticles=A,N.loadArticles=w,N.listenForMessages=m,N.listenForTooltip=y,N.finishArticleStatus=D,N.addQueuedArticles=R,N.updateStatusForArticle=i.updateStatusForArticle.bind(i)}i.$inject=["ProxyUpload","RawUpload","BrowserTab","Article","Message","ListDropdownApi","$q","Storage","List","User","Mixpanel","SiteType","$scope","TooltipApi"];var o=n(2),r=n(0),a=n(1),s=n(11),l=n(15);o.module("App").controller("GeneralList",i)},function(e,t,n){function i(e,t){return{restrict:"A",template:n(48),scope:{buttonIndex:"@",buttonData:"=",isPopup:"=",whenAddToLibraryClick:"&",whenInLibraryClick:"&",whenInLibraryDocumentClick:"&",whenDownloadPdfClick:"&",whenTriangleClick:"&"},controller:["$scope",function(n){function i(e){d(e),h()&&r.isFunction(n.whenAddToLibraryClick)&&n.whenAddToLibraryClick({index:n.buttonIndex})}function o(e){d(e),h()&&r.isFunction(n.whenInLibraryClick)&&n.whenInLibraryClick({index:n.buttonIndex})}function s(e){d(e),h()&&r.isFunction(n.whenInLibraryDocumentClick)&&n.whenInLibraryDocumentClick({index:n.buttonIndex})}function l(e){d(e);var t="not_found"!=n.buttonData.inLibraryStatus;if(h())return r.isFunction(n.whenTriangleClick)&&n.whenTriangleClick({index:n.buttonIndex,event:e,isInLibrary:t}),!1}function c(e){d(e),h()&&r.isFunction(n.whenDownloadPdfClick)&&n.whenDownloadPdfClick({index:n.buttonIndex})}function u(e){d(e),h()&&(n.tooltipVisibility.visible=!0)}function d(e){e instanceof MouseEvent&&(e.preventDefault(),e.stopPropagation())}function p(){h(!1)&&(n.tooltipVisibility.visible=!0)}function f(){n.tooltipVisibility.visible=!1}function h(e){return void 0===e&&(e=!0),t.isOffline()?(n.tooltipVisibility.visible=!1,e&&(n.offlineTooltipVisibility.visible=!0)):n.offlineTooltipVisibility.visible=!1,t.isOnline()}n.onAddToLibraryClick=i,n.onInLibraryClick=o,n.onInLibraryDocumentClick=s,n.onTriangleClick=l,n.preventPropagation=d,n.onDownloadPdfClick=c,n.onShowTooltipClick=u,n.onMouseEnter=p,n.onMouseLeave=f,n.tooltipVisibility={visible:!1},n.offlineTooltipVisibility={visible:!1},n.online=navigator.onLine,n.$watch("buttonData.inLibraryStatus",function(t){t===a.STATUS_IN_LIBRARY_WITHOUT_PDF_EXPIRED_SUBSCRIPTION||t===a.STATUS_IN_LIBRARY_WITHOUT_PDF_NO_SUBSCRIPTION?e.get(a.STORAGE_KEY_DISPLAYED_GO_PRO_TOOLTIP,!1).then(function(t){t?n.tooltipVisibility.visible=!1:(e.set(a.STORAGE_KEY_DISPLAYED_GO_PRO_TOOLTIP,!0),n.tooltipVisibility.visible=!0)}):n.tooltipVisibility.visible=!1})}]}}i.$inject=["Storage","OnlineStatus"];var o=n(2),r=n(1),a=n(0);o.module("App").directive("addToLibraryButton",i)},function(e,t,n){function i(e,t,i,o,p,f,h,g){return{restrict:"A",template:n(49),scope:{isBelowButton:"=?",selectedListName:"=?",whenListClick:"&",onAddToLibraryClick:"&",isAnySelected:"=?"},link:function(n,b,v){function m(){r.isFunction(n.onAddToLibraryClick)&&n.onAddToLibraryClick({index:n.api.index})}function y(e,t){e.stopPropagation(),e.preventDefault();var o=n.api.article,r=E(t,o);i.openItemInLibrary(r,t)}function _(e,t){if(t){var i=r.flatten(r.values(n.selectedItems));return r.includes(i,t)}return r.has(n.selectedItems,e)}function T(e){r.each(n.options.groups,function(t){r.each(t.collections,function(t){t._imported=r.some(e.collections,function(e){return t.collection_id==e.id}),r.each(t.lists,function(t){t._imported=r.some(t.item_ids,function(t){return r.some(e.collections,{item_id:t})})})})})}function w(e,t){return!e&&t?r.has(n.selectedItems,t)?delete n.selectedItems[t]:n.selectedItems[t]=[]:r.has(n.selectedItems,t)?r.includes(n.selectedItems[t],e)?r.pull(n.selectedItems[t],e):n.selectedItems[t].push(e):n.selectedItems[t]=[e],n.isAnySelected=!r.isEmpty(n.selectedItems),p.set({selectedItems:n.selectedItems}),!1}function E(e,t){var n=r.find(t.collections,{id:e});return r.get(n,"item_id")}function A(e,t,n){if(1==n){var i=s(c.URL_COLLECTION_IMPORT_FROM_COLLECTION,t.collection_id);return l.post(i,{from_collection_id:e.collection_id,item_ids:[e.id],annotations:!1}).then(function(n){return S(e,t,n),!0})}var o=E(t.collection_id,e),r=s(c.URL_REMOVE_FROM_COLLECTION,t.collection_id,o);return l.delete(r)}function S(e,t,n){var i=r.get(n,"data.items[0]");if(t.collection_id==i.collection_id){r.some(e.collections,{id:t.collection_id})||e.collections.push({id:i.collection_id,item_id:i.id,name:t.name,shared:t.shared})}}function I(e,t,n,i){if(1==i){var o=E(t.collection_id,e);if(o)return l.post(s(c.URL_ADD_TO_COLLECTION_LIST,t.collection_id,n.id),{item_ids:[o]}).then(function(e){L(r.get(e,"data.list"))});var a=s(c.URL_COLLECTION_IMPORT_FROM_COLLECTION,t.collection_id);return l.post(a,{from_collection_id:e.collection_id,item_ids:[e.id],annotations:!1}).then(function(i){if(i.status==d.OK){S(e,t,i);var o=r.get(i,"data.items[0].id");return t._imported=!0,l.post(s(c.URL_ADD_TO_COLLECTION_LIST,t.collection_id,n.id),{item_ids:[o]}).then(function(e){L(r.get(e,"data.list"))})}})}var o=E(t.collection_id,e);return l.post(s(c.URL_REMOVE_FROM_COLLECTION_LIST,t.collection_id,n.id),{item_ids:[o]}).then(function(e){L(r.get(e,"data.list"))})}function L(e){if(e){var t=r.find(r.flatMap(n.options.groups,"collections"),{collection_id:e.collection_id}),i=r.find(t.lists,{id:e.id});i.item_ids=e.item_ids,i.items=e.items}}function O(e){r.each(e.groups,function(e){r.each(e.collections,function(e){e._selected=_(e.collection_id,null),Object.defineProperty(e,"selected",{get:function(){return n.api.isInLibrary?e._imported:e._selected},set:function(t){n.api.isInLibrary?(e.disabled=!0,A(n.api.article,e,t).then(function(){return e._imported=t,e.disabled=!1,r.each(e.lists,function(e){e._imported=!1}),n.$apply(),a.delay(1e3).then(function(){return o.updateStatusForArticle.bind(o,n.api.article)()})}).finally(function(){e.disabled=!1})):(e._selected=t,0==t&&r.each(e.lists,function(e){1==e.selected&&(e.selected=!1)}),w(null,e.collection_id))}}),r.each(e.lists,function(t){t._selected=_(e.collection_id,t.id),Object.defineProperty(t,"selected",{get:function(){return n.api.isInLibrary?t._imported:t._selected},set:function(i){n.api.isInLibrary?(t.disabled=!0,e.disabled=!0,I(n.api.article,e,t,i).then(function(){return t._imported=i,t.disabled=!1,e.disabled=!1,n.$apply(),a.delay(1e3).then(function(){return o.updateStatusForArticle.bind(o,n.api.article)()})}).finally(function(){e.disabled=!1,t.disabled=!1})):(t._selected=i,0==e.selected&&1==i&&(e.selected=!0),e.selected&&(w(t.id,e.collection_id),r.every(e.lists,{selected:!1})&&(e.selected=!1)))}})})})})}function P(e){var t=N();return r.chain(e).keys().every(r.partial(r.has,t)).value()}function C(){return p.get("selectedItems",{}).then(function(e){if(r.isEmpty(n.options))n.selectedItems=e;else if(r.isEmpty(e)||r.has(e,"0")||!P(e)){var t=r.chain(n.options).get("groups",[]).find(function(e){return null==e.group_id||"null"==e.group_id}).get("collections[0]",null).value();if(t){t.selected=!0;var i=t.collection_id;n.selectedItems={},n.selectedItems[i]=[],p.set({selectedItems:n.selectedItems})}}else n.selectedItems=e;return!0})}function x(e){var t=r.chain(e.groups).flatMap("collections").keyBy("collection_id").value(),i=[];r.each(n.selectedItems,function(e,o){var a=t[o];if(a){var s=r.filter(e,function(e){return r.some(a.lists,{id:e})});n.selectedItems[o]=s}else i.push(o)}),r.each(i,function(e){delete n.selectedItems[e]})}function R(){return e.queryStorage().then(function(e){return O(e),n.options=e,!0}).catch(function(e){return console.error(e),!0}).then(function(){return e.queryFlat()}).then(function(e){return r.isEqual(e,n.options)||(p.set({lists:e}),x(e),O(e),n.options=e),n.selectedListName=U(),C()}).catch(function(e){e.status==d.UNAUTHORIZED&&(p.set({lists:null}),n.options={groups:[{group_id:null,collections:[{name:c.DEFAULT_PERSONAL_LIBRARY_NAME,collection_id:"0",lists:[],selected:!0}]}]},n.selectedItems={0:[]})})}function D(){return n.options&&n.options.groups&&n.options.groups.length>1}function k(e){var t=e.offset(),i=e.width(),o=t.left,r=t.top,a=u("#readcube-injected-button-dropdown");if(a.length){var s=a.offsetParent().offset();o-=s.left,r-=s.top}var l=o+i/2-70+"px";if(n.isBelowButton)n.triangleStyle={left:l,top:r+23+"px"},n.boxStyle={left:l,top:r+20+"px"};else{var c=h[0].body.clientHeight;n.triangleStyle={left:l,bottom:c-r+10+"px"},n.boxStyle={left:l,bottom:c-r+15+"px"}}}function N(){return r.chain(n.options.groups).flatMap("collections").keyBy("collection_id").value()}function U(){var e=N();return r.chain(n.selectedItems).toPairs().reduce(function(t,n){var i=n[0],o=n[1],a=e[i];if(a){var s=r.reduce(a.lists,function(e,t){return r.includes(o,t.id)?e.concat(t.name):e},[]);return r.isEmpty(s)?t.concat(a.name):t.concat(s)}return t},[]).join(", ").value()}function M(e){r.some(F,function(t){return e.target.className.indexOf(t)>-1})||n.$apply(function(){n.api.hideDropdown()})}var $=null;n.options={},f.loadListOptions=R,n.shouldDisplayAddButton=v.shouldDisplayAddButton||!1,n.api=f,n.hasMultipleCollections=D,n.selectedItems={},C().then(R).then(C),n.addToLibrary=m,n.onClickOpenArrow=y,t.listenForMessages(function(e,t){switch(e.message){case c.MESSAGE_UPDATE_LISTS:var n=r.map(r.get(e,"data.lists",[]),"data.list",[]);r.each(n,L);break;default:t(null)}});var B=r.debounce(function(){n.show&&$&&(k($),n.$apply())},200);h.on("click",M),u(g).on("resize",B),n.$on("$destroy",function(){h.off("click",M),u(g).off("resize",B)}),n.$watch("api.show",function(){var e=n.api.event;n.shouldDisplayAddButton=!n.api.isInLibrary,n.shouldDisplayAddButton||T(n.api.article),e&&n.api.show?($=u("caret"==e.target.className?e.target.parentElement:e.target),k($),n.show=!0):(n.show=!1,$=null)}),n.$watch("selectedItems",function(){r.isEmpty(n.options)||(n.selectedListName=U()),p.set({selectedItems:n.selectedItems})},!0);var F=["dropdown-menu","dropdown-group-name","dropdown-group-list","dropdown-collection-header"]}}}i.$inject=["List","Message","BrowserTab","Article","Storage","ListDropdownApi","$document","$window"];var o=n(2),r=n(1),a=n(8),s=n(5).sprintf,l=n(7),c=n(0),u=n(4),d=n(11);o.module("App").directive("listDropdown",i)},,function(e,t,n){function i(){return{restrict:"A",template:n(51),scope:{buttonData:"="},controller:["$scope",function(e){function t(){var t=e.buttonData.collections;return!!t&&t.some(function(e){return e.shared})}function n(){var t=e.buttonData.collections;if(t){return t.map(function(e){return e.name||"Personal"}).join(", ")}return""}e.isInSharedLibrary=t,e.sharedLibrariesTooltip=n}]}}var o=n(2);n(1),n(0);o.module("App").directive("sharedLibraryIcon",i)},function(e,t,n){function i(){return function(e){return r.isString(e)?a.parse(e).hostname:""}}var o=n(2),r=n(1),a=n(9);o.module("App").filter("hostname",i)},,function(e,t,n){function i(){return{show:!1,isInLibrary:!1,index:null,event:null,article:null,showDropdown:function(e,t,n,i){this.event=e,this.show=!0,this.index=t,this.isInLibrary=i,this.article=n},hideDropdown:function(){this.event=null,this.show=!1,this.index=null},toggleDropdown:function(e,t,n,i){this.show?this.hideDropdown():this.showDropdown(e,t,n,i)},loadListOptions:function(){}}}n(2).module("App").factory("ListDropdownApi",i)},function(e,t,n){function i(e,t,n,i,o){function d(){return a.get("loggedInUserDetails",null).then(function(e){return a.get("selectedItems",{}).then(function(t){return{userId:c.get(e,"id",null),selectedItems:t}})})}return u(n,{upload:function(t){var n=this;n.article.extend({progressPercent:0,progressType:r.PROGRESS_DOWNLOAD,usingPdfUrl:n.article.pdfUrl});var i;return e.when(function(){return n.article.pdfUrl?(i=n.article.pdfUrl,n.getProxiedDownloadPromise(n.article.pdfUrl)):e.reject("Pdf url not available")}()).catch(function(t){function r(){return n.article.doi?o.sendToBackground("request.GetPdfUrlsFromDxDoi",n.article.doi).then(function(t){var o=c.get(t,"[0]",null);return o?(n.article.extend({progressPercent:0,usingPdfUrl:o}),i=o,n.getProxiedDownloadPromise(o)):e.reject("Unable to find PDF url from dx.doi.org resolve")}):e.reject(t)}return n.article.parsedPdfUrl?(i=n.article.parsedPdfUrl,n.getProxiedDownloadPromise(n.article.parsedPdfUrl).catch(function(e){return r()})):r()}).then(function(o){var a=n.fixPdfFilename(o.fileName);return d().then(function(e){var u=c.keys(e.selectedItems),d="";return i&&i.length&&(d=encodeURIComponent(i.substring(0,500))),c.map(u,function(e){var i=s(r.URL_UPLOAD,e,"false",o.sha256Hash,n.article.doi?n.article.doi:"",n.article.pmid?n.article.pmid:"",o.fileSize,(t?t[e]:null)||n.article.id||"",encodeURIComponent(a),d);return l.get(i)})}).then(function(t){return e.all(t).then(function(t){return e.all(c.map(t,function(t,i){var a=c.get(t,"data.url",null);return a?(0==i&&(n.article.progressPercent=0,n.article.progressType=r.PROGRESS_UPLOAD),n.getUploadPromise(a,o.blob).then(null,null,function(e){n.article.progressPercent=e})):e.reject("Url not received from preparing to upload")}))})})}).catch(function(e){return n.evaluateUploadError(e)})},getProxiedDownloadPromise:function(e){var n=this;return n.getDownloadPromise({url:e,isProxied:!1}).catch(function(){return t.getInstitutionProxy().then(function(t){var i=t.replace(r.EZPROXY_URL_REPLACE_KEY,e);return n.article.progressPercent=0,n.getDownloadPromise({url:i,isProxied:!0})})})}})}i.$inject=["$q","User","Upload","$http","Message"];var o=n(2),r=n(0),a=n(26),s=n(5).sprintf,l=n(7),c=n(1),u=n(3);o.module("App").factory("ProxyUpload",i)},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t){/**
 * @license AngularJS v1.6.6
 * (c) 2010-2017 Google, Inc. http://angularjs.org
 * License: MIT
 */
!function(window,e){"use strict";function t(e,t){if(s(e)){t=t||[];for(var n=0,i=e.length;n<i;n++)t[n]=e[n]}else if(l(e)){t=t||{};for(var o in e)"$"===o.charAt(0)&&"$"===o.charAt(1)||(t[o]=e[o])}return t||e}function n(){function n(t,n){return e.extend(Object.create(t),n)}function i(e,t){var n=t.caseInsensitiveMatch,i={originalPath:e,regexp:e},o=i.keys=[];return e=e.replace(/([().])/g,"\\$1").replace(/(\/)?:(\w+)(\*\?|[?*])?/g,function(e,t,n,i){var r="?"===i||"*?"===i?"?":null,a="*"===i||"*?"===i?"*":null;return o.push({name:n,optional:!!r}),t=t||"",(r?"":t)+"(?:"+(r?t:"")+(a&&"(.+?)"||"([^/]+)")+(r||"")+")"+(r||"")}).replace(/([\/$*])/g,"\\$1"),i.regexp=new RegExp("^"+e+"$",n?"i":""),i}s=e.isArray,l=e.isObject,c=e.isDefined,u=e.noop;var o={};this.when=function(n,r){var a=t(r);if(e.isUndefined(a.reloadOnSearch)&&(a.reloadOnSearch=!0),e.isUndefined(a.caseInsensitiveMatch)&&(a.caseInsensitiveMatch=this.caseInsensitiveMatch),o[n]=e.extend(a,n&&i(n,a)),n){var s="/"===n[n.length-1]?n.substr(0,n.length-1):n+"/";o[s]=e.extend({redirectTo:n},i(s,a))}return this},this.caseInsensitiveMatch=!1,this.otherwise=function(e){return"string"==typeof e&&(e={redirectTo:e}),this.when(null,e),this},d=!0,this.eagerInstantiationEnabled=function(e){return c(e)?(d=e,this):d},this.$get=["$rootScope","$location","$routeParams","$q","$injector","$templateRequest","$sce","$browser",function(t,i,r,a,s,l,c,d){function p(e,t){var n=t.keys,i={};if(!t.regexp)return null;var o=t.regexp.exec(e);if(!o)return null;for(var r=1,a=o.length;r<a;++r){var s=n[r-1],l=o[r];s&&l&&(i[s.name]=l)}return i}function h(n){var i=S.current;w=_(),(E=w&&i&&w.$$route===i.$$route&&e.equals(w.pathParams,i.pathParams)&&!w.reloadOnSearch&&!A)||!i&&!w||t.$broadcast("$routeChangeStart",w,i).defaultPrevented&&n&&n.preventDefault()}function g(){var n=S.current,i=w;if(E)n.params=i.params,e.copy(n.params,r),t.$broadcast("$routeUpdate",n);else if(i||n){A=!1,S.current=i;var o=a.resolve(i);d.$$incOutstandingRequestCount(),o.then(b).then(v).then(function(a){return a&&o.then(m).then(function(o){i===S.current&&(i&&(i.locals=o,e.copy(i.params,r)),t.$broadcast("$routeChangeSuccess",i,n))})}).catch(function(e){i===S.current&&t.$broadcast("$routeChangeError",i,n,e)}).finally(function(){d.$$completeOutstandingRequest(u)})}}function b(t){var n={route:t,hasRedirection:!1};if(t)if(t.redirectTo)if(e.isString(t.redirectTo))n.path=T(t.redirectTo,t.params),n.search=t.params,n.hasRedirection=!0;else{var o=i.path(),r=i.search(),l=t.redirectTo(t.pathParams,o,r);e.isDefined(l)&&(n.url=l,n.hasRedirection=!0)}else if(t.resolveRedirectTo)return a.resolve(s.invoke(t.resolveRedirectTo)).then(function(t){return e.isDefined(t)&&(n.url=t,n.hasRedirection=!0),n});return n}function v(e){var t=!0;if(e.route!==S.current)t=!1;else if(e.hasRedirection){var n=i.url(),o=e.url;o?i.url(o).replace():o=i.path(e.path).search(e.search).replace().url(),o!==n&&(t=!1)}return t}function m(t){if(t){var n=e.extend({},t.resolve);e.forEach(n,function(t,i){n[i]=e.isString(t)?s.get(t):s.invoke(t,null,null,i)});var i=y(t);return e.isDefined(i)&&(n.$template=i),a.all(n)}}function y(t){var n,i;return e.isDefined(n=t.template)?e.isFunction(n)&&(n=n(t.params)):e.isDefined(i=t.templateUrl)&&(e.isFunction(i)&&(i=i(t.params)),e.isDefined(i)&&(t.loadedTemplateUrl=c.valueOf(i),n=l(i))),n}function _(){var t,r;return e.forEach(o,function(o,a){!r&&(t=p(i.path(),o))&&(r=n(o,{params:e.extend({},i.search(),t),pathParams:t}),r.$$route=o)}),r||o[null]&&n(o[null],{params:{},pathParams:{}})}function T(t,n){var i=[];return e.forEach((t||"").split(":"),function(e,t){if(0===t)i.push(e);else{var o=e.match(/(\w+)(?:[?*])?(.*)/),r=o[1];i.push(n[r]),i.push(o[2]||""),delete n[r]}}),i.join("")}var w,E,A=!1,S={routes:o,reload:function(){A=!0;var e={defaultPrevented:!1,preventDefault:function(){this.defaultPrevented=!0,A=!1}};t.$evalAsync(function(){h(e),e.defaultPrevented||g()})},updateParams:function(t){if(!this.current||!this.current.$$route)throw f("norout","Tried updating route when with no current route");t=e.extend({},this.current.params,t),i.path(T(this.current.$$route.originalPath,t)),i.search(t)}};return t.$on("$locationChangeStart",h),t.$on("$locationChangeSuccess",g),S}]}function i(e){d&&e.get("$route")}function o(){this.$get=function(){return{}}}function r(t,n,i){return{restrict:"ECA",terminal:!0,priority:400,transclude:"element",link:function(o,r,a,s,l){function c(){f&&(i.cancel(f),f=null),d&&(d.$destroy(),d=null),p&&(f=i.leave(p),f.done(function(e){!1!==e&&(f=null)}),p=null)}function u(){var a=t.current&&t.current.locals,s=a&&a.$template;if(e.isDefined(s)){var u=o.$new(),f=t.current,b=l(u,function(t){i.enter(t,null,p||r).done(function(t){!1===t||!e.isDefined(h)||h&&!o.$eval(h)||n()}),c()});p=b,d=f.scope=u,d.$emit("$viewContentLoaded"),d.$eval(g)}else c()}var d,p,f,h=a.autoscroll,g=a.onload||"";o.$on("$routeChangeSuccess",u),u()}}}function a(e,t,n){return{restrict:"ECA",priority:-400,link:function(i,o){var r=n.current,a=r.locals;o.html(a.$template);var s=e(o.contents());if(r.controller){a.$scope=i;var l=t(r.controller,a);r.controllerAs&&(i[r.controllerAs]=l),o.data("$ngControllerController",l),o.children().data("$ngControllerController",l)}i[r.resolveAs||"$resolve"]=a,s(i)}}}var s,l,c,u,d,p=e.module("ngRoute",[]).info({angularVersion:"1.6.6"}).provider("$route",n).run(i),f=e.$$minErr("ngRoute");i.$inject=["$injector"],p.provider("$routeParams",o),p.directive("ngView",r),p.directive("ngView",a),r.$inject=["$route","$anchorScroll","$animate"],a.$inject=["$compile","$controller","$route"]}(window,window.angular)},function(e,t,n){n(135),e.exports="ngRoute"},,function(e,t,n){n(139),e.exports="toaster"},function(e,t){!function(window,e){"use strict";angular.module("toaster",[]).constant("toasterConfig",{limit:0,"tap-to-dismiss":!0,"close-button":!1,"close-html":'<button class="toast-close-button" type="button">&times;</button>',"newest-on-top":!0,"time-out":5e3,"icon-classes":{error:"toast-error",info:"toast-info",wait:"toast-wait",success:"toast-success",warning:"toast-warning"},"body-output-type":"","body-template":"toasterBodyTmpl.html","icon-class":"toast-info","position-class":"toast-top-right","title-class":"toast-title","message-class":"toast-message","prevent-duplicates":!1,"mouseover-timer-stop":!0}).service("toaster",["$rootScope","toasterConfig",function(e,t){this.pop=function(t,n,i,o,r,a,s,l,c,u){if(angular.isObject(t)){var d=t;this.toast={type:d.type,title:d.title,body:d.body,timeout:d.timeout,bodyOutputType:d.bodyOutputType,clickHandler:d.clickHandler,showCloseButton:d.showCloseButton,closeHtml:d.closeHtml,uid:d.toastId,onShowCallback:d.onShowCallback,onHideCallback:d.onHideCallback,directiveData:d.directiveData},c=d.toastId,s=d.toasterId}else this.toast={type:t,title:n,body:i,timeout:o,bodyOutputType:r,clickHandler:a,showCloseButton:l,uid:c,onHideCallback:u};e.$emit("toaster-newToast",s,c)},this.clear=function(t,n){e.$emit("toaster-clearToasts",t,n)};for(var n in t["icon-classes"])this[n]=function(e){return function(t,n,i,o,r,a,s,l,c){angular.isString(t)?this.pop(e,t,n,i,o,r,a,s,l,c):this.pop(angular.extend(t,{type:e}))}}(n)}]).factory("toasterEventRegistry",["$rootScope",function(e){var t,n=null,i=null,o=[],r=[];return t={setup:function(){n||(n=e.$on("toaster-newToast",function(e,t,n){for(var i=0,r=o.length;i<r;i++)o[i](e,t,n)})),i||(i=e.$on("toaster-clearToasts",function(e,t,n){for(var i=0,o=r.length;i<o;i++)r[i](e,t,n)}))},subscribeToNewToastEvent:function(e){o.push(e)},subscribeToClearToastsEvent:function(e){r.push(e)},unsubscribeToNewToastEvent:function(e){var t=o.indexOf(e);t>=0&&o.splice(t,1),0===o.length&&(n(),n=null)},unsubscribeToClearToastsEvent:function(e){var t=r.indexOf(e);t>=0&&r.splice(t,1),0===r.length&&(i(),i=null)}},{setup:t.setup,subscribeToNewToastEvent:t.subscribeToNewToastEvent,subscribeToClearToastsEvent:t.subscribeToClearToastsEvent,unsubscribeToNewToastEvent:t.unsubscribeToNewToastEvent,unsubscribeToClearToastsEvent:t.unsubscribeToClearToastsEvent}}]).directive("directiveTemplate",["$compile","$injector",function(e,t){return{restrict:"A",scope:{directiveName:"@directiveName",directiveData:"@directiveData"},replace:!0,link:function(n,i,o){n.$watch("directiveName",function(r){if(angular.isUndefined(r)||r.length<=0)throw new Error("A valid directive name must be provided via the toast body argument when using bodyOutputType: directive");var a;try{a=t.get(o.$normalize(r)+"Directive")}catch(e){throw new Error(r+" could not be found. The name should appear as it exists in the markup, not camelCased as it would appear in the directive declaration, e.g. directive-name not directiveName.")}var s=a[0];if(!0!==s.scope&&s.scope)throw new Error("Cannot use a directive with an isolated scope. The scope must be either true or falsy (e.g. false/null/undefined). Occurred for directive "+r+".");if(s.restrict.indexOf("A")<0)throw new Error('Directives must be usable as attributes. Add "A" to the restrict option (or remove the option entirely). Occurred for directive '+r+".");n.directiveData&&(n.directiveData=angular.fromJson(n.directiveData));var l=e("<div "+r+"></div>")(n);i.append(l)})}}}]).directive("toasterContainer",["$parse","$rootScope","$interval","$sce","toasterConfig","toaster","toasterEventRegistry",function(e,t,n,i,o,r,a){return{replace:!0,restrict:"EA",scope:!0,link:function(t,s,l){function c(e,i){e.timeoutPromise=n(function(){t.removeToast(e.id)},i,1)}function u(n,o){if(n.type=h["icon-classes"][n.type],n.type||(n.type=h["icon-class"]),!0===h["prevent-duplicates"])if(f(o)){if(t.toasters.length>0&&t.toasters[t.toasters.length-1].body===n.body)return}else{var r,a;for(r=0,a=t.toasters.length;r<a;r++)t.toasters[r].uid===o&&(d(r),r--,a=t.toasters.length)}n.id=++g,f(o)||(n.uid=o);var s=h["close-button"];if("boolean"==typeof n.showCloseButton);else if("boolean"==typeof s)n.showCloseButton=s;else if("object"==typeof s){var l=s[n.type];void 0!==l&&null!==l&&(n.showCloseButton=l)}else n.showCloseButton=!1;switch(n.showCloseButton&&(n.closeHtml=i.trustAsHtml(n.closeHtml||t.config.closeHtml)),n.bodyOutputType=n.bodyOutputType||h["body-output-type"],n.bodyOutputType){case"trustedHtml":n.html=i.trustAsHtml(n.body);break;case"template":n.bodyTemplate=n.body||h["body-template"];break;case"templateWithData":var c=e(n.body||h["body-template"]),u=c(t);n.bodyTemplate=u.template,n.data=u.data;break;case"directive":n.html=n.body}t.configureTimer(n),!0===h["newest-on-top"]?(t.toasters.unshift(n),h.limit>0&&t.toasters.length>h.limit&&t.toasters.pop()):(t.toasters.push(n),h.limit>0&&t.toasters.length>h.limit&&t.toasters.shift()),angular.isFunction(n.onShowCallback)&&n.onShowCallback()}function d(e){var i=t.toasters[e];i.timeoutPromise&&n.cancel(i.timeoutPromise),t.toasters.splice(e,1),angular.isFunction(i.onHideCallback)&&i.onHideCallback()}function p(e){for(var n=t.toasters.length-1;n>=0;n--)f(e)?d(n):t.toasters[n].uid==e&&d(n)}function f(e){return angular.isUndefined(e)||null===e}var h,g=0;h=angular.extend({},o,t.$eval(l.toasterOptions)),t.config={toasterId:h["toaster-id"],position:h["position-class"],title:h["title-class"],message:h["message-class"],tap:h["tap-to-dismiss"],closeButton:h["close-button"],closeHtml:h["close-html"],animation:h["animation-class"],mouseoverTimer:h["mouseover-timer-stop"]},t.$on("$destroy",function(){a.unsubscribeToNewToastEvent(t._onNewToast),a.unsubscribeToClearToastsEvent(t._onClearToasts)}),t.configureTimer=function(e){var t=angular.isNumber(e.timeout)?e.timeout:h["time-out"];"object"==typeof t&&(t=t[e.type]),t>0&&c(e,t)},t.removeToast=function(e){var n,i;for(n=0,i=t.toasters.length;n<i;n++)if(t.toasters[n].id===e){d(n);break}},t.toasters=[],t._onNewToast=function(e,n,i){(f(t.config.toasterId)&&f(n)||!f(t.config.toasterId)&&!f(n)&&t.config.toasterId==n)&&u(r.toast,i)},t._onClearToasts=function(e,n,i){("*"==n||f(t.config.toasterId)&&f(n)||!f(t.config.toasterId)&&!f(n)&&t.config.toasterId==n)&&p(i)},a.setup(),a.subscribeToNewToastEvent(t._onNewToast),a.subscribeToClearToastsEvent(t._onClearToasts)},controller:["$scope","$element","$attrs",function(e,t,i){e.stopTimer=function(t){!0===e.config.mouseoverTimer&&t.timeoutPromise&&(n.cancel(t.timeoutPromise),t.timeoutPromise=null)},e.restartTimer=function(t){!0===e.config.mouseoverTimer?t.timeoutPromise||e.configureTimer(t):null===t.timeoutPromise&&e.removeToast(t.id)},e.click=function(t,n){if(!0===e.config.tap||!0===t.showCloseButton&&!0===n){var i=!0;t.clickHandler&&(angular.isFunction(t.clickHandler)?i=t.clickHandler(t,n):angular.isFunction(e.$parent.$eval(t.clickHandler))?i=e.$parent.$eval(t.clickHandler)(t,n):console.log("TOAST-NOTE: Your click handler is not inside a parent scope of toaster-container.")),i&&e.removeToast(t.id)}}}],template:'<div id="toast-container" ng-class="[config.position, config.animation]"><div ng-repeat="toaster in toasters" class="toast" ng-class="toaster.type" ng-click="click(toaster)" ng-mouseover="stopTimer(toaster)" ng-mouseout="restartTimer(toaster)"><div ng-if="toaster.showCloseButton" ng-click="click(toaster, true)" ng-bind-html="toaster.closeHtml"></div><div ng-class="config.title">{{toaster.title}}</div><div ng-class="config.message" ng-switch on="toaster.bodyOutputType"><div ng-switch-when="trustedHtml" ng-bind-html="toaster.html"></div><div ng-switch-when="template"><div ng-include="toaster.bodyTemplate"></div></div><div ng-switch-when="templateWithData"><div ng-include="toaster.bodyTemplate"></div></div><div ng-switch-when="directive"><div directive-template directive-name="{{toaster.html}}" directive-data="{{toaster.directiveData}}"></div></div><div ng-switch-default >{{toaster.body}}</div></div></div></div>'}}])}(window,document)},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){var i=n(2),o=n(0),r=n(251);n(189),n(138),n(73),n(136),n(195),i.module("App",["ngAnimate","ngRoute","toaster","ngDialog"]),function(e){e.keys().forEach(e)}(n(242)),n(66),n(63),n(35),n(33),n(64),n(34),n(32),n(62),n(44),n(69),n(36),n(23),n(37),n(71),n(38),n(40),n(41),n(24),n(43),n(70),n(42),n(22),n(39),n(67),n(60),n(21),r({message:o.MESSAGE_IS_ABSTRACT_PAGE,data:null},function(e){i.module("App").constant("IsAbstractPage",e),i.bootstrap(document,["App"],{strictDi:!0})}),e.exports=i.module("App")},,,,,,,,,,,,,,,,,,,,function(e,t){},,,,,,function(e,t,n){var i,o,r;!function(a,s){void 0!==e&&e.exports?(s("undefined"==typeof angular?n(2):angular),e.exports="ngDialog"):(o=[n(2)],i=s,void 0!==(r="function"==typeof i?i.apply(t,o):i)&&(e.exports=r))}(0,function(e){"use strict";var t=e.module("ngDialog",[]),n=e.element,i=e.isDefined,o=(document.body||document.documentElement).style,r=i(o.animation)||i(o.WebkitAnimation)||i(o.MozAnimation)||i(o.MsAnimation)||i(o.OAnimation),a="animationend webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend",s={html:!1,body:!1},l={},c=[],u=!1,d=!1;return t.provider("ngDialog",function(){var t=this.defaults={className:"ngdialog-theme-default",appendClassName:"",disableAnimation:!1,plain:!1,showClose:!0,closeByDocument:!0,closeByEscape:!0,closeByNavigation:!1,appendTo:!1,preCloseCallback:!1,overlay:!0,cache:!0,trapFocus:!0,preserveFocus:!0,ariaAuto:!0,ariaRole:null,ariaLabelledById:null,ariaLabelledBySelector:null,ariaDescribedById:null,ariaDescribedBySelector:null,bodyClassName:"ngdialog-open"};this.setForceHtmlReload=function(e){s.html=e||!1},this.setForceBodyReload=function(e){s.body=e||!1},this.setDefaults=function(n){e.extend(t,n)},this.setOpenOnePerName=function(e){d=e||!1};var i,o=0,p=0,f={};this.$get=["$document","$templateCache","$compile","$q","$http","$rootScope","$timeout","$window","$controller","$injector",function(h,g,b,v,m,y,_,T,w,E){var A=[],S={onDocumentKeydown:function(e){27===e.keyCode&&I.close("$escape")},activate:function(e){e.data("$ngDialogOptions").trapFocus&&(e.on("keydown",S.onTrapFocusKeydown),A.body.on("keydown",S.onTrapFocusKeydown))},deactivate:function(e){e.off("keydown",S.onTrapFocusKeydown),A.body.off("keydown",S.onTrapFocusKeydown)},deactivateAll:function(t){e.forEach(t,function(t){var n=e.element(t);S.deactivate(n)})},setBodyPadding:function(e){var t=parseInt(A.body.css("padding-right")||0,10);A.body.css("padding-right",t+e+"px"),A.body.data("ng-dialog-original-padding",t),y.$broadcast("ngDialog.setPadding",e)},resetBodyPadding:function(){var e=A.body.data("ng-dialog-original-padding");e?A.body.css("padding-right",e+"px"):A.body.css("padding-right",""),y.$broadcast("ngDialog.setPadding",0)},performCloseDialog:function(e,t){var n=e.data("$ngDialogOptions"),o=e.attr("id"),s=l[o];if(s){if(void 0!==T.Hammer){var d=s.hammerTime;d.off("tap",i),d.destroy&&d.destroy(),delete s.hammerTime}else e.unbind("click");1===p&&A.body.unbind("keydown",S.onDocumentKeydown),e.hasClass("ngdialog-closing")||(p-=1);var h=e.data("$ngDialogPreviousFocus");h&&h.focus&&h.focus(),y.$broadcast("ngDialog.closing",e,t),p=p<0?0:p,r&&!n.disableAnimation?(s.$destroy(),e.unbind(a).bind(a,function(){S.closeDialogElement(e,t)}).addClass("ngdialog-closing")):(s.$destroy(),S.closeDialogElement(e,t)),f[o]&&(f[o].resolve({id:o,value:t,$dialog:e,remainingDialogs:p}),delete f[o]),l[o]&&delete l[o],c.splice(c.indexOf(o),1),c.length||(A.body.unbind("keydown",S.onDocumentKeydown),u=!1)}},closeDialogElement:function(e,t){var n=e.data("$ngDialogOptions");e.remove(),0===p&&(A.html.removeClass(n.bodyClassName),A.body.removeClass(n.bodyClassName),S.resetBodyPadding()),y.$broadcast("ngDialog.closed",e,t)},closeDialog:function(t,n){var i=t.data("$ngDialogPreCloseCallback");if(i&&e.isFunction(i)){var o=i.call(t,n);e.isObject(o)?o.closePromise?o.closePromise.then(function(){S.performCloseDialog(t,n)}):o.then(function(){S.performCloseDialog(t,n)},function(){}):!1!==o&&S.performCloseDialog(t,n)}else S.performCloseDialog(t,n)},onTrapFocusKeydown:function(t){var n,i=e.element(t.currentTarget);if(i.hasClass("ngdialog"))n=i;else if(null===(n=S.getActiveDialog()))return;var o=9===t.keyCode,r=!0===t.shiftKey;o&&S.handleTab(n,t,r)},handleTab:function(e,t,n){var i=S.getFocusableElements(e);if(0===i.length)return void(document.activeElement&&document.activeElement.blur());var o=document.activeElement,r=Array.prototype.indexOf.call(i,o),a=-1===r,s=0===r,l=r===i.length-1,c=!1;n?(a||s)&&(i[i.length-1].focus(),c=!0):(a||l)&&(i[0].focus(),c=!0),c&&(t.preventDefault(),t.stopPropagation())},autoFocus:function(e){var t=e[0],i=t.querySelector("*[autofocus]");if(null===i||(i.focus(),document.activeElement!==i)){var o=S.getFocusableElements(e);if(o.length>0)return void o[0].focus();var r=S.filterVisibleElements(t.querySelectorAll("h1,h2,h3,h4,h5,h6,p,span"));if(r.length>0){var a=r[0];n(a).attr("tabindex","-1").css("outline","0"),a.focus()}}},getFocusableElements:function(e){var t=e[0],n=t.querySelectorAll("a[href], area[href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]), iframe, object, embed, *[tabindex], *[contenteditable]"),i=S.filterTabbableElements(n);return S.filterVisibleElements(i)},filterTabbableElements:function(e){for(var t=[],i=0;i<e.length;i++){var o=e[i];"-1"!==n(o).attr("tabindex")&&t.push(o)}return t},filterVisibleElements:function(e){for(var t=[],n=0;n<e.length;n++){var i=e[n];(i.offsetWidth>0||i.offsetHeight>0)&&t.push(i)}return t},getActiveDialog:function(){var e=document.querySelectorAll(".ngdialog");return 0===e.length?null:n(e[e.length-1])},applyAriaAttributes:function(e,t){if(t.ariaAuto){if(!t.ariaRole){var n=S.getFocusableElements(e).length>0?"dialog":"alertdialog";t.ariaRole=n}t.ariaLabelledBySelector||(t.ariaLabelledBySelector="h1,h2,h3,h4,h5,h6"),t.ariaDescribedBySelector||(t.ariaDescribedBySelector="article,section,p")}t.ariaRole&&e.attr("role",t.ariaRole),S.applyAriaAttribute(e,"aria-labelledby",t.ariaLabelledById,t.ariaLabelledBySelector),S.applyAriaAttribute(e,"aria-describedby",t.ariaDescribedById,t.ariaDescribedBySelector)},applyAriaAttribute:function(e,t,i,o){if(i&&e.attr(t,i),o){var r=e.attr("id"),a=e[0].querySelector(o);if(!a)return;var s=r+"-"+t;return n(a).attr("id",s),e.attr(t,s),s}},detectUIRouter:function(){try{return e.module("ui.router"),!0}catch(e){return!1}},getRouterLocationEventName:function(){return S.detectUIRouter()?"$stateChangeSuccess":"$locationChangeSuccess"}},I={__PRIVATE__:S,open:function(r){function a(e,t){return y.$broadcast("ngDialog.templateLoading",e),m.get(e,t||{}).then(function(t){return y.$broadcast("ngDialog.templateLoaded",e),t.data||""})}var s=null;if(r=r||{},!(d&&r.name&&(s=r.name+" dialog",this.isOpen(s)))){var h=e.copy(t),L=++o;s=s||"ngdialog"+L,c.push(s),e.extend(h,r);var O;f[s]=O=v.defer();var P;l[s]=P=e.isObject(h.scope)?h.scope.$new():y.$new();var C,x,R=e.extend({},h.resolve);return e.forEach(R,function(t,n){R[n]=e.isString(t)?E.get(t):E.invoke(t,null,null,n)}),v.all({template:function(t){return t?e.isString(t)&&h.plain?t:"boolean"!=typeof h.cache||h.cache?a(t,{cache:g}):a(t,{cache:!1}):"Empty template"}(h.template||h.templateUrl),locals:v.all(R)}).then(function(t){var o=t.template,r=t.locals;h.showClose&&(o+='<div class="ngdialog-close"></div>');var a=h.overlay?"":" ngdialog-no-overlay";if(C=n('<div id="'+s+'" class="ngdialog'+a+'"></div>'),C.html(h.overlay?'<div class="ngdialog-overlay"></div><div class="ngdialog-content" role="document">'+o+"</div>":'<div class="ngdialog-content" role="document">'+o+"</div>"),C.data("$ngDialogOptions",h),P.ngDialogId=s,h.data&&e.isString(h.data)){var l=h.data.replace(/^\s*/,"")[0];P.ngDialogData="{"===l||"["===l?e.fromJson(h.data):new String(h.data),P.ngDialogData.ngDialogId=s}else h.data&&e.isObject(h.data)&&(P.ngDialogData=h.data,P.ngDialogData.ngDialogId=s);if(h.className&&C.addClass(h.className),h.appendClassName&&C.addClass(h.appendClassName),h.disableAnimation&&C.addClass("ngdialog-disabled-animation"),x=h.appendTo&&e.isString(h.appendTo)?e.element(document.querySelector(h.appendTo)):A.body,S.applyAriaAttributes(C,h),h.preCloseCallback){var c;e.isFunction(h.preCloseCallback)?c=h.preCloseCallback:e.isString(h.preCloseCallback)&&P&&(e.isFunction(P[h.preCloseCallback])?c=P[h.preCloseCallback]:P.$parent&&e.isFunction(P.$parent[h.preCloseCallback])?c=P.$parent[h.preCloseCallback]:y&&e.isFunction(y[h.preCloseCallback])&&(c=y[h.preCloseCallback])),c&&C.data("$ngDialogPreCloseCallback",c)}if(P.closeThisDialog=function(e){S.closeDialog(C,e)},h.controller&&(e.isString(h.controller)||e.isArray(h.controller)||e.isFunction(h.controller))){var d;h.controllerAs&&e.isString(h.controllerAs)&&(d=h.controllerAs);var f=w(h.controller,e.extend(r,{$scope:P,$element:C}),!0,d);h.bindToController&&e.extend(f.instance,{ngDialogId:P.ngDialogId,ngDialogData:P.ngDialogData,closeThisDialog:P.closeThisDialog}),C.data("$ngDialogControllerController",f())}if(_(function(){var e=document.querySelectorAll(".ngdialog");S.deactivateAll(e),b(C)(P);var t=T.innerWidth-A.body.prop("clientWidth");A.html.addClass(h.bodyClassName),A.body.addClass(h.bodyClassName);var n=t-(T.innerWidth-A.body.prop("clientWidth"));n>0&&S.setBodyPadding(n),x.append(C),S.activate(C),h.trapFocus&&S.autoFocus(C),h.name?y.$broadcast("ngDialog.opened",{dialog:C,name:h.name}):y.$broadcast("ngDialog.opened",C)}),u||(A.body.bind("keydown",S.onDocumentKeydown),u=!0),h.closeByNavigation){var g=S.getRouterLocationEventName();y.$on(g,function(){S.closeDialog(C)})}if(h.preserveFocus&&C.data("$ngDialogPreviousFocus",document.activeElement),i=function(e){var t=!!h.closeByDocument&&n(e.target).hasClass("ngdialog-overlay"),i=n(e.target).hasClass("ngdialog-close");(t||i)&&I.close(C.attr("id"),i?"$closeButton":"$document")},void 0!==T.Hammer){(P.hammerTime=T.Hammer(C[0])).on("tap",i)}else C.bind("click",i);return p+=1,I}),{id:s,closePromise:O.promise,close:function(e){S.closeDialog(C,e)}}}},openConfirm:function(i){var o=v.defer(),r=e.copy(t);i=i||{},e.extend(r,i),r.scope=e.isObject(r.scope)?r.scope.$new():y.$new(),r.scope.confirm=function(e){o.resolve(e);var t=n(document.getElementById(a.id));S.performCloseDialog(t,e)};var a=I.open(r);if(a)return a.closePromise.then(function(e){return e?o.reject(e.value):o.reject()}),o.promise},isOpen:function(e){return n(document.getElementById(e)).length>0},close:function(e,t){var i=n(document.getElementById(e));if(i.length)S.closeDialog(i,t);else if("$escape"===e){var o=c[c.length-1];i=n(document.getElementById(o)),i.data("$ngDialogOptions").closeByEscape&&S.closeDialog(i,"$escape")}else I.closeAll(t);return I},closeAll:function(e){for(var t=document.querySelectorAll(".ngdialog"),i=t.length-1;i>=0;i--){var o=t[i];S.closeDialog(n(o),e)}},getOpenDialogs:function(){return c},getDefaults:function(){return t}};return e.forEach(["html","body"],function(e){if(A[e]=h.find(e),s[e]){var t=S.getRouterLocationEventName();y.$on(t,function(){A[e]=h.find(e)})}}),I}]}),t.directive("ngDialog",["ngDialog",function(t){return{restrict:"A",scope:{ngDialogScope:"="},link:function(n,i,o){i.on("click",function(i){i.preventDefault();var r=e.isDefined(n.ngDialogScope)?n.ngDialogScope:"noScope";e.isDefined(o.ngDialogClosePrevious)&&t.close(o.ngDialogClosePrevious);var a=t.getDefaults();t.open({template:o.ngDialog,className:o.ngDialogClass||a.className,appendClassName:o.ngDialogAppendClass,controller:o.ngDialogController,controllerAs:o.ngDialogControllerAs,bindToController:o.ngDialogBindToController,scope:r,data:o.ngDialogData,showClose:"false"!==o.ngDialogShowClose&&("true"===o.ngDialogShowClose||a.showClose),closeByDocument:"false"!==o.ngDialogCloseByDocument&&("true"===o.ngDialogCloseByDocument||a.closeByDocument),closeByEscape:"false"!==o.ngDialogCloseByEscape&&("true"===o.ngDialogCloseByEscape||a.closeByEscape),overlay:"false"!==o.ngDialogOverlay&&("true"===o.ngDialogOverlay||a.overlay),preCloseCallback:o.ngDialogPreCloseCallback||a.preCloseCallback,bodyClassName:o.ngDialogBodyClass||a.bodyClassName})})}}}]),t})},function(e,t,n){(function(e,i){var o;(function(){"use strict";function r(e){return e=String(e),e.charAt(0).toUpperCase()+e.slice(1)}function a(e,t,n){var i={"10.0":"10",6.4:"10 Technical Preview",6.3:"8.1",6.2:"8",6.1:"Server 2008 R2 / 7","6.0":"Server 2008 / Vista",5.2:"Server 2003 / XP 64-bit",5.1:"XP",5.01:"2000 SP1","5.0":"2000","4.0":"NT","4.90":"ME"};return t&&n&&/^Win/i.test(e)&&!/^Windows Phone /i.test(e)&&(i=i[/[\d.]+$/.exec(e)])&&(e="Windows "+i),e=String(e),t&&n&&(e=e.replace(RegExp(t,"i"),n)),e=l(e.replace(/ ce$/i," CE").replace(/\bhpw/i,"web").replace(/\bMacintosh\b/,"Mac OS").replace(/_PowerPC\b/i," OS").replace(/\b(OS X) [^ \d]+/i,"$1").replace(/\bMac (OS X)\b/,"$1").replace(/\/(\d)/," $1").replace(/_/g,".").replace(/(?: BePC|[ .]*fc[ \d.]+)$/i,"").replace(/\bx86\.64\b/gi,"x86_64").replace(/\b(Windows Phone) OS\b/,"$1").replace(/\b(Chrome OS \w+) [\d.]+\b/,"$1").split(" on ")[0])}function s(e,t){var n=-1,i=e?e.length:0;if("number"==typeof i&&i>-1&&i<=w)for(;++n<i;)t(e[n],n,e);else c(e,t)}function l(e){return e=h(e),/^(?:webOS|i(?:OS|P))/.test(e)?e:r(e)}function c(e,t){for(var n in e)I.call(e,n)&&t(e[n],n,e)}function u(e){return null==e?r(e):L.call(e).slice(8,-1)}function d(e,t){var n=null!=e?typeof e[t]:"number";return!(/^(?:boolean|number|string|undefined)$/.test(n)||"object"==n&&!e[t])}function p(e){return String(e).replace(/([ -])(?!$)/g,"$1?")}function f(e,t){var n=null;return s(e,function(i,o){n=t(n,i,o,e)}),n}function h(e){return String(e).replace(/^ +| +$/g,"")}function g(e){function t(t){return f(t,function(t,n){var i=n.pattern||p(n);return!t&&(t=RegExp("\\b"+i+" *\\d+[.\\w_]*","i").exec(e)||RegExp("\\b"+i+" *\\w+-[\\w]*","i").exec(e)||RegExp("\\b"+i+"(?:; *(?:[a-z]+[_-])?[a-z]+\\d+|[^ ();-]*)","i").exec(e))&&((t=String(n.label&&!RegExp(i,"i").test(n.label)?n.label:t).split("/"))[1]&&!/[\d.]+/.test(t[0])&&(t[0]+=" "+t[1]),n=n.label||n,t=l(t[0].replace(RegExp(i,"i"),n).replace(RegExp("; *(?:"+n+"[_-])?","i")," ").replace(RegExp("("+n+")[-_.]?(\\w)","i"),"$1 $2"))),t})}function n(){return this.description||""}var i=v,o=e&&"object"==typeof e&&"String"!=u(e);o&&(i=e,e=null);var r=i.navigator||{},s=r.userAgent||"";e||(e=s);var b,y,_=o||A==m,T=o?!!r.likeChrome:/\bChrome\b/.test(e)&&!/internal|\n/i.test(L.toString()),w=o?"Object":"ScriptBridgingProxyObject",S=o?"Object":"Environment",I=o&&i.java?"JavaPackage":u(i.java),O=o?"Object":"RuntimeObject",P=/\bJava/.test(I)&&i.java,C=P&&u(i.environment)==S,x=P?"a":"α",R=P?"b":"β",D=i.document||{},k=i.operamini||i.opera,N=E.test(N=o&&k?k["[[Class]]"]:u(k))?N:k=null,U=e,M=[],$=null,B=e==s,F=B&&k&&"function"==typeof k.version&&k.version(),j=function(t){return f(t,function(t,n){return t||RegExp("\\b"+(n.pattern||p(n))+"\\b","i").exec(e)&&(n.label||n)})}([{label:"EdgeHTML",pattern:"Edge"},"Trident",{label:"WebKit",pattern:"AppleWebKit"},"iCab","Presto","NetFront","Tasman","KHTML","Gecko"]),W=function(t){return f(t,function(t,n){return t||RegExp("\\b"+(n.pattern||p(n))+"\\b","i").exec(e)&&(n.label||n)})}(["Adobe AIR","Arora","Avant Browser","Breach","Camino","Electron","Epiphany","Fennec","Flock","Galeon","GreenBrowser","iCab","Iceweasel","K-Meleon","Konqueror","Lunascape","Maxthon",{label:"Microsoft Edge",pattern:"Edge"},"Midori","Nook Browser","PaleMoon","PhantomJS","Raven","Rekonq","RockMelt",{label:"Samsung Internet",pattern:"SamsungBrowser"},"SeaMonkey",{label:"Silk",pattern:"(?:Cloud9|Silk-Accelerated)"},"Sleipnir","SlimBrowser",{label:"SRWare Iron",pattern:"Iron"},"Sunrise","Swiftfox","Waterfox","WebPositive","Opera Mini",{label:"Opera Mini",pattern:"OPiOS"},"Opera",{label:"Opera",pattern:"OPR"},"Chrome",{label:"Chrome Mobile",pattern:"(?:CriOS|CrMo)"},{label:"Firefox",pattern:"(?:Firefox|Minefield)"},{label:"Firefox for iOS",pattern:"FxiOS"},{label:"IE",pattern:"IEMobile"},{label:"IE",pattern:"MSIE"},"Safari"]),G=t([{label:"BlackBerry",pattern:"BB10"},"BlackBerry",{label:"Galaxy S",pattern:"GT-I9000"},{label:"Galaxy S2",pattern:"GT-I9100"},{label:"Galaxy S3",pattern:"GT-I9300"},{label:"Galaxy S4",pattern:"GT-I9500"},{label:"Galaxy S5",pattern:"SM-G900"},{label:"Galaxy S6",pattern:"SM-G920"},{label:"Galaxy S6 Edge",pattern:"SM-G925"},{label:"Galaxy S7",pattern:"SM-G930"},{label:"Galaxy S7 Edge",pattern:"SM-G935"},"Google TV","Lumia","iPad","iPod","iPhone","Kindle",{label:"Kindle Fire",pattern:"(?:Cloud9|Silk-Accelerated)"},"Nexus","Nook","PlayBook","PlayStation Vita","PlayStation","TouchPad","Transformer",{label:"Wii U",pattern:"WiiU"},"Wii","Xbox One",{label:"Xbox 360",pattern:"Xbox"},"Xoom"]),H=function(t){return f(t,function(t,n,i){return t||(n[G]||n[/^[a-z]+(?: +[a-z]+\b)*/i.exec(G)]||RegExp("\\b"+p(i)+"(?:\\b|\\w*\\d)","i").exec(e))&&i})}({Apple:{iPad:1,iPhone:1,iPod:1},Archos:{},Amazon:{Kindle:1,"Kindle Fire":1},Asus:{Transformer:1},"Barnes & Noble":{Nook:1},BlackBerry:{PlayBook:1},Google:{"Google TV":1,Nexus:1},HP:{TouchPad:1},HTC:{},LG:{},Microsoft:{Xbox:1,"Xbox One":1},Motorola:{Xoom:1},Nintendo:{"Wii U":1,Wii:1},Nokia:{Lumia:1},Samsung:{"Galaxy S":1,"Galaxy S2":1,"Galaxy S3":1,"Galaxy S4":1},Sony:{PlayStation:1,"PlayStation Vita":1}}),V=function(t){return f(t,function(t,n){var i=n.pattern||p(n);return!t&&(t=RegExp("\\b"+i+"(?:/[\\d.]+|[ \\w.]*)","i").exec(e))&&(t=a(t,i,n.label||n)),t})}(["Windows Phone","Android","CentOS",{label:"Chrome OS",pattern:"CrOS"},"Debian","Fedora","FreeBSD","Gentoo","Haiku","Kubuntu","Linux Mint","OpenBSD","Red Hat","SuSE","Ubuntu","Xubuntu","Cygwin","Symbian OS","hpwOS","webOS ","webOS","Tablet OS","Tizen","Linux","Mac OS X","Macintosh","Mac","Windows 98;","Windows "]);if(j&&(j=[j]),H&&!G&&(G=t([H])),(b=/\bGoogle TV\b/.exec(G))&&(G=b[0]),/\bSimulator\b/i.test(e)&&(G=(G?G+" ":"")+"Simulator"),"Opera Mini"==W&&/\bOPiOS\b/.test(e)&&M.push("running in Turbo/Uncompressed mode"),"IE"==W&&/\blike iPhone OS\b/.test(e)?(b=g(e.replace(/like iPhone OS/,"")),H=b.manufacturer,G=b.product):/^iP/.test(G)?(W||(W="Safari"),V="iOS"+((b=/ OS ([\d_]+)/i.exec(e))?" "+b[1].replace(/_/g,"."):"")):"Konqueror"!=W||/buntu/i.test(V)?H&&"Google"!=H&&(/Chrome/.test(W)&&!/\bMobile Safari\b/i.test(e)||/\bVita\b/.test(G))||/\bAndroid\b/.test(V)&&/^Chrome/.test(W)&&/\bVersion\//i.test(e)?(W="Android Browser",V=/\bAndroid\b/.test(V)?V:"Android"):"Silk"==W?(/\bMobi/i.test(e)||(V="Android",M.unshift("desktop mode")),/Accelerated *= *true/i.test(e)&&M.unshift("accelerated")):"PaleMoon"==W&&(b=/\bFirefox\/([\d.]+)\b/.exec(e))?M.push("identifying as Firefox "+b[1]):"Firefox"==W&&(b=/\b(Mobile|Tablet|TV)\b/i.exec(e))?(V||(V="Firefox OS"),G||(G=b[1])):!W||(b=!/\bMinefield\b/i.test(e)&&/\b(?:Firefox|Safari)\b/.exec(W))?(W&&!G&&/[\/,]|^[^(]+?\)/.test(e.slice(e.indexOf(b+"/")+8))&&(W=null),(b=G||H||V)&&(G||H||/\b(?:Android|Symbian OS|Tablet OS|webOS)\b/.test(V))&&(W=/[a-z]+(?: Hat)?/i.exec(/\bAndroid\b/.test(V)?V:b)+" Browser")):"Electron"==W&&(b=(/\bChrome\/([\d.]+)\b/.exec(e)||0)[1])&&M.push("Chromium "+b):V="Kubuntu",F||(F=function(t){return f(t,function(t,n){return t||(RegExp(n+"(?:-[\\d.]+/|(?: for [\\w-]+)?[ /-])([\\d.]+[^ ();/_-]*)","i").exec(e)||0)[1]||null})}(["(?:Cloud9|CriOS|CrMo|Edge|FxiOS|IEMobile|Iron|Opera ?Mini|OPiOS|OPR|Raven|SamsungBrowser|Silk(?!/[\\d.]+$))","Version",p(W),"(?:Firefox|Minefield|NetFront)"])),(b="iCab"==j&&parseFloat(F)>3&&"WebKit"||/\bOpera\b/.test(W)&&(/\bOPR\b/.test(e)?"Blink":"Presto")||/\b(?:Midori|Nook|Safari)\b/i.test(e)&&!/^(?:Trident|EdgeHTML)$/.test(j)&&"WebKit"||!j&&/\bMSIE\b/i.test(e)&&("Mac OS"==V?"Tasman":"Trident")||"WebKit"==j&&/\bPlayStation\b(?! Vita\b)/i.test(W)&&"NetFront")&&(j=[b]),"IE"==W&&(b=(/; *(?:XBLWP|ZuneWP)(\d+)/i.exec(e)||0)[1])?(W+=" Mobile",V="Windows Phone "+(/\+$/.test(b)?b:b+".x"),M.unshift("desktop mode")):/\bWPDesktop\b/i.test(e)?(W="IE Mobile",V="Windows Phone 8.x",M.unshift("desktop mode"),F||(F=(/\brv:([\d.]+)/.exec(e)||0)[1])):"IE"!=W&&"Trident"==j&&(b=/\brv:([\d.]+)/.exec(e))&&(W&&M.push("identifying as "+W+(F?" "+F:"")),W="IE",F=b[1]),B){if(d(i,"global"))if(P&&(b=P.lang.System,U=b.getProperty("os.arch"),V=V||b.getProperty("os.name")+" "+b.getProperty("os.version")),_&&d(i,"system")&&(b=[i.system])[0]){V||(V=b[0].os||null);try{b[1]=i.require("ringo/engine").version,F=b[1].join("."),W="RingoJS"}catch(e){b[0].global.system==i.system&&(W="Narwhal")}}else"object"==typeof i.process&&!i.process.browser&&(b=i.process)?"object"==typeof b.versions?"string"==typeof b.versions.electron?(M.push("Node "+b.versions.node),W="Electron",F=b.versions.electron):"string"==typeof b.versions.nw&&(M.push("Chromium "+F,"Node "+b.versions.node),W="NW.js",F=b.versions.nw):(W="Node.js",U=b.arch,V=b.platform,F=/[\d.]+/.exec(b.version),F=F?F[0]:"unknown"):C&&(W="Rhino");else u(b=i.runtime)==w?(W="Adobe AIR",V=b.flash.system.Capabilities.os):u(b=i.phantom)==O?(W="PhantomJS",F=(b=b.version||null)&&b.major+"."+b.minor+"."+b.patch):"number"==typeof D.documentMode&&(b=/\bTrident\/(\d+)/i.exec(e))?(F=[F,D.documentMode],(b=+b[1]+4)!=F[1]&&(M.push("IE "+F[1]+" mode"),j&&(j[1]=""),F[1]=b),F="IE"==W?String(F[1].toFixed(1)):F[0]):"number"==typeof D.documentMode&&/^(?:Chrome|Firefox)\b/.test(W)&&(M.push("masking as "+W+" "+F),W="IE",F="11.0",j=["Trident"],V="Windows");V=V&&l(V)}if(F&&(b=/(?:[ab]|dp|pre|[ab]\d+pre)(?:\d+\+?)?$/i.exec(F)||/(?:alpha|beta)(?: ?\d)?/i.exec(e+";"+(B&&r.appMinorVersion))||/\bMinefield\b/i.test(e)&&"a")&&($=/b/i.test(b)?"beta":"alpha",F=F.replace(RegExp(b+"\\+?$"),"")+("beta"==$?R:x)+(/\d+\+?/.exec(b)||"")),"Fennec"==W||"Firefox"==W&&/\b(?:Android|Firefox OS)\b/.test(V))W="Firefox Mobile";else if("Maxthon"==W&&F)F=F.replace(/\.[\d.]+/,".x");else if(/\bXbox\b/i.test(G))"Xbox 360"==G&&(V=null),"Xbox 360"==G&&/\bIEMobile\b/.test(e)&&M.unshift("mobile mode");else if(!/^(?:Chrome|IE|Opera)$/.test(W)&&(!W||G||/Browser|Mobi/.test(W))||"Windows CE"!=V&&!/Mobi/i.test(e))if("IE"==W&&B)try{null===i.external&&M.unshift("platform preview")}catch(e){M.unshift("embedded")}else(/\bBlackBerry\b/.test(G)||/\bBB10\b/.test(e))&&(b=(RegExp(G.replace(/ +/g," *")+"/([.\\d]+)","i").exec(e)||0)[1]||F)?(b=[b,/BB10/.test(e)],V=(b[1]?(G=null,H="BlackBerry"):"Device Software")+" "+b[0],F=null):this!=c&&"Wii"!=G&&(B&&k||/Opera/.test(W)&&/\b(?:MSIE|Firefox)\b/i.test(e)||"Firefox"==W&&/\bOS X (?:\d+\.){2,}/.test(V)||"IE"==W&&(V&&!/^Win/.test(V)&&F>5.5||/\bWindows XP\b/.test(V)&&F>8||8==F&&!/\bTrident\b/.test(e)))&&!E.test(b=g.call(c,e.replace(E,"")+";"))&&b.name&&(b="ing as "+b.name+((b=b.version)?" "+b:""),E.test(W)?(/\bIE\b/.test(b)&&"Mac OS"==V&&(V=null),b="identify"+b):(b="mask"+b,W=N?l(N.replace(/([a-z])([A-Z])/g,"$1 $2")):"Opera",/\bIE\b/.test(b)&&(V=null),B||(F=null)),j=["Presto"],M.push(b));else W+=" Mobile";(b=(/\bAppleWebKit\/([\d.]+\+?)/i.exec(e)||0)[1])&&(b=[parseFloat(b.replace(/\.(\d)$/,".0$1")),b],"Safari"==W&&"+"==b[1].slice(-1)?(W="WebKit Nightly",$="alpha",F=b[1].slice(0,-1)):F!=b[1]&&F!=(b[2]=(/\bSafari\/([\d.]+\+?)/i.exec(e)||0)[1])||(F=null),b[1]=(/\bChrome\/([\d.]+)/i.exec(e)||0)[1],537.36==b[0]&&537.36==b[2]&&parseFloat(b[1])>=28&&"WebKit"==j&&(j=["Blink"]),B&&(T||b[1])?(j&&(j[1]="like Chrome"),b=b[1]||(b=b[0],b<530?1:b<532?2:b<532.05?3:b<533?4:b<534.03?5:b<534.07?6:b<534.1?7:b<534.13?8:b<534.16?9:b<534.24?10:b<534.3?11:b<535.01?12:b<535.02?"13+":b<535.07?15:b<535.11?16:b<535.19?17:b<536.05?18:b<536.1?19:b<537.01?20:b<537.11?"21+":b<537.13?23:b<537.18?24:b<537.24?25:b<537.36?26:"Blink"!=j?"27":"28")):(j&&(j[1]="like Safari"),b=b[0],b=b<400?1:b<500?2:b<526?3:b<533?4:b<534?"4+":b<535?5:b<537?6:b<538?7:b<601?8:"8"),j&&(j[1]+=" "+(b+="number"==typeof b?".x":/[.+]/.test(b)?"":"+")),"Safari"==W&&(!F||parseInt(F)>45)&&(F=b)),"Opera"==W&&(b=/\bzbov|zvav$/.exec(V))?(W+=" ",M.unshift("desktop mode"),"zvav"==b?(W+="Mini",F=null):W+="Mobile",V=V.replace(RegExp(" *"+b+"$"),"")):"Safari"==W&&/\bChrome\b/.exec(j&&j[1])&&(M.unshift("desktop mode"),W="Chrome Mobile",F=null,/\bOS X\b/.test(V)?(H="Apple",V="iOS 4.3+"):V=null),F&&0==F.indexOf(b=/[\d.]+$/.exec(V))&&e.indexOf("/"+b+"-")>-1&&(V=h(V.replace(b,""))),j&&!/\b(?:Avant|Nook)\b/.test(W)&&(/Browser|Lunascape|Maxthon/.test(W)||"Safari"!=W&&/^iOS/.test(V)&&/\bSafari\b/.test(j[1])||/^(?:Adobe|Arora|Breach|Midori|Opera|Phantom|Rekonq|Rock|Samsung Internet|Sleipnir|Web)/.test(W)&&j[1])&&(b=j[j.length-1])&&M.push(b),M.length&&(M=["("+M.join("; ")+")"]),H&&G&&G.indexOf(H)<0&&M.push("on "+H),G&&M.push((/^on /.test(M[M.length-1])?"":"on ")+G),V&&(b=/ ([\d.+]+)$/.exec(V),y=b&&"/"==V.charAt(V.length-b[0].length-1),V={architecture:32,family:b&&!y?V.replace(b[0],""):V,version:b?b[1]:null,toString:function(){var e=this.version;return this.family+(e&&!y?" "+e:"")+(64==this.architecture?" 64-bit":"")}}),(b=/\b(?:AMD|IA|Win|WOW|x86_|x)64\b/i.exec(U))&&!/\bi686\b/i.test(U)?(V&&(V.architecture=64,V.family=V.family.replace(RegExp(" *"+b),"")),W&&(/\bWOW64\b/i.test(e)||B&&/\w(?:86|32)$/.test(r.cpuClass||r.platform)&&!/\bWin64; x64\b/i.test(e))&&M.unshift("32-bit")):V&&/^OS X/.test(V.family)&&"Chrome"==W&&parseFloat(F)>=39&&(V.architecture=64),e||(e=null);var X={};return X.description=e,X.layout=j&&j[0],X.manufacturer=H,X.name=W,X.prerelease=$,X.product=G,X.ua=e,X.version=W&&F,X.os=V||{architecture:null,family:null,version:null,toString:function(){return"null"}},X.parse=g,X.toString=n,X.version&&M.unshift(F),X.name&&M.unshift(W),V&&W&&(V!=String(V).split(" ")[0]||V!=W.split(" ")[0]&&!G)&&M.push(G?"("+V+")":"on "+V),M.length&&(X.description=M.join(" ")),X}var b={function:!0,object:!0},v=b[typeof window]&&window||this,m=v,y=b[typeof t]&&t,_=b[typeof e]&&e&&!e.nodeType&&e,T=y&&_&&"object"==typeof i&&i;!T||T.global!==T&&T.window!==T&&T.self!==T||(v=T);var w=Math.pow(2,53)-1,E=/\bOpera/,A=this,S=Object.prototype,I=S.hasOwnProperty,L=S.toString,O=g();v.platform=O,void 0!==(o=function(){return O}.call(t,n,t,e))&&(e.exports=o)}).call(this)}).call(t,n(81)(e),n(16))},,,,,,,function(e,t){e.exports='<ng-include src="\'header\'"></ng-include>\n\n<div ng-switch="list.isWebpageMode.enabled">\n\n  <div\n    ng-switch-when="false"\n    class="container readcube-popup readcube-abstract-page">\n    <ng-include src="\'list\'"></ng-include>\n\n    <div class="article row">\n      <div class="col-xs-1 column-checkbox"></div>\n      <div class="col-xs-10 title column-label">\n        <div>\n          <label class="notes-label" for="note">NOTES</label>\n        </div>\n        <textarea\n          ng-model="list.articlesList[0].note"\n          name="note"\n          id="note"\n          style="width: 100%">\n        </textarea>\n      </div>\n      <div class="col-xs-1 column-checkbox"></div>\n    </div>\n  </div>\n\n  <div\n    ng-switch-when="true"\n    class="container readcube-popup readcube-web-page-import">\n    <ng-include src="\'webpage\'"></ng-include>\n  </div>\n\n</div>\n\n<ng-include src="\'footer\'"></ng-include>\n'},function(e,t){e.exports='<ng-include src="\'header\'"></ng-include>\n\n\n<div ng-switch="list.isWebpageMode.enabled">\n\n  <div\n    ng-switch-when="false"\n    class="container readcube-popup readcube-list-page">\n    <ng-include src="\'list\'"></ng-include>\n  </div>\n\n  <div\n    ng-switch-when="true"\n    class="container readcube-popup readcube-web-page-import">\n    <ng-include src="\'webpage\'"></ng-include>\n  </div>\n\n</div>\n\n<ng-include src="\'footer\'"></ng-include>\n'},function(e,t){e.exports='<p>You have selected a large number of references. Importing many references at once may take a while.</p>\n<div class="ngdialog-buttons">\n  <button type="button" class="ngdialog-button ngdialog-button-primary" ng-click="closeThisDialog(false)">Cancel import</button>\n  <button type="button" class="ngdialog-button ngdialog-button-secondary" ng-click="onImportArticles()">Import anyway</button>\n</div>'},function(e,t){e.exports='<footer class="footer">\n  <div class="row">\n    <div class="col-xs-1 column-checkbox">\n      <input ng-if="!list.isAbstractPage && list.selectAll.show && !list.isWebpageMode.enabled" type="checkbox" id="select-all"\n             ng-model="list.selectAll.checked" ng-change="list.onSelectAll()"/>\n    </div>\n    <div class="col-xs-2 column-label">\n      <label ng-if="!list.isAbstractPage && list.selectAll.show && !list.isWebpageMode.enabled" for="select-all" class="footer-label">\n        Select all\n      </label>\n    </div>\n    <div class="col-xs-9">\n      <table class="buttons-table">\n        <tbody>\n        <tr>\n          <td>\n            <div class="proxy-status-holder">\n              <table class="proxy-status" ng-click="list.institutionProxy.available ? list.onProxyClick() : list.onNoProxyClick()">\n                <tr>\n                  <td>Proxy</td>\n                  <td class="{{ list.institutionProxy.available ? \'proxy-on\' : \'proxy-off\' }}">\n                    {{ list.institutionProxy.available ? \'On\' : \'Off\' }}\n                  </td>\n                </tr>\n              </table>\n            </div>\n          </td>\n          <td>\n            <button ng-click="list.onOpenLibrary()" type="button" class="btn btn-sm button-footer-view-library">\n              View Library\n            </button>\n          </td>\n          <td>\n            <button ng-if="list.isAbstractPage" ng-click="list.onAddToLibrary()" type="button"\n                    class="btn btn-primary btn-sm button-footer-add-to-library"\n                    ng-disabled="list.addToLibraryButton.disabled">\n              {{ list.articlesList[0].inLibraryStatus == \'in_library\' ? \'Update\' : \'Add to Library\' }}\n            </button>\n            <button ng-if="!list.isAbstractPage" ng-click="list.onAddToLibrary()" type="button"\n                    class="btn btn-primary btn-sm button-footer-add-to-library"\n                    ng-disabled="list.addToLibraryButton.disabled">\n              Add to Library\n            </button>\n          </td>\n        </tr>\n        </tbody>\n      </table>\n    </div>\n  </div>\n  <div class="row">\n    <div class="col-xs-3 column-checkbox labels-padding">\n      <span title="Reload current page with ezproxy" class="readcube-icon-extended readcube-icon-reload cursor-pointer"\n            ng-click="list.institutionProxy.available ? list.onProxyPageReloadClick() : list.onNoProxyClick()"></span>\n      <span title="Open extension settings page" ng-click="list.onOpenOptions()" class="readcube-icon-extended readcube-icon-gear cursor-pointer"></span>\n      <span title="Open support page" ng-click="list.onOpenHelp()" class="readcube-icon-extended readcube-icon-support cursor-pointer"></span>\n    </div>\n    <div class="col-xs-9">\n      <label class="footer-label label-select-items">Add to:</label>\n      <button\n        ng-click="list.onListButtonClick($event)"\n        class="btn btn-sm btn-default button-footer-select-list"\n        title="{{ list.selectedListName }}"\n        type="button">\n        <span class="selected-list-name">{{ list.selectedListName }}</span><span class="caret"></span>\n      </button>\n    </div>\n  </div>\n</footer>\n<toaster-container></toaster-container>\n<div list-dropdown\n     on-add-to-library-click="list.onAddToLibrary()"\n     selected-list-name="list.selectedListName"\n     is-below-button="false"\n     is-any-selected="list.isAnyLibrarySelected"></div>\n'},function(e,t){e.exports='<nav class="navbar navbar-readcube navbar-fixed-top">\n  <div class="container-fluid">\n    <div class="navbar-header">\n      <a tabindex="-1" class="navbar-brand" href="http://readcube.com" target="_blank">\n        <img class="readcube-logo" alt="Brand" src="icons/readcube-logo.png"/>\n      </a>\n      <div class="pull-right" id="web-page-header-web-page-only" ng-show="list.articlesList.length == 0">\n        Web Page\n      </div>\n      <form class="form pull-right" ng-hide="list.articlesList.length == 0">\n        <div class="switch-field">\n          <input type="radio" id="switch_left" ng-value="true" ng-model="list.isWebpageMode.enabled"/>\n          <label for="switch_left">Web Page</label>\n          <input type="radio" id="switch_right" ng-value="false" ng-model="list.isWebpageMode.enabled"/>\n          <label for="switch_right">\n            {{ list.articlesList.length > 1 ? list.articlesList.length + \' Ref.\' : \'Reference\' }}\n          </label>\n        </div>\n      </form>\n    </div>\n  </div>\n</nav>\n'},function(e,t){e.exports='<div ng-repeat="row in list.articlesList" class="article row">\n  <div\n    class="col-xs-1 column-checkbox">\n    <input\n      ng-if="!list.isAbstractPage"\n      type="checkbox"\n      ng-change="list.onCheckboxChange($index)"\n      ng-model="list.articlesChecked[$index].checked"\n      ng-disabled="list.articlesChecked[$index].disabled"/>\n  </div>\n  <div\n    ng-class="list.isAbstractPage ? \'col-xs-10\' : \'col-xs-11\'"\n    class="title column-label" ng-click="list.onCheckArticle($index)">\n    <div class="list-title">\n      {{ row.metadata.title }}<span ng-if="row.metadata.chapter">: {{row.metadata.chapter}}</span>\n    </div>\n    <div class="metadata" ng-style="{\'padding-right\': (row.inLibraryStatus != \'not_found\') ? \'115px\' : \'25px\' }">\n        <span ng-if="row.metadata.authors.length > 0">\n          {{ row.metadata.authors | etAlAuthor }},\n        </span>\n      {{ row.metadata.journal }} {{ row.metadata.year }}\n      <div class="readcube-button-holder" add-to-library-button\n           is-popup="true"\n           ng-if="(row.inLibraryStatus != \'not_found\')"\n           ng-style="{ right: (list.isAbstractPage ? \'0px\' : \'20px\' )}"\n           button-index="{{ $index }}"\n           when-in-library-click="list.onInLibraryClick(index)"\n           when-in-library-document-click="list.onInLibraryDocumentClick(index)"\n           when-download-pdf-click="list.onDownloadPdfClick(index)"\n           button-data="row"></div>\n    </div>\n  </div>\n</div>\n'},function(e,t){e.exports='<div class="web-page-import-component" id="web-page-import-title">{{list.webPage.title}}</div>\n\n<div class="web-page-import-component">\n  <div>\n    <label class="web-page-import-label">URL</label>\n  </div>\n  <textarea\n    ng-model="list.webPage.url"\n    name="url"\n    id="web-page-import-url"\n    class="web-age-import-textarea">\n  </textarea>\n</div>\n\n<div class="web-page-import-component">\n  <div>\n    <label class="web-page-import-label">AUTHOR</label>\n  </div>\n  <div id="web-page-import-author-inputs">\n    <input type="text" placeholder="First" ng-model="list.webPage.author.first" />\n    <input type="text" placeholder="Middle" ng-model="list.webPage.author.initial" />\n    <input type="text" placeholder="Last" ng-model="list.webPage.author.last" />\n  </div>\n</div>\n\n<div class="web-page-import-component">\n  <div>\n    <label class="notes-label" for="note">NOTES</label>\n  </div>\n  <textarea\n    ng-model="list.webPage.note"\n    name="note"\n    id="web-page-import-note"\n    class="web-page-import-textarea">\n  </textarea>\n</div>\n'},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){function i(e){return n(o(e))}function o(e){var t=r[e];if(!(t+1))throw new Error("Cannot find module '"+e+"'.");return t}var r={"./app.js":169,"./config/cache.js":243,"./config/mixpanel.js":244,"./config/route.js":245,"./config/tether_tooltip.js":246,"./controllers/article_abstract.js":247,"./controllers/articles_list.js":248,"./controllers/popup_list.js":249,"./filters/et_al_author.js":250};i.keys=function(){return Object.keys(r)},i.resolve=o,e.exports=i,i.id=242},function(e,t,n){n(2).module("App").run(["$templateCache",function(e){e.put("article_abstract",n(203)),e.put("articles_list",n(204)),e.put("webpage",n(209)),e.put("header",n(207)),e.put("list",n(208)),e.put("footer",n(206)),e.put("many_articles_warning_message",n(205))}])},function(e,t,n){var i=n(2),o=n(0);i.module("App").run(["Mixpanel",function(e){e.trackEvent(o.MIXPANEL_EVENT_TOOLBAR_BUTTON_CLICKED)}])},function(e,t,n){n(2).module("App").config(["$routeProvider","IsAbstractPage",function(e,t){e.when("/",{templateUrl:"articles_list",controller:"ArticlesList",controllerAs:"list",resolve:{factory:["$q","$location",function(e,n){"ngInject";return!t||(n.path("/article_abstract"),e.reject("On article abstract page"))}]}}).when("/article_abstract",{templateUrl:"article_abstract",controller:"ArticleAbstract",controllerAs:"list"}).otherwise({redirectTo:"/"})}])},function(e,t,n){n(2).module("App").config(["tetherTooltipConfigProvider",function(e){e.setOptions({attachment:"top right",targetAttachment:"bottom left",targetOffset:"0 100px",constraints:[{to:"scrollParent"}]})}])},function(e,t,n){function i(e,t,n,i,d,p,f,h,g,b,v,m,y,_,T,w,E,A){function S(){return A.get("loggedInUserDetails",null).then(function(e){return A.get("selectedItems",{}).then(function(t){return{userId:r.get(e,"id",null),selectedItems:t}})})}function I(){if(p.isOffline())return void R.showErrorMessage("Import error - please check your network connection and try again");if(R.isWebpageMode.enabled)return R.addWebpageToLibrary();d.trackEvent(s.MIXPANEL_EVENT_POPUP_ADD_TO_LIBRARY_CLICKED);var e=R.articlesList[0];R.addToLibraryButton.disabled=!0,t.when(function(){return e.isInLibrary()?C(e):x(e)}()).finally(function(){R.addToLibraryButton.disabled=!1})}function L(t,i,o){return e.update(t,i,{item:{user_data:{notes:o}}}).then(function(){return n.sendToActiveTab({message:s.MESSAGE_UPDATE_ARTICLE,data:{index:0,updateDetails:{note:o}}})})}function O(e,t,n){var i=c(s.URL_COLLECTION_LISTS,t);return l.get(i).then(function(i){var o=r.get(i,"data.lists",[]),u=r.keyBy(o,"id");return a.all(r.map(n,function(n){var i=u[n];if(!r.includes(i.list_ids,e)){var o=c(s.URL_ADD_TO_COLLECTION_LIST,t,n);return l.post(o,{item_ids:[e]})}}))})}function P(e,t,n){var i=c(s.URL_COLLECTION_ARTICLES_STATUS,t),o=r.pick(e,["doi","pmid","gsid"]);return l.post(i,{ext_ids:[o]}).then(function(i){if("in_library"==r.get(i,"data.items[0].status",null))return r.get(i,"data.items[0].id",null);var o=c(s.URL_COLLECTION_IMPORT_FROM_COLLECTION,t);return l.post(o,{from_collection_id:n,item_ids:[e.id],annotations:!1}).then(function(e){return r.get(e,"data.items[0].id",null)})})}function C(e){return R.addToLibraryButton.disabled=!0,S().then(function(t){return a.all(r.map(t.selectedItems,function(n,i){return i==t.userId?L(e.id,i,e.note).then(function(){return O(e.id,i,n)}):P(e,i,t.userId).then(function(t){return L(t,i,e.note).then(function(){return O(t,i,n)})})})).then(function(){return i.$$phase||i.$apply(function(){R.showUpdatedMessage()}),!0}).catch(function(){R.showErrorMessage("Oops, an error prevented this import - please reload the page and try again")})})}function x(e){return R.articlesChecked[0].checked?R.isAnyLibrarySelected?(e.inLibraryStatus=s.STATUS_METADATA_ADDING,R.addArticleFromMetadata(e,0).then(function(){return R.addArticleFromPDF(e,0)}).catch(function(e){return e.status===u.UNAUTHORIZED&&n.sendToActiveTab({message:s.MESSAGE_SHOW_LOGIN,data:{queuedArticleIndexes:[0]}}).then(function(){f.close()}),t.reject(e)}).finally(function(){R.updateStatusForArticle(e).then(function(){R.finishArticleStatus(e).then(function(){e.isInLibrary()?(r.extend(R.articlesChecked[0],{disabled:!0,checked:!1}),R.showSuccessMessage()):R.showErrorMessage("Oops, an error prevented this import - please reload the page and try again"),n.sendToActiveTab({message:s.MESSAGE_UPDATE_ARTICLE,data:{index:0,updateDetails:{collection_id:e.collection_id,id:e.id,inLibraryStatus:e.inLibraryStatus}}})})})})):(R.showErrorMessage("Please select at least one library"),t.reject("No library was selected")):(R.showErrorMessage("Please select at least one item"),t.reject("No article was selected"))}var R=this;R.isAbstractPage=!0,i.tooltipApi=_,o.extend(R,E("PopupList",{Message:n,$window:f,BrowserTab:h,toaster:g,$q:t,ListDropdownApi:b,Mixpanel:d,User:v,ngDialog:m,OnlineStatus:p,RawUpload:y,List:w,Article:e,TooltipApi:_,ProxyUpload:T,$scope:i,Storage:A})),R.onAddToLibrary=I,R.updateStatusForArticle=e.updateStatusForArticle.bind(e),R.checkInstitutionProxy(),R.renderArticles().then(function(){var e=R.articlesChecked[0];e.disabled||(e.checked=!0)}),i.$watchGroup(["tooltipApi.article","tooltipApi.pdfUrl","tooltipApi.messageCount"],function(e){var t=r.get(e,"[0]"),i=r.get(e,"[1]");t&&i&&R.onDownloadRawPdf(t,i).finally(function(){n.sendToActiveTab({message:s.MESSAGE_UPDATE_ARTICLE,data:{index:0,updateDetails:{id:t.id,inLibraryStatus:t.inLibraryStatus}}})})})}i.$inject=["Article","$q","Message","$scope","Mixpanel","OnlineStatus","$window","BrowserTab","toaster","ListDropdownApi","User","ngDialog","RawUpload","TooltipApi","ProxyUpload","List","$controller","Storage"];var o=n(2),r=n(1),a=n(8),s=n(0),l=n(7),c=n(5).sprintf,u=n(11);o.module("App").controller("ArticleAbstract",i)},function(e,t,n){function i(e,t,n,i,s,l,c,u,d,p,f,h,g,b,v,m,y,_){function T(e){if(!E.isAnyLibrarySelected)return E.showErrorMessage("Please select at least one library"),t.reject("No library was selected");var i=[];if(l.isOffline())return void E.showErrorMessage("Import error - please check your network connection and try again");if(E.isWebpageMode.enabled)return E.addWebpageToLibrary();if(void 0===e&&(e=!1),s.trackEvent(a.MIXPANEL_EVENT_POPUP_ADD_TO_LIBRARY_CLICKED),!e&&r.filter(E.articlesChecked,{checked:!0}).length>=a.MAX_COUNT_OF_ARTICLES_IMPORT_SIMULTANEOUSLY)return E.showConfirmDialog(),!1;if(r.each(E.articlesChecked,function(e,o){if(!e.checked)return null;var s=E.articlesList[o],l=t.when(function(){return!!s.isInLibrary()||(s.inLibraryStatus=a.STATUS_METADATA_ADDING,n.sendToActiveTab({data:{article:s,index:o},message:a.MESSAGE_IMPROVE_ARTICLE}).then(function(e){return e&&(s.metadata=e),E.addArticleFromMetadata(s,o)}))}()).then(function(){return E.addArticleFromPDF(s,o).catch(function(){return!0})}).finally(function(){return E.updateStatusForArticle(s).then(function(){return E.finishArticleStatus(s).then(function(){s.isInLibrary()&&r.extend(E.articlesChecked[o],{disabled:!0,checked:!1}),n.sendToActiveTab({message:a.MESSAGE_UPDATE_ARTICLE,data:{index:o,updateDetails:{id:s.id,inLibraryStatus:s.inLibraryStatus,collections:s.collections,collection_id:s.collection_id}}})})})});i.push(l)}),0==i.length){r.some(E.articlesChecked,{checked:!1,disabled:!1})?E.showErrorMessage("Please select at least one item"):E.showWarningMessage("The selected reference(s) are already in your library.")}else E.addToLibraryButton.disabled=!0,t.all(i).then(function(e){return E.showSuccessMessage(),!0}).catch(function(e){e.status===HTTPStatus.UNAUTHORIZED?(n.sendToActiveTab({message:a.MESSAGE_SHOW_LOGIN,data:{queuedArticleIndexes:E.getCheckedArticlesIndexes()}}),c.close()):(E.showErrorMessage("Oops, an error prevented this import - please reload the page and try again"),console.error(e))}).finally(function(){E.addToLibraryButton.disabled=!1})}function w(e){var t=E.articlesList[e];!E.articlesChecked[e].checked||t.pmid||t.doi||n.sendToActiveTab({message:a.MESSAGE_GET_ARTICLE_IDENTIFIERS,index:e}).then(function(e){r.isEmpty(e)||r.extend(t,e)})}var E=this;E.isAbstractPage=!1,i.tooltipApi=b,o.extend(E,y("PopupList",{Message:n,$window:c,BrowserTab:u,toaster:d,$q:t,ListDropdownApi:p,Mixpanel:s,User:f,ngDialog:h,OnlineStatus:l,RawUpload:g,List:m,Article:e,TooltipApi:b,ProxyUpload:v,$scope:i,Storage:_})),E.onAddToLibrary=T,E.onCheckboxChange=w,function(){n.sendToActiveTab({message:a.MESSAGE_SELECT_ALL_SHOW}).then(function(e){E.selectAll.show=e})}(),E.checkInstitutionProxy(),E.renderArticles(),i.$watchGroup(["tooltipApi.article","tooltipApi.pdfUrl","tooltipApi.messageCount"],function(e){var t=r.get(e,"[0]"),i=r.get(e,"[1]"),o=E.articlesList.indexOf(t);t&&i&&-1!==o&&E.onDownloadRawPdf(t,i).finally(function(){n.sendToActiveTab({message:a.MESSAGE_UPDATE_ARTICLE,data:{index:o,updateDetails:{id:t.id,inLibraryStatus:t.inLibraryStatus}}})})})}i.$inject=["Article","$q","Message","$scope","Mixpanel","OnlineStatus","$window","BrowserTab","toaster","ListDropdownApi","User","ngDialog","RawUpload","TooltipApi","ProxyUpload","List","$controller","Storage"];var o=n(2),r=n(1),a=n(0);o.module("App").controller("ArticlesList",i)},function(e,t,n){function i(e,t,n,i,d,p,f,h,g,b,v,m,y,_,T,w,E,A){function S(){return h.evaluateLoggedInUserDetail().then(function(e){if(e){if("OS X"==l.os.family){var t=d.defer();return s.delay(function(){ee.getArticlesFromTab().then(t.resolve)},200),t.promise}return ee.getArticlesFromTab()}return $()}).catch(function(){$()})}function I(){chrome.tabs.query({active:!0,currentWindow:!0},function(e){if(0!=e.length){var t=e[0];ee.webPage.title=t.title,ee.webPage.url=t.url,ee.webPage.isSet=!0,E.$apply()}})}function L(){var t=this;return e.sendToActiveTab({message:r.MESSAGE_GET_ARTICLES}).then(function(e){e&&e.length?e.forEach(function(e){var n=new u(e);t.unfilteredArticles.push(n),n.isReadyForShowing&&(t.articlesList.push(n),t.articlesChecked.push({disabled:n.isInLibrary(),checked:!1}))}):t.isWebpageMode.enabled=!0})}function O(){f.trackEvent(r.MIXPANEL_EVENT_POPUP_VIEW_LIBRARY_CLICKED),n.openLibrary()}function P(){n.openOptions()}function C(){f.trackEvent(r.MIXPANEL_EVENT_POPUP_NEED_HELP_CLICKED),t.open(r.URL_HELP)}function x(e){var t=ee.articlesChecked[e];t.disabled||(t.checked=!t.checked)}function R(){f.trackEvent(r.MIXPANEL_EVENT_POPUP_SELECT_ALL_CLICKED),s.each(ee.articlesChecked,function(e){e.disabled||(e.checked=ee.selectAll.checked)})}function D(e){var t=ee.articlesList[e];n.openItemInLibrary(t.id,t.collection_id),f.trackEvent(r.MIXPANEL_EVENT_POPUP_IN_LIBRARY_CLICKED)}function k(e){var t=ee.articlesList[e];h.evaluateLoggedInUserDetail().then(function(e){n.openDocumentInLibrary(e.id,t.id)})}function N(t){var n=ee.articlesList[t];return!n.isProcessingStatus()&&ee.addArticleFromPDF(n,t).finally(function(){ee.finishArticleStatus(n).then(function(){e.sendToActiveTab({message:r.MESSAGE_UPDATE_ARTICLE,data:{index:t,updateDetails:{id:n.id,inLibraryStatus:n.inLibraryStatus}}})})})}function U(e,t,n,i){var o={type:"author"};["first","initial","last"].forEach(function(e){t[e]&&(o[e]=t[e])});var r={Type:"webpage",Title:e,Authors:[o],Publication:"",Issued:i,URL:n};return btoa(unescape(encodeURIComponent(JSON.stringify(r))))}function M(){var t=ee.webPage.title,n=ee.webPage.author,i=ee.webPage.url,o=ee.webPage.note,s=new Date,l=s.getDate(),c=s.getMonth()+1,u=s.getFullYear();l<10&&(l="0"+l),c<10&&(c="0"+c);var p=l+"/"+c+"/"+u,h=U(t,n,i,p),g={metadata:{authors:[n.first+" "+n.initial+" "+n.last],title:t,citeproc:h,year:u},note:o};return ee.addToLibraryButton.disabled=!0,e.sendToBackground("article.AddFromMetadata",{article:g,index:null,includeNote:o.length}).then(function(e){return ee.addToLibraryButton.disabled=!1,e.success?(f.incrementProperty(r.MIXPANEL_PROPERTY_BROWSER_EXTENSION_IMPORTED,1),f.trackEvent(r.MIXPANEL_EVENT_METADATA_IMPORTED),ee.showSuccessMessage(),!0):(e.status==a.UNAUTHORIZED?$():ee.showErrorMessage("Oops, an error prevented this import - please reload the page and try again"),d.reject(e))})}function $(){var e=chrome.extension.getURL("options.html")+"#/actions/"+r.ACTION_SHOW_LOGIN_FORM;c.open(e)}function B(n){var i=[];if(b.isOffline())return void ee.showErrorMessage("Import error - please check your network connection and try again");if(ee.isWebpageMode.enabled)return ee.addWebpageToLibrary();if(void 0===n&&(n=!1),f.trackEvent(r.MIXPANEL_EVENT_POPUP_ADD_TO_LIBRARY_CLICKED),!n&&s.filter(ee.articlesChecked,{checked:!0}).length>=r.MAX_COUNT_OF_ARTICLES_IMPORT_SIMULTANEOUSLY)return ee.showConfirmDialog(),!1;if(s.each(ee.articlesChecked,function(t,n){if(!t.checked)return null;var o=ee.articlesList[n],a=d.when(function(){return!!o.isInLibrary()||(o.inLibraryStatus=r.STATUS_METADATA_ADDING,e.sendToActiveTab({data:{article:o,index:n},message:r.MESSAGE_IMPROVE_ARTICLE}).then(function(e){return e&&(o.metadata=e),ee.addArticleFromMetadata(o,n)}))}()).then(function(){return ee.addArticleFromPDF(o,n).catch(function(){return!0})}).finally(function(){return ee.updateStatusForArticle(o).then(function(){return ee.finishArticleStatus(o).then(function(){o.isInLibrary()&&s.extend(ee.articlesChecked[n],{disabled:!0,checked:!1}),e.sendToActiveTab({message:r.MESSAGE_UPDATE_ARTICLE,data:{index:n,updateDetails:{id:o.id,inLibraryStatus:o.inLibraryStatus,collections:o.collections,collection_id:o.collection_id}}})})})});i.push(a)}),0==i.length){s.some(ee.articlesChecked,{checked:!1,disabled:!1})?ee.showErrorMessage("Please select at least one item"):ee.showWarningMessage("The selected reference(s) are already in your library.")}else ee.addToLibraryButton.disabled=!0,d.all(i).then(function(e){return ee.showSuccessMessage(),!0}).catch(function(n){n.status===a.UNAUTHORIZED?(e.sendToActiveTab({message:r.MESSAGE_SHOW_LOGIN,data:{queuedArticleIndexes:ee.getCheckedArticlesIndexes()}}),t.close()):(ee.showErrorMessage("Oops, an error prevented this import - please reload the page and try again"),console.error(n))}).finally(function(){ee.addToLibraryButton.disabled=!1})}function F(){g.open({template:"many_articles_warning_message",className:"ngdialog-theme-default",controller:["$scope",function(e){e.onImportArticles=function(){e.closeThisDialog(!0),ee.onAddToLibrary(!0)}}]})}function j(){i.pop({type:"success",body:"Successfully updated",showCloseButton:!0})}function W(){i.pop({type:"success",body:"Successfully imported",showCloseButton:!0}),ee.selectAll.checked=!1}function G(e){i.pop({type:"error",body:e,showCloseButton:!0})}function H(e){i.pop({type:"warning",body:e,showCloseButton:!0})}function V(e){}function X(e){e.stopPropagation(),p.toggleDropdown(e)}function Y(){return ee.articlesChecked.reduce(function(e,t,n){return t.checked&&e.push(n),e},[])}function q(t,n){return f.setProperty(r.MIXPANEL_PROPERTY_BROWSER_EXTENSION_LAST_SEEN,(new Date).toISOString()),e.sendToBackground("article.AddFromMetadata",{article:t.toJson(),index:n,includeNote:!0}).then(function(e){return e.success?(t.extend(e.article),f.incrementProperty(r.MIXPANEL_PROPERTY_BROWSER_EXTENSION_IMPORTED,1),f.trackEvent(r.MIXPANEL_EVENT_METADATA_IMPORTED),e):d.reject(e)})}function K(){return h.getInstitutionProxy().then(function(){ee.institutionProxy.available=!0}).catch(function(){ee.institutionProxy.available=!1})}function z(){n.openTab(chrome.extension.getURL("options.html")+"#/actions/"+r.ACTION_SHOW_PROXY_URL_MISSING)}function Q(){n.openTab(chrome.extension.getURL("options.html")+"#/actions/"+r.ACTION_SHOW_PROXY_URL_EXISTING)}function J(){h.getInstitutionProxy().then(function(t){e.sendToBackground("tabs.ReloadActiveTabWithProxy",t).then(function(){})})}function Z(){f.trackEvent(r.MIXPANEL_EVENT_POPUP_LIST_SELECTED)}var ee=this;ee.unfilteredArticles=[],ee.articlesChecked=[],ee.selectAll={checked:!1,show:!0},ee.addToLibraryButton={disabled:!1},ee.selectedListName=r.DEFAULT_PERSONAL_LIBRARY_NAME,ee.isAnyLibrarySelected=!0,ee.institutionProxy={available:!1},o.extend(ee,w("GeneralList",{ProxyUpload:T,RawUpload:v,BrowserTab:n,Article:y,Message:e,ListDropdownApi:p,$q:d,Storage:A,List:m,User:h,Mixpanel:f,SiteType:null,$scope:E,TooltipApi:_})),ee.onOpenLibrary=O,ee.onOpenOptions=P,ee.onOpenHelp=C,ee.onCheckArticle=x,ee.onSelectAll=R,ee.onInLibraryClick=D,ee.onInLibraryDocumentClick=k,ee.onDownloadPdfClick=N,ee.onAddToLibrary=B,ee.onNoProxyClick=z,ee.onProxyClick=Q,ee.onProxyPageReloadClick=J,ee.onListSelected=Z,ee.renderArticles=S,ee.getArticlesFromTab=L,ee.showConfirmDialog=F,ee.showSuccessMessage=W,ee.showUpdatedMessage=j,ee.showErrorMessage=G,ee.showWarningMessage=H,ee.onCheckboxChange=V,ee.onListButtonClick=X,ee.getCheckedArticlesIndexes=Y,ee.addArticleFromMetadata=q,ee.checkInstitutionProxy=K,ee.isWebpageMode={enabled:!1},ee.webPage={note:"",url:"",title:"",author:{first:"",initial:"",last:""},isSet:!1},e.listenForMessages(function(e,t){switch(e.message){case r.MESSAGE_UPDATE_POPUP_ARTICLE_FROM_CONTENT_SCRIPT:var n=s.get(e,"data.updateDetails",{}),i=s.get(e,"data.index",null);s.isNull(i)||s.isEmpty(n)||(s.extend(ee.unfilteredArticles[i],n),E.$apply()),t(!0);break;default:t(null)}}),E.$watch(function(){return ee.isWebpageMode.enabled},function(e){e&&!ee.webPage.isSet&&I()},!0),ee.addWebpageToLibrary=M}i.$inject=["Message","$window","BrowserTab","toaster","$q","ListDropdownApi","Mixpanel","User","ngDialog","OnlineStatus","RawUpload","List","Article","TooltipApi","ProxyUpload","$controller","$scope","Storage"];var o=n(2),r=n(0),a=n(11),s=n(1),l=n(196),c=n(46),u=n(15);o.module("App").controller("PopupList",i)},function(e,t,n){function i(){return function(e){var t=r.get(e,"[0]",null);return t?t+(e.length>1?" et al.":""):""}}var o=n(2),r=n(1);o.module("App").filter("etAlAuthor",i)},function(e,t){e.exports=function(e,t){chrome.tabs.query({active:!0,currentWindow:!0},function(n){if(0==n.length)return void t(null);chrome.tabs.sendMessage(n[0].id,e,t)})}},function(e,t,n){n(169)}],[252]);